# AgentMem 配置示例文件
# 复制此文件为 config.toml 并根据需要修改

# ============================================================================
# 数据库配置
# ============================================================================

[database]
# 数据库后端类型
# 可选值: "libsql" (默认, 嵌入式), "postgres" (企业级)
backend = "libsql"

# 数据库连接 URL
# LibSQL 示例: "./data/agentmem.db" (本地文件路径)
# PostgreSQL 示例: "postgresql://user:password@localhost:5432/agentmem"
url = "./data/agentmem.db"

# 是否自动运行数据库迁移
# 建议开发环境设为 true，生产环境设为 false 并手动管理迁移
auto_migrate = true

# 连接池配置 (仅 PostgreSQL)
[database.pool]
# 最大连接数
max_connections = 10

# 最小空闲连接数
min_connections = 2

# 连接超时时间 (秒)
connect_timeout = 30

# 空闲连接超时时间 (秒)
idle_timeout = 600

# ============================================================================
# 服务器配置
# ============================================================================

[server]
# 服务器监听地址
host = "127.0.0.1"

# 服务器监听端口
port = 8080

# 工作线程数 (0 表示使用 CPU 核心数)
workers = 0

# 请求超时时间 (秒)
request_timeout = 30

# ============================================================================
# 日志配置
# ============================================================================

[logging]
# 日志级别
# 可选值: "trace", "debug", "info", "warn", "error"
level = "info"

# 日志格式
# 可选值: "json", "pretty"
format = "pretty"

# 日志输出目标
# 可选值: "stdout", "file", "both"
output = "stdout"

# 日志文件路径 (当 output 为 "file" 或 "both" 时)
file_path = "./logs/agentmem.log"

# ============================================================================
# 认证配置
# ============================================================================

[auth]
# JWT 密钥 (生产环境请使用强随机密钥)
jwt_secret = "your-secret-key-change-this-in-production"

# JWT 过期时间 (秒)
jwt_expiration = 86400  # 24 小时

# API Key 过期时间 (秒, 0 表示永不过期)
api_key_expiration = 0

# ============================================================================
# CORS 配置
# ============================================================================

[cors]
# 是否启用 CORS
enabled = true

# 允许的源 (使用 "*" 允许所有源，生产环境不推荐)
allowed_origins = ["http://localhost:3000", "http://localhost:8080"]

# 允许的 HTTP 方法
allowed_methods = ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]

# 允许的请求头
allowed_headers = ["Content-Type", "Authorization", "X-API-Key"]

# 是否允许携带凭证
allow_credentials = true

# ============================================================================
# LLM 配置
# ============================================================================

[llm]
# 默认 LLM 提供商
# 可选值: "openai", "anthropic", "azure", "local"
default_provider = "openai"

# OpenAI 配置
[llm.openai]
api_key = "sk-..."
model = "gpt-4"
base_url = "https://api.openai.com/v1"
max_tokens = 4096
temperature = 0.7

# Anthropic 配置
[llm.anthropic]
api_key = "sk-ant-..."
model = "claude-3-opus-20240229"
max_tokens = 4096
temperature = 0.7

# ============================================================================
# 向量数据库配置
# ============================================================================

[vector_store]
# 向量数据库类型
# 可选值: "qdrant", "milvus", "weaviate", "pinecone", "chroma"
provider = "qdrant"

# Qdrant 配置
[vector_store.qdrant]
url = "http://localhost:6333"
collection_name = "agentmem_vectors"
vector_size = 1536

# ============================================================================
# 缓存配置
# ============================================================================

[cache]
# 缓存类型
# 可选值: "memory", "redis"
provider = "memory"

# Redis 配置 (当 provider 为 "redis" 时)
[cache.redis]
url = "redis://localhost:6379"
db = 0
pool_size = 10
ttl = 3600  # 默认过期时间 (秒)

# ============================================================================
# 性能配置
# ============================================================================

[performance]
# 是否启用查询缓存
enable_query_cache = true

# 查询缓存大小 (条目数)
query_cache_size = 1000

# 是否启用批量操作优化
enable_batch_optimization = true

# 批量操作最大大小
max_batch_size = 100

# ============================================================================
# 监控配置
# ============================================================================

[monitoring]
# 是否启用 Prometheus metrics
enable_metrics = true

# Metrics 端点路径
metrics_path = "/metrics"

# 是否启用健康检查端点
enable_health_check = true

# 健康检查端点路径
health_check_path = "/health"

# ============================================================================
# 开发配置
# ============================================================================

[development]
# 是否启用开发模式
enabled = false

# 是否启用热重载
hot_reload = false

# 是否显示详细错误信息
verbose_errors = true

# 是否启用 SQL 查询日志
log_sql_queries = false

# ============================================================================
# 环境变量覆盖说明
# ============================================================================
# 
# 所有配置项都可以通过环境变量覆盖，格式为:
# AGENTMEM_<SECTION>_<KEY>
#
# 示例:
# AGENTMEM_DATABASE_BACKEND=postgres
# AGENTMEM_DATABASE_URL=postgresql://localhost/agentmem
# AGENTMEM_SERVER_PORT=9000
# AGENTMEM_LOGGING_LEVEL=debug
#
# 特殊环境变量 (简化配置):
# DATABASE_BACKEND - 等同于 AGENTMEM_DATABASE_BACKEND
# DATABASE_URL - 等同于 AGENTMEM_DATABASE_URL
# DATABASE_AUTO_MIGRATE - 等同于 AGENTMEM_DATABASE_AUTO_MIGRATE
#
# ============================================================================

# ============================================================================
# 快速配置示例
# ============================================================================

# 示例 1: 开发环境 (LibSQL)
# [database]
# backend = "libsql"
# url = "./data/dev.db"
# auto_migrate = true

# 示例 2: 生产环境 (PostgreSQL)
# [database]
# backend = "postgres"
# url = "postgresql://agentmem:password@db.example.com:5432/agentmem_prod"
# auto_migrate = false
# [database.pool]
# max_connections = 50
# min_connections = 10

# 示例 3: 测试环境 (内存 LibSQL)
# [database]
# backend = "libsql"
# url = ":memory:"
# auto_migrate = true

