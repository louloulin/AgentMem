#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     ğŸ” AgentMem å…¨é¢ç”Ÿäº§çº§éªŒè¯å’Œåˆ†æ ğŸ”                    â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# 1. ä»£ç ç»Ÿè®¡
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š 1. ä»£ç ç»Ÿè®¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Rustä»£ç è¡Œæ•°:"
find crates -name "*.rs" | xargs wc -l | tail -1
echo ""
echo "ä¸»è¦crateç»Ÿè®¡:"
for crate in agent-mem agent-mem-core agent-mem-server; do
  lines=$(find crates/$crate/src -name "*.rs" 2>/dev/null | xargs wc -l 2>/dev/null | tail -1 | awk '{print $1}')
  echo "  - $crate: $lines lines"
done
echo ""

# 2. ä¾èµ–åˆ†æ
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“¦ 2. å…³é”®ä¾èµ–ç‰ˆæœ¬"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
grep -E "tokio|axum|libsql|serde|chrono" Cargo.toml | head -10
echo ""

# 3. APIç«¯ç‚¹ç»Ÿè®¡
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸŒ 3. APIç«¯ç‚¹ç»Ÿè®¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Memory API:"
grep -r "pub async fn" crates/agent-mem-server/src/routes/memory.rs | wc -l
echo "Agent API:"
grep -r "pub async fn" crates/agent-mem-server/src/routes/agents.rs | wc -l
echo "User API:"
grep -r "pub async fn" crates/agent-mem-server/src/routes/users.rs | wc -l
echo "Total routes:"
find crates/agent-mem-server/src/routes -name "*.rs" -exec grep -l "pub async fn" {} \; | wc -l
echo ""

# 4. æ•°æ®åº“è¡¨ç»“æ„
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ—„ï¸  4. æ•°æ®åº“è¡¨ç»Ÿè®¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
if [ -f "data/agentmem.db" ]; then
  sqlite3 data/agentmem.db << SQL
.tables
.separator " | "
SELECT 'memories' as table_name, COUNT(*) as count FROM memories;
SELECT 'agents' as table_name, COUNT(*) as count FROM agents;
SELECT 'users' as table_name, COUNT(*) as count FROM users;
SQL
else
  echo "  æ•°æ®åº“æ–‡ä»¶ä¸å­˜åœ¨"
fi
echo ""

# 5. æµ‹è¯•è¦†ç›–ç‡ç»Ÿè®¡
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ§ª 5. æµ‹è¯•æ–‡ä»¶ç»Ÿè®¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æµ‹è¯•æ–‡ä»¶æ•°é‡:"
find crates -name "*test*.rs" -o -name "tests" -type d | wc -l
echo "æµ‹è¯•å‡½æ•°æ•°é‡:"
find crates -name "*.rs" -exec grep -h "^[[:space:]]*#\[test\]" {} \; | wc -l
echo ""

# 6. é…ç½®æ–‡ä»¶æ£€æŸ¥
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âš™ï¸  6. é…ç½®æ–‡ä»¶çŠ¶æ€"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
ls -lh config*.toml 2>/dev/null || echo "  æœªæ‰¾åˆ°configæ–‡ä»¶"
echo ""

# 7. æ–‡æ¡£å®Œæ•´æ€§
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“š 7. æ–‡æ¡£æ–‡ä»¶ç»Ÿè®¡"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
find . -name "*.md" -not -path "./target/*" -not -path "./node_modules/*" | wc -l
echo ""

echo "âœ… åˆ†æå®Œæˆï¼"
