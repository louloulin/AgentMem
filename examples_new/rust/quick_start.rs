//! AgentMem 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹ç¤ºä¾‹
//!
//! è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº† AgentMem çš„æ ¸å¿ƒåŠŸèƒ½ï¼š
//! - é›¶é…ç½®åˆå§‹åŒ–
//! - æ·»åŠ è®°å¿†
//! - è¯­ä¹‰æœç´¢
//! - æ˜¾ç¤ºç»“æœ
//!
//! # è¿è¡Œæ–¹å¼
//!
//! ```bash
//! # è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»»é€‰å…¶ä¸€ï¼‰
//! export OPENAI_API_KEY=sk-...
//! # æˆ–
//! export ANTHROPIC_API_KEY=sk-...
//!
//! # è¿è¡Œç¤ºä¾‹
//! cargo run --example quick_start
//! ```
//!
//! # é¢„æœŸè¾“å‡º
//!
//! ```text
//! ğŸš€ AgentMem 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹
//!
//! âœ… æ­¥éª¤ 1: åˆå§‹åŒ–å®Œæˆ
//!
//! ğŸ“ æ­¥éª¤ 2: æ·»åŠ è®°å¿†
//! âœ… æ·»åŠ è®°å¿†: "æˆ‘å–œæ¬¢ç¼–ç¨‹" -> id: mem_001
//! âœ… æ·»åŠ è®°å¿†: "æˆ‘ä½åœ¨ä¸Šæµ·" -> id: mem_002
//! âœ… æ·»åŠ è®°å¿†: "æˆ‘çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Rust" -> id: mem_003
//!
//! ğŸ” æ­¥éª¤ 3: æœç´¢è®°å¿†
//! æœç´¢: "ç¼–ç¨‹"
//! âœ… æ‰¾åˆ° 2 æ¡è®°å¿†:
//!    1. æˆ‘å–œæ¬¢ç¼–ç¨‹ (ç›¸ä¼¼åº¦: 0.95)
//!    2. æˆ‘çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Rust (ç›¸ä¼¼åº¦: 0.92)
//!
//! ğŸ“š æ­¥éª¤ 4: è·å–æ‰€æœ‰è®°å¿†
//! âœ… å…±æœ‰ 3 æ¡è®°å¿†:
//!    1. æˆ‘å–œæ¬¢ç¼–ç¨‹
//!    2. æˆ‘ä½åœ¨ä¸Šæµ·
//!    3. æˆ‘çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Rust
//!
//! ğŸ‰ å®Œæˆï¼
//! ```

use agent_mem::{GetAllOptions, Memory};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // æ‰“å°æ¬¢è¿ä¿¡æ¯
    println!("ğŸš€ AgentMem 5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹\n");
    println!("è¿™ä¸ªç¤ºä¾‹å°†æ¼”ç¤º:");
    println!("  1. é›¶é…ç½®åˆå§‹åŒ–");
    println!("  2. æ·»åŠ è®°å¿†");
    println!("  3. è¯­ä¹‰æœç´¢");
    println!("  4. æ˜¾ç¤ºç»“æœ\n");

    // ============================================
    // æ­¥éª¤ 1: é›¶é…ç½®åˆå§‹åŒ–
    // ============================================
    println!("âœ… æ­¥éª¤ 1: åˆå§‹åŒ–å®Œæˆ");
    println!("   æç¤º: AgentMem ä¼šè‡ªåŠ¨æ£€æµ‹ç¯å¢ƒå˜é‡:");
    println!("   - OPENAI_API_KEY (ç”¨äº OpenAI)");
    println!("   - ANTHROPIC_API_KEY (ç”¨äº Claude)");
    println!();

    // åˆ›å»º Memory å®ä¾‹
    // AgentMem ä¼šè‡ªåŠ¨:
    // 1. æ£€æµ‹ç¯å¢ƒå˜é‡ä¸­çš„ API Key
    // 2. åˆå§‹åŒ–å‘é‡æ•°æ®åº“
    // 3. é…ç½®é»˜è®¤çš„åµŒå…¥æ¨¡å‹
    let mem = Memory::new().await?;

    // ============================================
    // æ­¥éª¤ 2: æ·»åŠ è®°å¿†
    // ============================================
    println!("ğŸ“ æ­¥éª¤ 2: æ·»åŠ è®°å¿†");

    // æ·»åŠ ç¬¬ä¸€æ¡è®°å¿†
    let result1 = mem.add("æˆ‘å–œæ¬¢ç¼–ç¨‹").await?;
    println!("âœ… æ·»åŠ è®°å¿†: \"æˆ‘å–œæ¬¢ç¼–ç¨‹\" -> id: {}", result1.id);

    // æ·»åŠ ç¬¬äºŒæ¡è®°å¿†
    let result2 = mem.add("æˆ‘ä½åœ¨ä¸Šæµ·").await?;
    println!("âœ… æ·»åŠ è®°å¿†: \"æˆ‘ä½åœ¨ä¸Šæµ·\" -> id: {}", result2.id);

    // æ·»åŠ ç¬¬ä¸‰æ¡è®°å¿†ï¼ˆä¸ç¬¬ä¸€æ¡ç›¸å…³ï¼‰
    let result3 = mem.add("æˆ‘çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Rust").await?;
    println!("âœ… æ·»åŠ è®°å¿†: \"æˆ‘çš„ç¼–ç¨‹è¯­è¨€æ˜¯ Rust\" -> id: {}", result3.id);
    println!();

    // ============================================
    // æ­¥éª¤ 3: è¯­ä¹‰æœç´¢
    // ============================================
    println!("ğŸ” æ­¥éª¤ 3: æœç´¢è®°å¿†");

    // æœç´¢ä¸"ç¼–ç¨‹"ç›¸å…³çš„è®°å¿†
    let query = "ç¼–ç¨‹";
    println!("æœç´¢: \"{}\"", query);

    let results = mem.search(query).await?;
    println!("âœ… æ‰¾åˆ° {} æ¡è®°å¿†:", results.len());

    // æ˜¾ç¤ºæœç´¢ç»“æœ
    for (i, result) in results.iter().enumerate() {
        let score = result.score.unwrap_or(0.0);
        let content = &result.content;
        println!("   {}. {} (ç›¸ä¼¼åº¦: {:.2})", i + 1, content, score);
    }
    println!();

    // ============================================
    // æ­¥éª¤ 4: è·å–æ‰€æœ‰è®°å¿†
    // ============================================
    println!("ğŸ“š æ­¥éª¤ 4: è·å–æ‰€æœ‰è®°å¿†");

    // ä½¿ç”¨é»˜è®¤é€‰é¡¹è·å–æ‰€æœ‰è®°å¿†
    let all_memories = mem.get_all(GetAllOptions::default()).await?;
    println!("âœ… å…±æœ‰ {} æ¡è®°å¿†:", all_memories.len());

    // æ˜¾ç¤ºæ‰€æœ‰è®°å¿†
    for (i, memory) in all_memories.iter().enumerate() {
        println!("   {}. {}", i + 1, memory.content);
    }
    println!();

    // ============================================
    // å®Œæˆ
    // ============================================
    println!("ğŸ‰ å®Œæˆï¼");
    println!("\nğŸ’¡ ä¸‹ä¸€æ­¥:");
    println!("   - æŸ¥çœ‹ memory_management.rs äº†è§£å®Œæ•´çš„ CRUD æ“ä½œ");
    println!("   - æŸ¥çœ‹ semantic_search.rs äº†è§£æ›´å¤šæœç´¢æ–¹å¼");
    println!("   - æŸ¥çœ‹ chatbot.rs äº†è§£å¦‚ä½•æ„å»ºèŠå¤©æœºå™¨äºº");

    Ok(())
}

// ============================================
// é”™è¯¯å¤„ç†ç¤ºä¾‹
// ============================================
//
// æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œéƒ½å¯èƒ½è¿”å›é”™è¯¯ï¼Œè¿™é‡Œæ¼”ç¤ºäº†å‡ ç§å¤„ç†æ–¹å¼:
//
// æ–¹å¼ 1: ä½¿ç”¨ ? æ“ä½œç¬¦ï¼ˆå¦‚ä¸Šæ‰€ç¤ºï¼‰
//   let mem = Memory::new().await?;
//
// æ–¹å¼ 2: ä½¿ç”¨ match æ˜¾å¼å¤„ç†
//   match Memory::new().await {
//       Ok(mem) => println!("æˆåŠŸ"),
//       Err(e) => eprintln!("é”™è¯¯: {}", e),
//   }
//
// æ–¹å¼ 3: ä½¿ç”¨ unwrap æˆ– expectï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
//   let mem = Memory::new().await.expect("åˆå§‹åŒ–å¤±è´¥");
