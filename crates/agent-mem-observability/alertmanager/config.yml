# AlertManager é…ç½®æ–‡ä»¶ - AgentMem å‘Šè­¦ç®¡ç†

global:
  # SMTP é…ç½®ï¼ˆç”¨äºé‚®ä»¶å‘Šè­¦ï¼‰
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'agentmem-alerts@example.com'
  smtp_auth_username: 'agentmem-alerts@example.com'
  smtp_auth_password: 'your-password-here'
  smtp_require_tls: true
  
  # Slack é…ç½®ï¼ˆç”¨äº Slack å‘Šè­¦ï¼‰
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
  
  # å…¨å±€æ ‡ç­¾
  resolve_timeout: 5m

# è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶å™¨
  receiver: 'default'
  
  # åˆ†ç»„é…ç½®
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  
  # å­è·¯ç”±
  routes:
    # ä¸¥é‡å‘Šè­¦ - ç«‹å³å‘é€
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
      continue: true
    
    # è­¦å‘Šå‘Šè­¦ - åˆ†ç»„å‘é€
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 1h
    
    # æ•°æ®åº“å‘Šè­¦
    - match:
        component: database
      receiver: 'database-team'
      group_wait: 10s
      repeat_interval: 30m
    
    # ç¼“å­˜å‘Šè­¦
    - match:
        component: cache
      receiver: 'cache-team'
      group_wait: 10s
      repeat_interval: 30m
    
    # æ€§èƒ½å‘Šè­¦
    - match_re:
        component: (vector_search|graph_query|batch)
      receiver: 'performance-team'
      group_wait: 10s
      repeat_interval: 30m

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœæœåŠ¡å·²ç»å®•æœºï¼ŒæŠ‘åˆ¶å…¶ä»–æ‰€æœ‰å‘Šè­¦
  - source_match:
      severity: 'critical'
      alertname: 'ServiceDown'
    target_match_re:
      severity: 'warning|info'
    equal: ['instance']
  
  # å¦‚æœæœ‰ä¸¥é‡å‘Šè­¦ï¼ŒæŠ‘åˆ¶ç›¸åŒç»„ä»¶çš„è­¦å‘Šå‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['component', 'instance']

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨ - æ§åˆ¶å°è¾“å‡º
  - name: 'default'
    webhook_configs:
      - url: 'http://localhost:5001/webhook'
        send_resolved: true
  
  # ä¸¥é‡å‘Šè­¦ - å¤šæ¸ é“é€šçŸ¥
  - name: 'critical-alerts'
    email_configs:
      - to: 'oncall@example.com'
        headers:
          Subject: '[CRITICAL] AgentMem Alert: {{ .GroupLabels.alertname }}'
        html: |
          <h2>ä¸¥é‡å‘Šè­¦</h2>
          <p><strong>å‘Šè­¦åç§°:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>ä¸¥é‡ç¨‹åº¦:</strong> {{ .CommonLabels.severity }}</p>
          <p><strong>ç»„ä»¶:</strong> {{ .CommonLabels.component }}</p>
          <p><strong>æè¿°:</strong> {{ range .Alerts }}{{ .Annotations.description }}{{ end }}</p>
          <p><strong>æ—¶é—´:</strong> {{ .CommonAnnotations.timestamp }}</p>
    
    slack_configs:
      - channel: '#agentmem-critical'
        title: 'ğŸš¨ ä¸¥é‡å‘Šè­¦: {{ .GroupLabels.alertname }}'
        text: |
          *ä¸¥é‡ç¨‹åº¦:* {{ .CommonLabels.severity }}
          *ç»„ä»¶:* {{ .CommonLabels.component }}
          *æè¿°:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        send_resolved: true
    
    webhook_configs:
      - url: 'http://localhost:5001/critical'
        send_resolved: true
  
  # è­¦å‘Šå‘Šè­¦ - Slack é€šçŸ¥
  - name: 'warning-alerts'
    slack_configs:
      - channel: '#agentmem-warnings'
        title: 'âš ï¸ è­¦å‘Š: {{ .GroupLabels.alertname }}'
        text: |
          *ä¸¥é‡ç¨‹åº¦:* {{ .CommonLabels.severity }}
          *ç»„ä»¶:* {{ .CommonLabels.component }}
          *æè¿°:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        send_resolved: true
  
  # æ•°æ®åº“å›¢é˜Ÿ
  - name: 'database-team'
    email_configs:
      - to: 'database-team@example.com'
        headers:
          Subject: '[Database] AgentMem Alert: {{ .GroupLabels.alertname }}'
    
    slack_configs:
      - channel: '#database-alerts'
        title: 'ğŸ’¾ æ•°æ®åº“å‘Šè­¦: {{ .GroupLabels.alertname }}'
        text: |
          *æè¿°:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        send_resolved: true
  
  # ç¼“å­˜å›¢é˜Ÿ
  - name: 'cache-team'
    email_configs:
      - to: 'cache-team@example.com'
        headers:
          Subject: '[Cache] AgentMem Alert: {{ .GroupLabels.alertname }}'
    
    slack_configs:
      - channel: '#cache-alerts'
        title: 'ğŸ—„ï¸ ç¼“å­˜å‘Šè­¦: {{ .GroupLabels.alertname }}'
        text: |
          *æè¿°:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        send_resolved: true
  
  # æ€§èƒ½å›¢é˜Ÿ
  - name: 'performance-team'
    email_configs:
      - to: 'performance-team@example.com'
        headers:
          Subject: '[Performance] AgentMem Alert: {{ .GroupLabels.alertname }}'
    
    slack_configs:
      - channel: '#performance-alerts'
        title: 'âš¡ æ€§èƒ½å‘Šè­¦: {{ .GroupLabels.alertname }}'
        text: |
          *æè¿°:* {{ range .Alerts }}{{ .Annotations.description }}{{ end }}
        send_resolved: true

# æ¨¡æ¿é…ç½®
templates:
  - '/etc/alertmanager/templates/*.tmpl'

