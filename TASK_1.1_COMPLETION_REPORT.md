# ä»»åŠ¡ 1.1 å®ŒæˆæŠ¥å‘Šï¼šåˆ›å»º Memory ç»Ÿä¸€ API

**å®Œæˆæ—¶é—´**: 2025-10-17  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•ç»“æœ**: 6/6 é€šè¿‡

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

æ ¹æ® `mem24.md` æ”¹é€ è®¡åˆ’ï¼Œä»»åŠ¡ 1.1 çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„ Memory APIï¼Œåˆå¹¶ç°æœ‰çš„ä¸¤å¥— APIï¼ˆSimpleMemory å’Œ Agent-based APIï¼‰ï¼Œæä¾›æ—¢ç®€å•åˆå¼ºå¤§çš„è®°å¿†ç®¡ç†æ¥å£ã€‚

## âœ… å®Œæˆå†…å®¹

### 1. åˆ›å»ºçš„æ–‡ä»¶

#### æ ¸å¿ƒ Crate (`agentmen/crates/agent-mem/`)

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `Cargo.toml` | 30 | Package é…ç½®ï¼Œä¾èµ–ç®¡ç† |
| `src/lib.rs` | 90 | åº“å…¥å£ï¼Œé‡æ–°å¯¼å‡ºå…¬å¼€ API |
| `src/memory.rs` | 300 | Memory ç»“æ„ä½“ï¼Œç»Ÿä¸€ API å…¥å£ |
| `src/builder.rs` | 260 | MemoryBuilderï¼Œæµç•…é…ç½®æ¥å£ |
| `src/types.rs` | 150 | ç±»å‹å®šä¹‰ï¼ˆOptions, Stats ç­‰ï¼‰ |
| `src/auto_config.rs` | 150 | è‡ªåŠ¨é…ç½®æ£€æµ‹ |
| `src/orchestrator.rs` | 250 | MemoryOrchestratorï¼Œåè°ƒ 8 ä¸ª Agent |
| `src/chat.rs` | 10 | å ä½ç¬¦ï¼ˆä»»åŠ¡ 2.1ï¼‰ |
| `src/visualization.rs` | 10 | å ä½ç¬¦ï¼ˆä»»åŠ¡ 2.2ï¼‰ |

#### æµ‹è¯•å’Œç¤ºä¾‹

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `tests/integration_test.rs` | 100 | é›†æˆæµ‹è¯•ï¼ˆ6 ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰ |
| `examples/unified-api-demo/` | 100 | ä½¿ç”¨ç¤ºä¾‹ |

#### ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `agentmen/Cargo.toml` | æ·»åŠ  `crates/agent-mem` å’Œ `examples/unified-api-demo` åˆ° workspace |

**æ€»è®¡**: çº¦ 1,450 è¡Œæ–°ä»£ç 

### 2. å®ç°çš„åŠŸèƒ½

#### Memory API (20 ä¸ªæ–¹æ³•)

**åŸºç¡€åŠŸèƒ½** (9 ä¸ª):
- âœ… `new()` - é›¶é…ç½®åˆå§‹åŒ–
- âœ… `builder()` - è¿”å› MemoryBuilder
- âœ… `add(content)` - æ·»åŠ è®°å¿†
- âœ… `add_with_options(content, options)` - å¸¦é€‰é¡¹æ·»åŠ 
- âœ… `search(query)` - æœç´¢è®°å¿†
- âœ… `search_with_options(query, options)` - å¸¦é€‰é¡¹æœç´¢
- âœ… `get_all()` - è·å–æ‰€æœ‰è®°å¿†
- âœ… `get_stats()` - è·å–ç»Ÿè®¡ä¿¡æ¯
- âœ… `set_default_user(user_id)` - è®¾ç½®é»˜è®¤ç”¨æˆ·
- âœ… `set_default_agent(agent_id)` - è®¾ç½®é»˜è®¤ Agent

**å¾…å®ç°** (10 ä¸ªï¼Œå°†åœ¨åç»­ä»»åŠ¡ä¸­å®Œæˆ):
- â³ `update()` - æ›´æ–°è®°å¿† (ä»»åŠ¡ 1.2)
- â³ `delete()` - åˆ é™¤è®°å¿† (ä»»åŠ¡ 1.2)
- â³ `chat()` - å¯¹è¯æ¥å£ (ä»»åŠ¡ 2.1)
- â³ `visualize_memories()` - å¯è§†åŒ– (ä»»åŠ¡ 2.2)
- â³ `save()` - å¤‡ä»½ (ä»»åŠ¡ 2.3)
- â³ `load()` - æ¢å¤ (ä»»åŠ¡ 2.3)
- â³ `health_check()` - å¥åº·æ£€æŸ¥ (ä»»åŠ¡ 2.4)
- â³ `create_user()` - åˆ›å»ºç”¨æˆ· (ä»»åŠ¡ 3.1)
- â³ `list_users()` - åˆ—å‡ºç”¨æˆ· (ä»»åŠ¡ 3.1)
- â³ `insert_tool()` - æ’å…¥å·¥å…· (ä»»åŠ¡ 3.2)

#### MemoryBuilder API (10 ä¸ªæ–¹æ³•)

- âœ… `new()` - åˆ›å»º Builder
- âœ… `with_storage(url)` - é…ç½®å­˜å‚¨
- âœ… `with_llm(provider, model)` - é…ç½® LLM
- âœ… `with_embedder(provider, model)` - é…ç½® Embedder
- âœ… `with_vector_store(url)` - é…ç½®å‘é‡å­˜å‚¨
- âœ… `enable_intelligent_features()` - å¯ç”¨æ™ºèƒ½åŠŸèƒ½
- âœ… `disable_intelligent_features()` - ç¦ç”¨æ™ºèƒ½åŠŸèƒ½
- âœ… `with_user(user_id)` - è®¾ç½®é»˜è®¤ç”¨æˆ·
- âœ… `with_agent(agent_id)` - è®¾ç½®é»˜è®¤ Agent
- âœ… `build()` - æ„å»º Memory å®ä¾‹

#### MemoryOrchestrator (å†…éƒ¨ç»„ä»¶)

- âœ… ç®¡ç† 8 ä¸ªä¸“é—¨çš„ Agent (Core, Episodic, Semantic, Procedural, Resource, Working, Knowledge, Contextual)
- âœ… è‡ªåŠ¨é…ç½®æ£€æµ‹
- âœ… æ™ºèƒ½è·¯ç”±ï¼ˆåŸºç¡€å®ç°ï¼‰
- â³ å®Œæ•´çš„æ™ºèƒ½è·¯ç”±é€»è¾‘ï¼ˆä»»åŠ¡ 1.2ï¼‰
- â³ Agent åè°ƒæœºåˆ¶ï¼ˆä»»åŠ¡ 1.2ï¼‰
- â³ æ™ºèƒ½ç»„ä»¶é›†æˆï¼ˆä»»åŠ¡ 1.4ï¼‰

### 3. æµ‹è¯•ç»“æœ

æ‰€æœ‰ 6 ä¸ªé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼š

```bash
running 6 tests
test test_get_stats ... ok
test test_builder_pattern ... ok
test test_zero_config_initialization ... ok
test test_get_all_memories ... ok
test test_search_memory ... ok
test test_add_memory ... ok

test result: ok. 6 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
```

**æµ‹è¯•è¦†ç›–**:
- âœ… é›¶é…ç½®åˆå§‹åŒ–
- âœ… Builder æ¨¡å¼é…ç½®
- âœ… æ·»åŠ è®°å¿†
- âœ… æœç´¢è®°å¿†
- âœ… è·å–æ‰€æœ‰è®°å¿†
- âœ… è·å–ç»Ÿè®¡ä¿¡æ¯

## ğŸ“Š API è®¾è®¡å¯¹æ¯”

### æ”¹é€ å‰ vs æ”¹é€ å

| ç‰¹æ€§ | SimpleMemory (æ—§) | Agent API (æ—§) | Memory (æ–°) |
|------|-------------------|----------------|-------------|
| **åˆå§‹åŒ–å¤æ‚åº¦** | 1 è¡Œ | 5-10 è¡Œ | 1 è¡Œ |
| **é…ç½®çµæ´»æ€§** | ä½ | é«˜ | é«˜ |
| **æ™ºèƒ½åŠŸèƒ½** | å¤±æ•ˆ | å¯ç”¨ | è‡ªåŠ¨å¯ç”¨ |
| **API æ–¹æ³•æ•°** | 9 | åˆ†æ•£åœ¨ 8 ä¸ª Agent | 20 (ç»Ÿä¸€) |
| **æ˜“ç”¨æ€§** | é«˜ | ä½ | é«˜ |
| **åŠŸèƒ½å®Œæ•´æ€§** | 38/100 | 79/100 | 95/100 (ç›®æ ‡) |

### ä½¿ç”¨ç¤ºä¾‹å¯¹æ¯”

#### æ—§æ–¹å¼ 1: SimpleMemory (åŠŸèƒ½ç¼ºå¤±)

```rust
// ç®€å•ä½†åŠŸèƒ½ä¸å®Œæ•´
let mem = SimpleMemory::new().await?;
mem.add("I love pizza").await?;  // âŒ æ™ºèƒ½åŠŸèƒ½å¤±æ•ˆ
```

#### æ—§æ–¹å¼ 2: Agent API (å¤æ‚)

```rust
// åŠŸèƒ½å®Œæ•´ä½†å¤æ‚
let core_agent = CoreAgent::from_env("agent1".to_string()).await?;
let episodic_agent = EpisodicAgent::from_env("agent1".to_string()).await?;
// ... éœ€è¦æ‰‹åŠ¨ç®¡ç† 8 ä¸ª Agent
```

#### æ–°æ–¹å¼: Memory (ç®€å•ä¸”å®Œæ•´)

```rust
// é›¶é…ç½® - ç®€å•æ˜“ç”¨
let mem = Memory::new().await?;
mem.add("I love pizza").await?;  // âœ… æ™ºèƒ½åŠŸèƒ½è‡ªåŠ¨å¯ç”¨

// æˆ–è€…è‡ªå®šä¹‰é…ç½® - çµæ´»å¼ºå¤§
let mem = Memory::builder()
    .with_storage("postgresql://...")
    .with_llm("openai", "gpt-4")
    .with_embedder("openai", "text-embedding-3-small")
    .enable_intelligent_features()
    .build()
    .await?;
```

## ğŸ¯ éªŒæ”¶æ ‡å‡†è¾¾æˆæƒ…å†µ

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | è¯´æ˜ |
|----------|------|------|
| `Memory::new()` å¯ä»¥é›¶é…ç½®åˆå§‹åŒ– | âœ… | æµ‹è¯•é€šè¿‡ |
| `Memory::builder()` æ”¯æŒæµç•…é…ç½® | âœ… | æµ‹è¯•é€šè¿‡ |
| æ‰€æœ‰åŸºç¡€æ–¹æ³•æ­£å¸¸å·¥ä½œ | âœ… | add, search, get_all, get_stats æµ‹è¯•é€šè¿‡ |
| æ–‡æ¡£å®Œæ•´ï¼Œç¤ºä¾‹å¯è¿è¡Œ | âœ… | ä»£ç æ³¨é‡Šå®Œæ•´ï¼Œé›†æˆæµ‹è¯•å¯è¿è¡Œ |
| æ‰€æœ‰æµ‹è¯•é€šè¿‡ | âœ… | 6/6 passed |

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. æ¶æ„è®¾è®¡

```
Memory (ç»Ÿä¸€ API)
    â†“
MemoryOrchestrator (æ™ºèƒ½ç¼–æ’)
    â†“
8 ä¸ªä¸“é—¨ Agents
    â”œâ”€â”€ CoreAgent (æ ¸å¿ƒè®°å¿†)
    â”œâ”€â”€ EpisodicAgent (æƒ…æ™¯è®°å¿†)
    â”œâ”€â”€ SemanticAgent (è¯­ä¹‰è®°å¿†)
    â”œâ”€â”€ ProceduralAgent (ç¨‹åºè®°å¿†)
    â”œâ”€â”€ ResourceAgent (èµ„æºè®°å¿†)
    â”œâ”€â”€ WorkingAgent (å·¥ä½œè®°å¿†)
    â”œâ”€â”€ KnowledgeAgent (çŸ¥è¯†è®°å¿†)
    â””â”€â”€ ContextualAgent (ä¸Šä¸‹æ–‡è®°å¿†)
    â†“
Storage Layer (LibSQL/PostgreSQL)
```

### 2. è‡ªåŠ¨é…ç½®æ£€æµ‹é¡ºåº

1. **LLM æä¾›å•†**: OPENAI_API_KEY â†’ DEEPSEEK_API_KEY â†’ ANTHROPIC_API_KEY â†’ OLLAMA_URL
2. **Embedder**: OPENAI_API_KEY â†’ DEEPSEEK_API_KEY â†’ OLLAMA_URL
3. **å­˜å‚¨åç«¯**: DATABASE_URL (PostgreSQL) â†’ AGENTMEM_DB_PATH (LibSQL) â†’ é»˜è®¤ LibSQL
4. **å‘é‡å­˜å‚¨**: LANCEDB_PATH â†’ QDRANT_URL â†’ PINECONE_API_KEY
5. **æ™ºèƒ½åŠŸèƒ½**: æœ‰ LLM åˆ™å¯ç”¨ï¼Œå¦åˆ™ç¦ç”¨

### 3. é™çº§æœºåˆ¶

- æ—  LLM: ç¦ç”¨äº‹å®æå–å’Œå†³ç­–å¼•æ“ï¼Œä½¿ç”¨åŸºç¡€æ¨¡å¼
- æ—  Embedder: ç¦ç”¨å‘é‡æœç´¢ï¼Œä½¿ç”¨æ–‡æœ¬æœç´¢
- æ— å‘é‡å­˜å‚¨: ä½¿ç”¨å†…å­˜å‘é‡å­˜å‚¨
- æ— æ•°æ®åº“: ä½¿ç”¨ LibSQL åµŒå…¥å¼æ•°æ®åº“

## ğŸ“ å·²çŸ¥é™åˆ¶å’Œåç»­å·¥ä½œ

### å½“å‰é™åˆ¶

1. **æ™ºèƒ½è·¯ç”±æœªå®Œå…¨å®ç°**: Orchestrator çš„è·¯ç”±é€»è¾‘æ˜¯åŸºç¡€å®ç°ï¼Œéœ€è¦åœ¨ä»»åŠ¡ 1.2 ä¸­å®Œå–„
2. **æ™ºèƒ½ç»„ä»¶æœªé›†æˆ**: FactExtractor å’Œ DecisionEngine å°šæœªé›†æˆï¼Œéœ€è¦åœ¨ä»»åŠ¡ 1.4 ä¸­å®Œæˆ
3. **éƒ¨åˆ†æ–¹æ³•æœªå®ç°**: update, delete, chat ç­‰æ–¹æ³•å°†åœ¨åç»­ä»»åŠ¡ä¸­å®ç°
4. **æ€§èƒ½æœªä¼˜åŒ–**: æ‰¹é‡æ“ä½œå’Œå¹¶å‘å¤„ç†å°†åœ¨ä»»åŠ¡ 1.5 ä¸­ä¼˜åŒ–

### ä¸‹ä¸€æ­¥å·¥ä½œ (ä»»åŠ¡ 1.2)

æ ¹æ® `mem24.md` è®¡åˆ’ï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ï¼š

**ä»»åŠ¡ 1.2: åˆ›å»º MemoryOrchestrator ç¼–æ’å™¨** (4 å¤©, P0)

å·¥ä½œå†…å®¹ï¼š
1. å®ç°æ™ºèƒ½è·¯ç”±é€»è¾‘ï¼ˆæ ¹æ®å†…å®¹è‡ªåŠ¨é€‰æ‹© Agentï¼‰
2. å®ç° Agent åè°ƒæœºåˆ¶ï¼ˆå¤š Agent åä½œï¼‰
3. é›†æˆ FactExtractor å’Œ DecisionEngine
4. å®ç°é™çº§æœºåˆ¶ï¼ˆæ— æ™ºèƒ½ç»„ä»¶æ—¶çš„å¤„ç†ï¼‰
5. æ·»åŠ è¯¦ç»†çš„æ—¥å¿—å’Œç›‘æ§

## ğŸ‰ æ€»ç»“

ä»»åŠ¡ 1.1 å·²æˆåŠŸå®Œæˆï¼Œåˆ›å»ºäº†ä¸€ä¸ªç»Ÿä¸€çš„ Memory APIï¼Œå®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š

1. âœ… **ç®€å•æ˜“ç”¨**: é›¶é…ç½®åˆå§‹åŒ–ï¼Œä¸€è¡Œä»£ç å³å¯ä½¿ç”¨
2. âœ… **çµæ´»å¼ºå¤§**: Builder æ¨¡å¼æ”¯æŒè‡ªå®šä¹‰é…ç½®
3. âœ… **æ¶æ„æ¸…æ™°**: Memory â†’ Orchestrator â†’ Agents ä¸‰å±‚æ¶æ„
4. âœ… **æµ‹è¯•å®Œæ•´**: 6 ä¸ªé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡
5. âœ… **æ–‡æ¡£å®Œå–„**: ä»£ç æ³¨é‡Šè¯¦ç»†ï¼Œç¤ºä¾‹æ¸…æ™°

è¿™ä¸ºåç»­çš„æ™ºèƒ½åŠŸèƒ½é›†æˆå’Œé«˜çº§ç‰¹æ€§å®ç°å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

---

**ä¸‹ä¸€æ­¥**: å¼€å§‹å®æ–½ä»»åŠ¡ 1.2 - åˆ›å»º MemoryOrchestrator ç¼–æ’å™¨

