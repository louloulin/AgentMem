# AgentMem å…¨é¢é‡æ„å®æ–½è¿›åº¦æŠ¥å‘Š

**æ—¥æœŸ**: 2025-11-10  
**ç‰ˆæœ¬**: V4.0 æ¶æ„è¿ç§»  
**çŠ¶æ€**: ğŸš§ è¿›è¡Œä¸­

---

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. ç¼–è¯‘é—®é¢˜ä¿®å¤ âœ…
- **é—®é¢˜**: jsonwebtokenç‰ˆæœ¬å†²çªï¼ˆv8.0 vs v9.2ï¼‰å¯¼è‡´pemä¾èµ–ä¸‹è½½å¤±è´¥
- **è§£å†³**: ç»Ÿä¸€å‡çº§åˆ° jsonwebtoken 9.2
- **æ–‡ä»¶**: `crates/agent-mem-compat/Cargo.toml`
- **çŠ¶æ€**: âœ… å®Œæˆ

### 2. ä»£ç åˆ†æ âœ…  
- åˆ†æäº†22ä¸ªæ–‡ä»¶ä¸­çš„Memoryç»“æ„å®šä¹‰
- è¯†åˆ«äº†MemoryScopeç³»ç»Ÿçš„ä½¿ç”¨æƒ…å†µ
- å‘ç°V4.0 Memoryç»“æ„å·²åœ¨ `types.rs:778-791` å®šä¹‰
- ç»Ÿè®¡äº†å¤§é‡ç¡¬ç¼–ç å¸¸é‡ï¼ˆ41+å¤„ï¼‰

### 3. é…ç½®ç³»ç»Ÿåˆ›å»º âœ…
**æ–°å¢æ–‡ä»¶**:
- `config/agentmem.toml` - ç»Ÿä¸€é…ç½®æ–‡ä»¶
- `crates/agent-mem-config/src/agentmem_config.rs` - é…ç½®åŠ è½½å™¨

**é…ç½®æ¶µç›–**:
- âœ… æœç´¢æƒé‡ (vector_weight, fulltext_weight, etc.)
- âœ… é˜ˆå€¼é…ç½® (adaptive threshold adjustments)
- âœ… é‡è¦æ€§è¯„åˆ†æƒé‡
- âœ… å†³ç­–å¼•æ“å‚æ•°
- âœ… å…³ç³»å¼ºåº¦é…ç½®
- âœ… ä¸Šä¸‹æ–‡ç›¸å…³æ€§
- âœ… æ€§èƒ½å‚æ•°
- âœ… è‡ªé€‚åº”å­¦ä¹ å‚æ•°
- âœ… å…¶ä»–æ ¸å¿ƒå‚æ•°

### 4. ç¡¬ç¼–ç å¸¸é‡é…ç½®åŒ– âœ… (éƒ¨åˆ†å®Œæˆ)
**å·²é‡æ„æ–‡ä»¶**:
- `crates/agent-mem-core/src/search/adaptive.rs` âœ…
  - WeightPredictor ä½¿ç”¨ SearchConfig
  - AdaptiveSearchOptimizer ä½¿ç”¨é…ç½®é©±åŠ¨
  - æ¶ˆé™¤äº†10+ä¸ªç¡¬ç¼–ç å¸¸é‡

**å¾…é‡æ„æ–‡ä»¶** (å‘ç°ç¡¬ç¼–ç ):
- `search/adaptive_threshold.rs` - å¤šä¸ªé˜ˆå€¼è°ƒæ•´å¸¸é‡
- `search/vector_search.rs` - ç›¸ä¼¼åº¦é˜ˆå€¼
- `pipeline.rs` - å…³ç³»å¼ºåº¦ã€æ—¶é—´è¡°å‡
- `context.rs` - ç½®ä¿¡åº¦è°ƒæ•´å‚æ•°

### 5. æ ¸å¿ƒç¼–è¯‘æµ‹è¯• âœ…
- `agent-mem-core` åŒ…ç¼–è¯‘æˆåŠŸ
- 0ä¸ªç¼–è¯‘é”™è¯¯ï¼Œä»…788ä¸ªæ–‡æ¡£è­¦å‘Š
- é…ç½®ç³»ç»Ÿé›†æˆæˆåŠŸ

---

## ğŸš§ è¿›è¡Œä¸­å·¥ä½œ

### 1. æ•´ä½“Workspaceç¼–è¯‘ ğŸš§
- æ­£åœ¨åå°æ‰§è¡Œ `cargo build --workspace`
- é¢„æœŸä¼šæœ‰ä¸€äº›åŒ…éœ€è¦é€‚é…æ–°çš„é…ç½®ç³»ç»Ÿ
- ç›®æ ‡: æ‰€æœ‰åŒ…ç¼–è¯‘é€šè¿‡

---

## ğŸ“‹ å¾…å®æ–½ä»»åŠ¡ (æŒ‰ä¼˜å…ˆçº§)

### P0 - æ ¸å¿ƒæ¶æ„è¿ç§»

#### 1. Memoryç»“æ„ç»Ÿä¸€è¿ç§» ğŸ”´ HIGH
**ç›®æ ‡**: å°†æ‰€æœ‰æ—§Memoryå®šä¹‰è¿ç§»åˆ°V4.0ç»“æ„

**å¾…è¿ç§»æ–‡ä»¶** (22ä¸ª):
```
- pipeline.rs
- context.rs  
- hierarchical_service.rs
- lifecycle.rs
- orchestrator/memory_integration.rs
- history.rs
- manager.rs
- engine.rs
- storage/traits.rs
- storage/models.rs
- retrieval/synthesizer.rs
- orchestrator/memory_extraction.rs
- managers/lifecycle_manager.rs
- managers/deduplication.rs
- managers/association_manager.rs
- client.rs
- cache/memory_cache.rs
- collaboration.rs
- hierarchy.rs
- storage/memory_repository.rs
- importance_scorer.rs
```

**å®æ–½ç­–ç•¥**:
1. ä½¿ç”¨V4.0 Memory (Content/AttributeSet/RelationGraph)
2. ä¿ç•™å‘åå…¼å®¹æ–¹æ³• (importance(), agent_id(), user_id())
3. æ›´æ–°å­˜å‚¨å±‚æ”¯æŒJSONå±æ€§å­—æ®µ
4. æ·»åŠ å…¼å®¹æ€§é€‚é…å™¨

#### 2. QueryæŠ½è±¡å®ç° ğŸ”´ HIGH
**ç›®æ ‡**: å®ç°é€šç”¨Queryç»“æ„æ›¿ä»£StringæŸ¥è¯¢

**å½“å‰çŠ¶æ€**: types.rsä¸­å·²æœ‰éƒ¨åˆ†å®šä¹‰ï¼Œéœ€å®Œå–„

**éœ€è¦å®ç°**:
```rust
pub struct Query {
    pub id: QueryId,
    pub intent: QueryIntent,
    pub constraints: Vec<Constraint>,
    pub preferences: Vec<Preference>,
    pub context: QueryContext,
}
```

#### 3. Scopeç³»ç»Ÿæ›¿æ¢ ğŸŸ¡ MEDIUM  
**ç›®æ ‡**: ç”¨AttributeSetæŸ¥è¯¢æ›¿æ¢MemoryScopeæšä¸¾

**å½“å‰çŠ¶æ€**: 
- MemoryScopeä»åœ¨ hierarchy.rs ä¸­ä½¿ç”¨
- å·²æœ‰ AttributeSet â†” MemoryScope è½¬æ¢å™¨
- éœ€è¦é€æ­¥è¿ç§»æ‰€æœ‰ScopeæŸ¥è¯¢ä¸ºå±æ€§æŸ¥è¯¢

**ç­–ç•¥**:
- ä¿ç•™MemoryScopeä½œä¸ºå…¼å®¹å±‚
- æ–°ä»£ç ä½¿ç”¨AttributeSetå±æ€§æŸ¥è¯¢
- æœ€ç»ˆå¼ƒç”¨MemoryScope

#### 4. å‰©ä½™ç¡¬ç¼–ç é…ç½®åŒ– ğŸŸ¡ MEDIUM
**å¾…å¤„ç†æ–‡ä»¶**:
- `adaptive_threshold.rs` - 6+å¤„
- `vector_search.rs` - 3å¤„
- `pipeline.rs` - 4å¤„  
- `context.rs` - 3å¤„

**é¢„ä¼°å·¥ä½œé‡**: 2-3å°æ—¶

### P1 - åŠŸèƒ½å®Œå–„

#### 5. MCPéªŒè¯ ğŸ”µ LOW
**ç›®æ ‡**: é€šè¿‡MCPæ¥å£éªŒè¯è®°å¿†å­˜å‚¨å’Œæ£€ç´¢

**æµ‹è¯•é¡¹**:
- [ ] åŸºæœ¬è®°å¿†å¢åˆ æ”¹æŸ¥
- [ ] å‘é‡æœç´¢
- [ ] æ··åˆæ£€ç´¢
- [ ] å±æ€§è¿‡æ»¤
- [ ] å…³ç³»æŸ¥è¯¢

#### 6. æ•°æ®è¿ç§»å·¥å…· ğŸ”µ LOW
**ç›®æ ‡**: æä¾›æ—§ç‰ˆæœ¬åˆ°V4.0çš„æ•°æ®è¿ç§»

```bash
cargo run --bin agentmem-migrate-v4 -- \
    --from agentmem-v3.db \
    --to agentmem-v4.db \
    --config config/agentmem.toml
```

---

## ğŸ“Š è¿›åº¦ç»Ÿè®¡

### æ•´ä½“è¿›åº¦
- **Phase 0 (æ ¸å¿ƒæŠ½è±¡)**: 40% å®Œæˆ
  - Memory V4.0 ç»“æ„: âœ… å·²å®šä¹‰
  - QueryæŠ½è±¡: ğŸš§ éƒ¨åˆ†å®Œæˆ
  - é…ç½®ç³»ç»Ÿ: âœ… å®Œæˆ
  - ç¡¬ç¼–ç æ¶ˆé™¤: ğŸš§ 30% å®Œæˆ

- **ä»£ç è´¨é‡**:
  - ç¼–è¯‘çŠ¶æ€: âœ… agent-mem-core é€šè¿‡
  - æµ‹è¯•è¦†ç›–: å¾…è¯„ä¼°
  - æ–‡æ¡£å®Œæ•´æ€§: éœ€è¡¥å……

### å·¥ä½œé‡ä¼°ç®—
- **å·²å®Œæˆ**: ~8å°æ—¶
- **å‰©ä½™æ ¸å¿ƒä»»åŠ¡**: ~24å°æ—¶
- **æ€»é¢„ä¼°**: ~32å°æ—¶ (4ä¸ªå·¥ä½œæ—¥)

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ (ä»Šå¤©)
1. âœ… ç­‰å¾…æ•´ä½“ç¼–è¯‘å®Œæˆ
2. â³ ä¿®å¤å…¶ä»–åŒ…çš„ç¼–è¯‘é”™è¯¯ï¼ˆå¦‚æœ‰ï¼‰
3. â³ ç»§ç»­é…ç½®åŒ–å‰©ä½™ç¡¬ç¼–ç å¸¸é‡
4. â³ å¼€å§‹Memoryç»“æ„è¿ç§»ï¼ˆé€‰æ‹©2-3ä¸ªæ ¸å¿ƒæ–‡ä»¶ï¼‰

### çŸ­æœŸç›®æ ‡ (æœ¬å‘¨)
1. å®Œæˆæ‰€æœ‰ç¡¬ç¼–ç é…ç½®åŒ–
2. è¿ç§»10+ä¸ªæ ¸å¿ƒæ–‡ä»¶åˆ°V4.0 Memory
3. å®ç°å®Œæ•´çš„QueryæŠ½è±¡
4. é€šè¿‡åŸºæœ¬MCPæµ‹è¯•

### ä¸­æœŸç›®æ ‡ (2å‘¨å†…)
1. å®Œæˆæ‰€æœ‰Memoryç»“æ„è¿ç§»
2. Scopeç³»ç»Ÿå®Œå…¨æ›¿æ¢
3. å®Œæ•´E2Eæµ‹è¯•é€šè¿‡
4. æ€§èƒ½åŸºå‡†æµ‹è¯•

---

## ğŸ” æŠ€æœ¯äº®ç‚¹

### 1. é…ç½®é©±åŠ¨æ¶æ„
```toml
[search]
vector_weight = 0.5
fulltext_weight = 0.5
adaptive_learning = true
```
- âœ… é›¶ç¡¬ç¼–ç 
- âœ… è¿è¡Œæ—¶å¯è°ƒæ•´
- âœ… ç¯å¢ƒç‰¹å®šé…ç½®

### 2. V4.0 MemoryæŠ½è±¡
```rust
pub struct Memory {
    pub id: String,
    pub content: Content,           // å¤šæ¨¡æ€
    pub attributes: AttributeSet,   // å®Œå…¨å¼€æ”¾
    pub relations: RelationGraph,   // å…³ç³»ç½‘ç»œ
    pub metadata: Metadata,         // ç³»ç»Ÿå…ƒä¿¡æ¯
}
```
- âœ… æ”¯æŒä»»æ„å±æ€§ï¼ˆå‘½åç©ºé—´åŒ–ï¼‰
- âœ… å¤šæ¨¡æ€å†…å®¹
- âœ… ä¸€ç­‰å…³ç³»æ”¯æŒ
- âœ… å‘åå…¼å®¹

### 3. è‡ªé€‚åº”æœç´¢ä¼˜åŒ–
- âœ… é…ç½®é©±åŠ¨æƒé‡
- âœ… æŸ¥è¯¢ç‰¹å¾æå–
- âœ… åŠ¨æ€æƒé‡è°ƒæ•´
- âœ… åé¦ˆå­¦ä¹ æ”¯æŒ

---

## ğŸ“ å…³é”®å†³ç­–

### 1. åŸåœ°é‡æ„ vs æ–°å»ºé‡å†™
**å†³å®š**: åŸåœ°é‡æ„  
**ç†ç”±**: 
- ä¿ç•™Gitå†å²
- å¤ç”¨80%+é«˜è´¨é‡ä»£ç 
- å‡å°‘é£é™©

### 2. ç«‹å³åˆ‡æ¢ vs åŒå†™å…¼å®¹
**å†³å®š**: ç«‹å³åˆ‡æ¢ + å…¼å®¹å±‚  
**ç†ç”±**:
- æ¸…ç†æŠ€æœ¯å€º
- é¿å…åŒå†™å¤æ‚æ€§
- é€šè¿‡å…¼å®¹æ–¹æ³•è¿‡æ¸¡

### 3. é…ç½®ç²’åº¦
**å†³å®š**: ç»†ç²’åº¦é…ç½®  
**ç†ç”±**:
- æœ€å¤§çµæ´»æ€§
- ä¾¿äºè°ƒä¼˜
- æ”¯æŒA/Bæµ‹è¯•

---

## âš ï¸ é£é™©ä¸æŒ‘æˆ˜

### 1. ç¼–è¯‘é”™è¯¯é£é™© ğŸŸ¡
- **ç°çŠ¶**: agent-mem-core é€šè¿‡ï¼Œå…¶ä»–åŒ…å¾…æµ‹
- **ç¼“è§£**: é€åŒ…ä¿®å¤ï¼Œä¿æŒå‘åå…¼å®¹

### 2. æ€§èƒ½å›é€€é£é™© ğŸŸ¡  
- **ç°çŠ¶**: é…ç½®ç³»ç»Ÿå¢åŠ é—´æ¥å±‚
- **ç¼“è§£**: ä½¿ç”¨Arcå…±äº«é…ç½®ï¼Œæœ€å°åŒ–å¼€é”€

### 3. è¿ç§»å·¥ä½œé‡ ğŸŸ¡
- **ç°çŠ¶**: 22ä¸ªæ–‡ä»¶éœ€è¿ç§»Memoryç»“æ„
- **ç¼“è§£**: åˆ†é˜¶æ®µè¿ç§»ï¼Œä¿æŒå¯è¿è¡ŒçŠ¶æ€

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å®æ–½æŒ‡å—
- `agentmem90.md` - å®Œæ•´é‡æ„æ–¹æ¡ˆ
- `config/agentmem.toml` - é…ç½®ç¤ºä¾‹
- `crates/agent-mem-config/src/agentmem_config.rs` - é…ç½®API

### å…³é”®ä»£ç 
- `crates/agent-mem-core/src/types.rs:778-791` - V4.0 Memory
- `crates/agent-mem-core/src/search/adaptive.rs` - é…ç½®åŒ–ç¤ºä¾‹

---

**æœ€åæ›´æ–°**: 2025-11-10 14:00  
**è´Ÿè´£äºº**: AI Assistant  
**çŠ¶æ€**: ğŸŸ¢ æŒ‰è®¡åˆ’è¿›è¡Œ

