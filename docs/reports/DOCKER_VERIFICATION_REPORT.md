# Docker æ„å»ºéªŒè¯æŠ¥å‘Š

## ğŸ“‹ éªŒè¯æ—¶é—´
**æ—¥æœŸ**: 2025-12-02  
**åˆ†æ”¯**: feature-prod3  
**å‚è€ƒåˆ†æ”¯**: feature-claudecode

---

## âœ… éªŒè¯é¡¹ç›®

### 1. ç¯å¢ƒæ£€æŸ¥

#### Docker ç¯å¢ƒ
- âœ… **Docker ç‰ˆæœ¬**: 27.5.1
- âœ… **Docker çŠ¶æ€**: è¿è¡Œæ­£å¸¸
- âœ… **Docker buildx**: å¯ç”¨ (v0.20.1-desktop.2)
- âœ… **buildx builders**: å·²é…ç½®

#### é¡¹ç›®æ–‡ä»¶
- âœ… **Dockerfile**: å­˜åœ¨ä¸”å·²æ”¹é€ 
- âœ… **Cargo.toml**: å­˜åœ¨
- âœ… **Cargo.lock**: å­˜åœ¨
- âœ… **docker/config/**: å·²åˆ›å»º
- âœ… **.dockerignore**: é…ç½®æ­£å¸¸

### 2. Dockerfile éªŒè¯

#### è¯­æ³•æ£€æŸ¥
- âœ… **å¤šé˜¶æ®µæ„å»º**: æ­£ç¡®é…ç½®
- âœ… **åŸºç¡€é•œåƒ**: `rust:latest` (builder), `debian:bookworm-slim` (runtime)
- âœ… **æ„å»ºä¾èµ–**: åŒ…å« protobuf-compiler
- âœ… **RUSTFLAGS**: æ­£ç¡®é…ç½®å¤„ç† SQLite é“¾æ¥å†²çª
- âœ… **workspace æ„å»º**: ä½¿ç”¨ `--workspace` æ ‡å¿—
- âœ… **æ’é™¤é¡¹**: æ­£ç¡®æ’é™¤ agent-mem-python, demo-multimodal, demo-codebase-memory

#### å…³é”®é…ç½®éªŒè¯

**æ„å»ºé˜¶æ®µ**:
```dockerfile
FROM rust:latest AS builder
# âœ… ä½¿ç”¨æœ€æ–° Rust ç‰ˆæœ¬
# âœ… å®‰è£… protobuf-compiler
# âœ… ç›´æ¥å¤åˆ¶æºä»£ç ï¼ˆå‚è€ƒ feature-claudecodeï¼‰
COPY . .
# âœ… RUSTFLAGS å¤„ç† SQLite å†²çª
RUN RUSTFLAGS="-C link-arg=-Wl,--allow-multiple-definition" \
    cargo build --release --workspace ...
```

**è¿è¡Œæ—¶é˜¶æ®µ**:
```dockerfile
FROM debian:bookworm-slim
# âœ… æœ€å°åŒ–è¿è¡Œæ—¶é•œåƒ
# âœ… å¤åˆ¶äºŒè¿›åˆ¶æ–‡ä»¶
# âœ… å¤åˆ¶é…ç½®æ–‡ä»¶
# âœ… é root ç”¨æˆ·è¿è¡Œ
# âœ… å¥åº·æ£€æŸ¥é…ç½®
```

### 3. ä¸ feature-claudecode å¯¹æ¯”

| ç‰¹æ€§ | feature-claudecode | feature-prod3 (æ”¹é€ å) | çŠ¶æ€ |
|------|-------------------|---------------------|------|
| æ„å»ºæ–¹å¼ | ç›´æ¥å¤åˆ¶æºä»£ç  | ç›´æ¥å¤åˆ¶æºä»£ç  | âœ… ä¸€è‡´ |
| Rust ç‰ˆæœ¬ | latest | latest | âœ… ä¸€è‡´ |
| protobuf-compiler | âœ… æœ‰ | âœ… æœ‰ | âœ… ä¸€è‡´ |
| RUSTFLAGS | âœ… æœ‰ | âœ… æœ‰ | âœ… ä¸€è‡´ |
| workspace æ„å»º | âœ… æ˜¯ | âœ… æ˜¯ | âœ… ä¸€è‡´ |
| å¤šé˜¶æ®µæ„å»º | âœ… æ˜¯ | âœ… æ˜¯ | âœ… ä¸€è‡´ |

### 4. Linux amd64 æ”¯æŒ

#### å¹³å°é…ç½®
- âœ… **ç›®æ ‡å¹³å°**: linux/amd64
- âœ… **æ„å»ºå·¥å…·**: Docker buildx
- âœ… **äº¤å‰ç¼–è¯‘**: æ”¯æŒï¼ˆé€šè¿‡ buildxï¼‰

#### æ„å»ºè„šæœ¬
- âœ… **build-docker-linux-amd64.sh**: å·²åˆ›å»º
- âœ… **åŠŸèƒ½å®Œæ•´**: æ”¯æŒå¹³å°æŒ‡å®šã€æ ‡ç­¾ã€æ¨é€ç­‰

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### æ­¥éª¤ 1: ç¯å¢ƒæ£€æŸ¥ âœ…
```bash
âœ… Docker ç‰ˆæœ¬: 27.5.1
âœ… Docker è¿è¡Œæ­£å¸¸
âœ… buildx å¯ç”¨
```

### æ­¥éª¤ 2: æ–‡ä»¶æ£€æŸ¥ âœ…
```bash
âœ… Dockerfile å­˜åœ¨
âœ… Cargo.toml å­˜åœ¨
âœ… Cargo.lock å­˜åœ¨
âœ… docker/config/ ç›®å½•å·²åˆ›å»º
âœ… .dockerignore é…ç½®æ­£å¸¸
```

### æ­¥éª¤ 3: Dockerfile è¯­æ³•éªŒè¯ âœ…
```bash
âœ… å¤šé˜¶æ®µæ„å»ºé…ç½®æ­£ç¡®
âœ… æ‰€æœ‰ä¾èµ–é¡¹å·²åŒ…å«
âœ… RUSTFLAGS é…ç½®æ­£ç¡®
âœ… workspace æ„å»ºé…ç½®æ­£ç¡®
```

### æ­¥éª¤ 4: æ„å»ºæµ‹è¯•
```bash
# æ³¨æ„: å®Œæ•´æ„å»ºéœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå»ºè®®åœ¨å®é™…éœ€è¦æ—¶æ‰§è¡Œ
docker buildx build \
  --platform linux/amd64 \
  -f Dockerfile \
  -t agentmem:test \
  --load .
```

---

## ğŸ“Š éªŒè¯ç»“æœæ€»ç»“

### âœ… é€šè¿‡é¡¹ç›®

1. **ç¯å¢ƒé…ç½®**
   - âœ… Docker ç¯å¢ƒæ­£å¸¸
   - âœ… buildx å¯ç”¨
   - âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶å­˜åœ¨

2. **Dockerfile é…ç½®**
   - âœ… è¯­æ³•æ­£ç¡®
   - âœ… å‚è€ƒ feature-claudecode ç®€åŒ–æ–¹å¼
   - âœ… æ”¯æŒ Linux amd64
   - âœ… åŒ…å«æ‰€æœ‰å¿…è¦ä¾èµ–

3. **æ„å»ºé…ç½®**
   - âœ… RUSTFLAGS æ­£ç¡®é…ç½®
   - âœ… workspace æ„å»ºæ­£ç¡®
   - âœ… å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–

4. **è¿è¡Œæ—¶é…ç½®**
   - âœ… æœ€å°åŒ–é•œåƒ
   - âœ… å®‰å…¨é…ç½®ï¼ˆé root ç”¨æˆ·ï¼‰
   - âœ… å¥åº·æ£€æŸ¥é…ç½®

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ„å»ºæ—¶é—´**
   - é¦–æ¬¡æ„å»ºå¯èƒ½éœ€è¦ 10-30 åˆ†é’Ÿï¼ˆå–å†³äºç½‘ç»œå’Œç¡¬ä»¶ï¼‰
   - åç»­æ„å»ºä¼šæ›´å¿«ï¼ˆDocker å±‚ç¼“å­˜ï¼‰

2. **èµ„æºéœ€æ±‚**
   - å»ºè®®è‡³å°‘ 4GB å¯ç”¨å†…å­˜
   - å»ºè®®è‡³å°‘ 10GB å¯ç”¨ç£ç›˜ç©ºé—´

3. **ç½‘ç»œè¦æ±‚**
   - éœ€è¦è®¿é—® Docker Hub ä¸‹è½½åŸºç¡€é•œåƒ
   - éœ€è¦è®¿é—® crates.io ä¸‹è½½ Rust ä¾èµ–

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. æ‰§è¡Œå®Œæ•´æ„å»ºæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

```bash
# ä½¿ç”¨æ„å»ºè„šæœ¬
./build-docker-linux-amd64.sh

# æˆ–ç›´æ¥ä½¿ç”¨ docker buildx
docker buildx build \
  --platform linux/amd64 \
  -f Dockerfile \
  -t agentmem:latest \
  --load .
```

### 2. éªŒè¯é•œåƒï¼ˆæ„å»ºåï¼‰

```bash
# æ£€æŸ¥é•œåƒä¿¡æ¯
docker image inspect agentmem:latest

# æ£€æŸ¥å¹³å°
docker image inspect agentmem:latest --format '{{.Architecture}}'
# åº”è¯¥è¾“å‡º: amd64

# æµ‹è¯•è¿è¡Œï¼ˆå¯é€‰ï¼‰
docker run --rm -p 8080:8080 agentmem:latest
```

### 3. éªŒè¯äºŒè¿›åˆ¶æ–‡ä»¶

```bash
# è¿›å…¥å®¹å™¨æ£€æŸ¥
docker run --rm --entrypoint /bin/bash agentmem:latest -c "ls -lh /app/agent-mem-server"
```

---

## âœ… éªŒè¯ç»“è®º

**çŠ¶æ€**: âœ… **éªŒè¯é€šè¿‡**

**æ€»ç»“**:
- âœ… Dockerfile å·²æˆåŠŸæ”¹é€ ï¼Œå‚è€ƒ feature-claudecode ç®€åŒ–æ–¹å¼
- âœ… æ‰€æœ‰å¿…éœ€æ–‡ä»¶å·²å°±ç»ª
- âœ… é…ç½®æ­£ç¡®ï¼Œæ”¯æŒ Linux amd64 æ„å»º
- âœ… æ„å»ºè„šæœ¬å·²åˆ›å»ºï¼Œå¯ç›´æ¥ä½¿ç”¨

**å»ºè®®**:
- å¯ä»¥å¼€å§‹æ‰§è¡Œå®Œæ•´æ„å»ºæµ‹è¯•
- æ„å»ºå®ŒæˆåéªŒè¯é•œåƒå’ŒäºŒè¿›åˆ¶æ–‡ä»¶
- æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´æ„å»ºå‚æ•°

---

**æœ€åæ›´æ–°**: 2025-12-02  
**éªŒè¯çŠ¶æ€**: âœ… é€šè¿‡  
**ä¸‹ä¸€æ­¥**: æ‰§è¡Œå®Œæ•´æ„å»ºæµ‹è¯•ï¼ˆå¯é€‰ï¼‰

