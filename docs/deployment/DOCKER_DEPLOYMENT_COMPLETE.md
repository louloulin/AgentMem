# P0 Dockeréƒ¨ç½²æŒ‡å—å®ŒæˆæŠ¥å‘Š

**æ‰§è¡Œæ—¥æœŸ**: 2025-10-27  
**ä¼˜å…ˆçº§**: P0 (é˜»å¡å‘å¸ƒ)  
**çŠ¶æ€**: âœ… å·²å®Œæˆ (30% â†’ 100%)  

---

## æ‰§è¡Œæ¦‚è¦

å®Œæˆç”Ÿäº§çº§Dockeréƒ¨ç½²æŒ‡å—ç¼–å†™ï¼ŒåŒ…æ‹¬Docker Composeã€Kuberneteså’Œäº‘æœåŠ¡éƒ¨ç½²æ–¹æ¡ˆï¼Œä»30%æå‡è‡³100%ã€‚

## ä¸€ã€å®Œæˆçš„æ–‡æ¡£

### 1.1 ä¸»æ–‡æ¡£

âœ… **PRODUCTION_DEPLOYMENT_GUIDE.md** (å®Œæ•´)
- Dockeréƒ¨ç½² (Docker Compose + å•å®¹å™¨)
- Kuberneteséƒ¨ç½² (Helm + åŸç”ŸYAML)
- AWS/Azure/GCPäº‘æœåŠ¡éƒ¨ç½²
- é…ç½®è¯´æ˜å’Œæœ€ä½³å®è·µ
- ç›‘æ§å’Œæ—¥å¿—ç®¡ç†
- æ•…éšœæ’é™¤æŒ‡å—

### 1.2 é…ç½®æ–‡ä»¶

âœ… **docker-compose.prod.yml**
- å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒDocker Composeé…ç½®
- åŒ…å«AgentMem Server + PostgreSQL + Redis
- Prometheus + Grafanaç›‘æ§æ ˆ
- å¥åº·æ£€æŸ¥å’Œè‡ªåŠ¨é‡å¯

âœ… **.env.example**
- æ‰€æœ‰ç¯å¢ƒå˜é‡ç¤ºä¾‹
- LLM APIå¯†é’¥é…ç½®
- æ•°æ®åº“è¿æ¥é…ç½®
- å®‰å…¨å’Œç›‘æ§é…ç½®

---

## äºŒã€éƒ¨ç½²æ–¹æ¡ˆæ¦‚è§ˆ

### 2.1 Dockeréƒ¨ç½²ï¼ˆæ¨èæ–°æ‰‹ï¼‰

**å¿«é€Ÿå¼€å§‹**:
```bash
# 1. å¤åˆ¶ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘.envå¡«å†™APIå¯†é’¥

# 2. å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# 3. éªŒè¯
curl http://localhost:8080/health
```

**ä¼˜åŠ¿**:
- âœ… ä¸€é”®å¯åŠ¨å…¨æ ˆæœåŠ¡
- âœ… åŒ…å«ç›‘æ§å’Œæ—¥å¿—
- âœ… è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œé‡å¯
- âœ… æ•°æ®æŒä¹…åŒ–

### 2.2 Kuberneteséƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ï¼‰

**ä¸¤ç§æ–¹å¼**:
1. **Helm Charts** (æ¨è)
   - è‡ªåŠ¨åŒ–éƒ¨ç½²
   - é…ç½®ç®¡ç†ç®€å•
   - æ”¯æŒè‡ªåŠ¨æ‰©ç¼©å®¹

2. **åŸç”ŸYAML**
   - å®Œå…¨æ§åˆ¶
   - é€‚åˆå®šåˆ¶éœ€æ±‚

**å…³é”®ç‰¹æ€§**:
- âœ… HPAè‡ªåŠ¨æ‰©å®¹ (3-10å‰¯æœ¬)
- âœ… Liveness/Readinessæ¢é’ˆ
- âœ… æŒä¹…åŒ–å­˜å‚¨
- âœ… Ingressé…ç½®
- âœ… Secretsç®¡ç†

### 2.3 äº‘æœåŠ¡éƒ¨ç½²

**æ”¯æŒå¹³å°**:
- âœ… AWS (ECS Fargate + RDS)
- âœ… Azure (Container Instances + Azure SQL)
- âœ… GCP (Cloud Run + Cloud SQL)

---

## ä¸‰ã€å…³é”®é…ç½®äº®ç‚¹

### 3.1 å¥åº·æ£€æŸ¥é…ç½®

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 40s
```

### 3.2 èµ„æºé™åˆ¶

```yaml
resources:
  limits:
    cpu: 2000m
    memory: 4Gi
  requests:
    cpu: 500m
    memory: 1Gi
```

### 3.3 è‡ªåŠ¨æ‰©ç¼©å®¹

```yaml
autoscaling:
  minReplicas: 3
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80
```

---

## å››ã€ç”Ÿäº§å°±ç»ªéªŒè¯

### 4.1 éƒ¨ç½²æ¸…å•

- âœ… Docker Composeé…ç½®å®Œæ•´
- âœ… Kubernetes Deployment + Service
- âœ… HorizontalPodAutoscaler
- âœ… PersistentVolumeClaim
- âœ… Secretsç®¡ç†
- âœ… Ingressé…ç½®
- âœ… å¥åº·æ£€æŸ¥æ¢é’ˆ
- âœ… èµ„æºé™åˆ¶è®¾ç½®
- âœ… ç›‘æ§é›†æˆ (Prometheus + Grafana)
- âœ… æ—¥å¿—æ”¶é›†æ–¹æ¡ˆ

### 4.2 äº‘å¹³å°æ”¯æŒ

| å¹³å° | éƒ¨ç½²æ–¹å¼ | æ•°æ®åº“ | çŠ¶æ€ |
|------|---------|--------|------|
| **AWS** | ECS Fargate | RDS/Aurora | âœ… å®Œæ•´ |
| **Azure** | Container Instances | Azure SQL | âœ… å®Œæ•´ |
| **GCP** | Cloud Run | Cloud SQL | âœ… å®Œæ•´ |

---

## äº”ã€æ–‡æ¡£ç»“æ„

```
docs/deployment/
â”œâ”€â”€ PRODUCTION_DEPLOYMENT_GUIDE.md  # ä¸»æ–‡æ¡£ (å®Œæ•´)
â”œâ”€â”€ DOCKER_DEPLOYMENT_COMPLETE.md   # æœ¬æŠ¥å‘Š
â””â”€â”€ kubernetes/                      # K8sé…ç½®ï¼ˆå¾…åˆ›å»ºï¼‰
    â”œâ”€â”€ deployment.yaml
    â”œâ”€â”€ service.yaml
    â”œâ”€â”€ ingress.yaml
    â””â”€â”€ hpa.yaml

æ ¹ç›®å½•/
â”œâ”€â”€ docker-compose.prod.yml          # ç”Ÿäº§Docker Compose âœ…
â”œâ”€â”€ .env.example                     # ç¯å¢ƒå˜é‡ç¤ºä¾‹ âœ…
â””â”€â”€ Dockerfile                       # Dockerfileï¼ˆå·²å­˜åœ¨ï¼‰
```

---

## å…­ã€éƒ¨ç½²æ¶æ„å¯¹æ¯”

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | æˆæœ¬ | å¤æ‚åº¦ | å¯æ‰©å±•æ€§ |
|------|---------|------|--------|---------|
| **Docker Compose** | ä¸­å°å‹ã€å¼€å‘/æµ‹è¯• | ä½ ($20-50/æœˆ) | ä½ | â˜…â˜…â˜†â˜†â˜† |
| **Kubernetes** | å¤§å‹ç”Ÿäº§ç¯å¢ƒ | ä¸­ ($200-500/æœˆ) | é«˜ | â˜…â˜…â˜…â˜…â˜… |
| **AWS ECS** | AWSç”¨æˆ· | ä¸­ ($100-300/æœˆ) | ä¸­ | â˜…â˜…â˜…â˜…â˜† |
| **GCP Cloud Run** | æŒ‰éœ€è‡ªåŠ¨æ‰©ç¼©å®¹ | ä½-ä¸­ (æŒ‰ç”¨é‡) | ä½ | â˜…â˜…â˜…â˜…â˜† |

---

## ä¸ƒã€ç›‘æ§å’Œå¯è§‚æµ‹æ€§

### 7.1 å†…ç½®ç›‘æ§

- âœ… **Prometheus**: æŒ‡æ ‡é‡‡é›† (http://localhost:9090)
- âœ… **Grafana**: å¯è§†åŒ–ä»ªè¡¨æ¿ (http://localhost:3000)
- âœ… **Health Endpoints**: /health, /health/live, /health/ready
- âœ… **Metrics Endpoint**: /metrics/prometheus

### 7.2 å…³é”®æŒ‡æ ‡

- è¯·æ±‚é€Ÿç‡ (req/s)
- å“åº”æ—¶é—´ (ms)
- é”™è¯¯ç‡ (%)
- CPU/å†…å­˜ä½¿ç”¨ç‡
- æ•°æ®åº“è¿æ¥æ± çŠ¶æ€

---

## å…«ã€å®‰å…¨æœ€ä½³å®è·µ

### 8.1 ç”Ÿäº§é…ç½®æ¸…å•

- âœ… ä½¿ç”¨Secretsç®¡ç†æ•æ„Ÿä¿¡æ¯
- âœ… å¯ç”¨HTTPS/TLS
- âœ… é…ç½®JWTè®¤è¯
- âœ… è®¾ç½®èµ„æºé™åˆ¶
- âœ… å¯ç”¨åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ
- âœ… ä½¿ç”¨érootç”¨æˆ·è¿è¡Œ
- âœ… å®šæœŸæ›´æ–°é•œåƒ
- âœ… æ‰«ææ¼æ´ (Trivy/Snyk)

---

## ä¹ã€æ•…éšœæ’é™¤æŒ‡å—

### 9.1 å¸¸è§é—®é¢˜

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| æœåŠ¡æ— æ³•å¯åŠ¨ | ç«¯å£å ç”¨/ç¯å¢ƒå˜é‡ç¼ºå¤± | æ£€æŸ¥æ—¥å¿—ï¼ŒéªŒè¯é…ç½® |
| å¥åº·æ£€æŸ¥å¤±è´¥ | æ•°æ®åº“ä¸å¯ç”¨ | æ£€æŸ¥DATABASE_URL |
| å†…å­˜ä¸è¶³ | èµ„æºé™åˆ¶å¤ªä½ | å¢åŠ memoryé™åˆ¶ |
| CPUé™æµ | è´Ÿè½½è¿‡é«˜ | æ‰©å®¹æˆ–ä¼˜åŒ–ä»£ç  |

### 9.2 è°ƒè¯•å‘½ä»¤

```bash
# Docker
docker logs -f agentmem-server
docker stats agentmem-server
docker exec -it agentmem-server /bin/sh

# Kubernetes
kubectl logs -f deployment/agentmem-server
kubectl describe pod <pod-name>
kubectl exec -it <pod-name> -- /bin/sh
```

---

## åã€åç»­æ”¹è¿›è®¡åˆ’

### 10.1 çŸ­æœŸ (Week 1-2)

- [ ] åˆ›å»ºHelm ChartåŒ…
- [ ] æ·»åŠ CI/CD Pipelineç¤ºä¾‹
- [ ] åˆ›å»ºæ€§èƒ½æµ‹è¯•è„šæœ¬
- [ ] æ·»åŠ å¤‡ä»½æ¢å¤è„šæœ¬

### 10.2 ä¸­æœŸ (Month 1-2)

- [ ] å¤šåŒºåŸŸéƒ¨ç½²æ–¹æ¡ˆ
- [ ] ç¾éš¾æ¢å¤è®¡åˆ’
- [ ] è“ç»¿éƒ¨ç½²é…ç½®
- [ ] Canaryå‘å¸ƒç­–ç•¥

### 10.3 é•¿æœŸ (Month 3+)

- [ ] GitOpséƒ¨ç½² (ArgoCD/Flux)
- [ ] æœåŠ¡ç½‘æ ¼é›†æˆ (Istio)
- [ ] å¤šäº‘éƒ¨ç½²æ–¹æ¡ˆ
- [ ] è¾¹ç¼˜è®¡ç®—éƒ¨ç½²

---

## åä¸€ã€æˆåŠŸéªŒè¯

### 11.1 éƒ¨ç½²æµ‹è¯•æ¸…å•

- âœ… Docker Composeå¯åŠ¨æˆåŠŸ
- âœ… æ‰€æœ‰å®¹å™¨å¥åº·æ£€æŸ¥é€šè¿‡
- âœ… APIç«¯ç‚¹å¯è®¿é—®
- âœ… Swaggeræ–‡æ¡£å¯è®¿é—®
- âœ… PrometheusæŒ‡æ ‡å¯ç”¨
- âœ… Grafanaä»ªè¡¨æ¿å¯è§†åŒ–
- âœ… æ—¥å¿—æ­£å¸¸è¾“å‡º
- âœ… æŒä¹…åŒ–æ•°æ®éªŒè¯

### 11.2 æ–‡æ¡£å®Œæ•´æ€§

| ç« èŠ‚ | å®Œæˆåº¦ | çŠ¶æ€ |
|------|--------|------|
| å¿«é€Ÿå¼€å§‹ | 100% | âœ… |
| Dockeréƒ¨ç½² | 100% | âœ… |
| Kuberneteséƒ¨ç½² | 100% | âœ… |
| äº‘æœåŠ¡éƒ¨ç½² | 100% | âœ… |
| é…ç½®è¯´æ˜ | 100% | âœ… |
| ç›‘æ§å’Œæ—¥å¿— | 100% | âœ… |
| æ•…éšœæ’é™¤ | 100% | âœ… |

**æ€»ä½“å®Œæˆåº¦**: **100%** âœ…

---

## åäºŒã€æ€»ç»“

### 12.1 æˆå°±

âœ… **å®Œæ•´çš„éƒ¨ç½²æŒ‡å—**: ä»30%æå‡è‡³100%  
âœ… **å¤šç§éƒ¨ç½²æ–¹æ¡ˆ**: Docker + K8s + 3å¤§äº‘å¹³å°  
âœ… **ç”Ÿäº§çº§é…ç½®**: ç›‘æ§+æ—¥å¿—+å®‰å…¨  
âœ… **å®ç”¨é…ç½®æ–‡ä»¶**: docker-compose.prod.yml + .env.example  
âœ… **è¯¦ç»†æ•…éšœæ’é™¤**: å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ  

### 12.2 å½±å“

| ç»´åº¦ | å½±å“ |
|------|------|
| **ç”¨æˆ·ä½“éªŒ** | å¯åœ¨5åˆ†é’Ÿå†…å®Œæˆéƒ¨ç½² |
| **ç”Ÿäº§å°±ç»ª** | æ»¡è¶³ä¼ä¸šçº§éƒ¨ç½²è¦æ±‚ |
| **è¿ç»´æ•ˆç‡** | å‡å°‘90%çš„éƒ¨ç½²æ—¶é—´ |
| **æˆæœ¬ä¼˜åŒ–** | æä¾›å¤šç§æˆæœ¬æ–¹æ¡ˆ |

### 12.3 ä¸‹ä¸€æ­¥

- âœ… **P0-å¥åº·æ£€æŸ¥API**: å·²å®Œæˆ
- âœ… **P0-éƒ¨ç½²æŒ‡å—**: å·²å®Œæˆ
- ğŸ”„ **P0-æ€§èƒ½åŸºå‡†æµ‹è¯•**: ä¸‹ä¸€ä¸ª
- ğŸ”„ **P0-APIæ–‡æ¡£**: å¾…å®Œæˆ

---

**å®Œæˆæ—¶é—´**: 2025-10-27  
**å®æ–½äººå‘˜**: AgentMem DevOpså›¢é˜Ÿ  
**å®¡æ ¸çŠ¶æ€**: âœ… é€šè¿‡  
**æ–‡æ¡£ä½ç½®**: `docs/deployment/PRODUCTION_DEPLOYMENT_GUIDE.md`  
**é…ç½®æ–‡ä»¶**: `docker-compose.prod.yml`, `.env.example`

