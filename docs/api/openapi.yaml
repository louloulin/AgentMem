openapi: 3.0.3
info:
  title: AgentMem API
  description: |
    AgentMemæ˜¯ä¸€ä¸ªä¼ä¸šçº§AI Agentè®°å¿†ç®¡ç†å¹³å°ï¼Œæä¾›å®Œæ•´çš„è®°å¿†ç®¡ç†ã€Agentç®¡ç†å’Œå·¥å…·é›†æˆåŠŸèƒ½ã€‚
    
    ## æ ¸å¿ƒç‰¹æ€§
    - ğŸ§  8ç§è®¤çŸ¥è®°å¿†ç±»å‹
    - ğŸ”„ åˆ†å±‚è®°å¿†æ¶æ„ (Global â†’ Agent â†’ User â†’ Session)
    - ğŸ” å¤šç§æœç´¢å¼•æ“ (å‘é‡ã€BM25ã€æ··åˆ)
    - ğŸ“Š å®æ—¶ç›‘æ§å’Œç»Ÿè®¡
    - ğŸ”Œ MCPå·¥å…·é›†æˆ
    - ğŸŒ WebSocket/SSEå®æ—¶é€šä¿¡
    
    ## è®¤è¯
    æ‰€æœ‰APIéœ€è¦JWT tokenæˆ–API Keyè®¤è¯ï¼ˆé™¤healthå’Œmetricsç«¯ç‚¹ï¼‰ã€‚
    
    åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š
    ```
    Authorization: Bearer <your-token>
    ```
    
    æˆ–ä½¿ç”¨API Keyï¼š
    ```
    X-API-Key: <your-api-key>
    ```
  version: 2.0.0
  contact:
    name: AgentMem Team
    email: support@agentmem.io
    url: https://agentmem.io
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: https://api.agentmem.io
    description: ç”Ÿäº§æœåŠ¡å™¨

tags:
  - name: Memory
    description: è®°å¿†ç®¡ç†API
  - name: Agents
    description: Agentç®¡ç†API
  - name: Users
    description: ç”¨æˆ·ç®¡ç†API
  - name: Chat
    description: èŠå¤©API
  - name: Health
    description: å¥åº·æ£€æŸ¥
  - name: Metrics
    description: ç›‘æ§æŒ‡æ ‡
  - name: Stats
    description: ç»Ÿè®¡æ•°æ®
  - name: Tools
    description: MCPå·¥å…·
  - name: Graph
    description: å›¾è®°å¿†API

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    Memory:
      type: object
      required:
        - content
        - memory_type
      properties:
        id:
          type: string
          format: uuid
          description: è®°å¿†ID
        content:
          type: string
          description: è®°å¿†å†…å®¹
        memory_type:
          type: string
          enum: [episodic, semantic, procedural, working, core, resource, knowledge, contextual]
          description: è®°å¿†ç±»å‹
        agent_id:
          type: string
          description: æ‰€å±Agent ID
        user_id:
          type: string
          description: æ‰€å±ç”¨æˆ·ID
        session_id:
          type: string
          description: æ‰€å±ä¼šè¯ID
        importance:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: é‡è¦æ€§è¯„åˆ† (0-1)
        metadata:
          type: object
          additionalProperties: true
          description: å…ƒæ•°æ®
        embedding:
          type: array
          items:
            type: number
          description: å‘é‡åµŒå…¥
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    Agent:
      type: object
      required:
        - name
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          description: Agentåç§°
        description:
          type: string
          description: Agentæè¿°
        llm_provider:
          type: string
          description: LLMæä¾›å•†
        model:
          type: string
          description: æ¨¡å‹åç§°
        system_prompt:
          type: string
          description: ç³»ç»Ÿæç¤ºè¯
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    SearchRequest:
      type: object
      required:
        - query
      properties:
        query:
          type: string
          description: æœç´¢æŸ¥è¯¢
        limit:
          type: integer
          default: 10
          description: è¿”å›ç»“æœæ•°é‡
        search_type:
          type: string
          enum: [vector, bm25, hybrid, fuzzy]
          default: hybrid
          description: æœç´¢ç±»å‹
        agent_id:
          type: string
          description: è¿‡æ»¤Agent
        user_id:
          type: string
          description: è¿‡æ»¤ç”¨æˆ·
        session_id:
          type: string
          description: è¿‡æ»¤ä¼šè¯
        memory_type:
          type: string
          description: è¿‡æ»¤è®°å¿†ç±»å‹

    SearchResult:
      type: object
      properties:
        memories:
          type: array
          items:
            $ref: '#/components/schemas/Memory'
        total:
          type: integer
          description: æ€»ç»“æœæ•°
        took_ms:
          type: number
          description: æœç´¢è€—æ—¶(æ¯«ç§’)

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        checks:
          type: object
          additionalProperties:
            type: object
            properties:
              status:
                type: string
              message:
                type: string
              last_check:
                type: string
                format: date-time

    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            suggestion:
              type: string
            retryable:
              type: boolean
        trace_id:
          type: string
        timestamp:
          type: integer
          format: int64

security:
  - bearerAuth: []
  - apiKey: []

paths:
  # Health Checks
  /health:
    get:
      tags: [Health]
      summary: å…¨é¢å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥æœåŠ¡åŠå„ç»„ä»¶çš„å¥åº·çŠ¶æ€
      security: []
      responses:
        '200':
          description: æœåŠ¡å¥åº·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '503':
          description: æœåŠ¡ä¸å¥åº·
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /health/live:
    get:
      tags: [Health]
      summary: Livenessæ¢é’ˆ
      description: Kubernetes liveness probe
      security: []
      responses:
        '200':
          description: æœåŠ¡å­˜æ´»
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: alive
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string

  /health/ready:
    get:
      tags: [Health]
      summary: Readinessæ¢é’ˆ
      description: Kubernetes readiness probe
      security: []
      responses:
        '200':
          description: æœåŠ¡å°±ç»ª
        '503':
          description: æœåŠ¡æœªå°±ç»ª

  # Memory APIs
  /api/v1/memories:
    get:
      tags: [Memory]
      summary: åˆ—å‡ºæ‰€æœ‰è®°å¿†
      description: è·å–è®°å¿†åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤ï¼‰
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
        - name: agent_id
          in: query
          schema:
            type: string
        - name: user_id
          in: query
          schema:
            type: string
        - name: memory_type
          in: query
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  memories:
                    type: array
                    items:
                      $ref: '#/components/schemas/Memory'
                  total:
                    type: integer

    post:
      tags: [Memory]
      summary: åˆ›å»ºè®°å¿†
      description: æ·»åŠ æ–°çš„è®°å¿†
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Memory'
            example:
              content: "ç”¨æˆ·å–œæ¬¢å–å’–å•¡"
              memory_type: "semantic"
              agent_id: "agent-1"
              user_id: "user-1"
              importance: 0.8
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  message:
                    type: string
        '400':
          description: è¯·æ±‚é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/memories/{id}:
    get:
      tags: [Memory]
      summary: è·å–è®°å¿†è¯¦æƒ…
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Memory'
        '404':
          description: è®°å¿†ä¸å­˜åœ¨

    put:
      tags: [Memory]
      summary: æ›´æ–°è®°å¿†
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Memory'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
        '404':
          description: è®°å¿†ä¸å­˜åœ¨

    delete:
      tags: [Memory]
      summary: åˆ é™¤è®°å¿†
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ
        '404':
          description: è®°å¿†ä¸å­˜åœ¨

  /api/v1/memories/search:
    post:
      tags: [Memory]
      summary: æœç´¢è®°å¿†
      description: ä½¿ç”¨å¤šç§æœç´¢å¼•æ“æœç´¢è®°å¿†
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SearchRequest'
            example:
              query: "å’–å•¡"
              limit: 10
              search_type: "hybrid"
              agent_id: "agent-1"
      responses:
        '200':
          description: æœç´¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResult'

  /api/v1/memories/batch:
    post:
      tags: [Memory]
      summary: æ‰¹é‡åˆ›å»ºè®°å¿†
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                memories:
                  type: array
                  items:
                    $ref: '#/components/schemas/Memory'
      responses:
        '201':
          description: æ‰¹é‡åˆ›å»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  ids:
                    type: array
                    items:
                      type: string
                  count:
                    type: integer

  # Agents APIs
  /api/v1/agents:
    get:
      tags: [Agents]
      summary: åˆ—å‡ºæ‰€æœ‰Agent
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/Agent'

    post:
      tags: [Agents]
      summary: åˆ›å»ºAgent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Agent'
      responses:
        '201':
          description: åˆ›å»ºæˆåŠŸ

  /api/v1/agents/{id}:
    get:
      tags: [Agents]
      summary: è·å–Agentè¯¦æƒ…
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Agent'

    put:
      tags: [Agents]
      summary: æ›´æ–°Agent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Agent'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ

    delete:
      tags: [Agents]
      summary: åˆ é™¤Agent
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: åˆ é™¤æˆåŠŸ

  # Chat APIs
  /api/v1/chat:
    post:
      tags: [Chat]
      summary: å‘é€èŠå¤©æ¶ˆæ¯
      description: å‘é€æ¶ˆæ¯ç»™Agentï¼Œè¿”å›AIå›å¤
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - agent_id
                - message
              properties:
                agent_id:
                  type: string
                user_id:
                  type: string
                session_id:
                  type: string
                message:
                  type: string
                stream:
                  type: boolean
                  default: false
            example:
              agent_id: "agent-1"
              user_id: "user-1"
              session_id: "session-abc"
              message: "ä½ å¥½"
              stream: false
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  response:
                    type: string
                  memory_ids:
                    type: array
                    items:
                      type: string

  # Metrics APIs
  /metrics:
    get:
      tags: [Metrics]
      summary: è·å–ç³»ç»ŸæŒ‡æ ‡
      description: è·å–ç³»ç»Ÿå’Œåº”ç”¨æŒ‡æ ‡ï¼ˆJSONæ ¼å¼ï¼‰
      security: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  system:
                    type: object
                  application:
                    type: object

  /metrics/prometheus:
    get:
      tags: [Metrics]
      summary: PrometheusæŒ‡æ ‡
      description: Prometheusæ ¼å¼çš„æŒ‡æ ‡
      security: []
      responses:
        '200':
          description: æˆåŠŸ
          content:
            text/plain:
              schema:
                type: string

  # Stats APIs
  /api/v1/stats/dashboard:
    get:
      tags: [Stats]
      summary: Dashboardç»Ÿè®¡
      description: è·å–Dashboardæ¦‚è§ˆç»Ÿè®¡
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_memories:
                    type: integer
                  total_agents:
                    type: integer
                  total_users:
                    type: integer
                  total_sessions:
                    type: integer
                  memory_growth:
                    type: array
                    items:
                      type: object

  /api/v1/stats/memories/growth:
    get:
      tags: [Stats]
      summary: è®°å¿†å¢é•¿ç»Ÿè®¡
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            default: 30
      responses:
        '200':
          description: æˆåŠŸ

  /api/v1/stats/memory/quality:
    get:
      tags: [Stats]
      summary: è®°å¿†è´¨é‡ç»Ÿè®¡
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  avg_importance:
                    type: number
                  quality_distribution:
                    type: object

externalDocs:
  description: å®Œæ•´æ–‡æ¡£
  url: https://docs.agentmem.io

