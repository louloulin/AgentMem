# GLIBC ç‰ˆæœ¬ä¸åŒ¹é…é—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜åˆ†æ

### é”™è¯¯ä¿¡æ¯
```
./agent-mem-server: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.38' not found
./agent-mem-server: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.39' not found
```

### æ ¹æœ¬åŸå› 

1. **æ„å»ºç¯å¢ƒ GLIBC ç‰ˆæœ¬è¾ƒæ–°**
   - `rust:latest` åŸºäºè¾ƒæ–°çš„ Debian/Ubuntu
   - åŒ…å« GLIBC 2.38/2.39

2. **è¿è¡Œæ—¶ç¯å¢ƒ GLIBC ç‰ˆæœ¬è¾ƒæ—§**
   - `debian:bookworm-slim` ä½¿ç”¨ GLIBC 2.36
   - æ— æ³•æ»¡è¶³äºŒè¿›åˆ¶æ–‡ä»¶çš„éœ€æ±‚

3. **ç‰ˆæœ¬ä¸åŒ¹é…**
   - æ„å»ºæ—¶é“¾æ¥äº†è¾ƒæ–°çš„ GLIBC
   - è¿è¡Œæ—¶ç¯å¢ƒ GLIBC ç‰ˆæœ¬ä¸è¶³

### GLIBC ç‰ˆæœ¬å¯¹ç…§è¡¨

| Debian ç‰ˆæœ¬ | GLIBC ç‰ˆæœ¬ | çŠ¶æ€ |
|------------|-----------|------|
| bookworm (12) | 2.36 | âŒ å¤ªæ—§ |
| trixie (13) | 2.37-2.38 | âš ï¸ å¯èƒ½ä¸å¤Ÿ |
| unstable/sid | 2.39+ | âœ… æ¨è |

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä½¿ç”¨ debian:unstable-slimï¼ˆå·²å®ç°ï¼Œæ¨èï¼‰

**ä¼˜ç‚¹**:
- âœ… åŒ…å« GLIBC 2.39ï¼Œå®Œå…¨å…¼å®¹
- âœ… é•œåƒä»ç„¶ç›¸å¯¹è¾ƒå°
- âœ… å®šæœŸæ›´æ–°

**å®ç°**:
```dockerfile
FROM debian:unstable-slim
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ä¸æ„å»ºç¯å¢ƒåŒ¹é…çš„åŸºç¡€é•œåƒ

ä½¿ç”¨ä¸ `rust:latest` ç›¸åŒçš„åŸºç¡€é•œåƒã€‚

**ä¼˜ç‚¹**:
- âœ… å®Œå…¨åŒ¹é…æ„å»ºç¯å¢ƒ
- âœ… é¿å…ç‰ˆæœ¬ä¸åŒ¹é…

**ç¼ºç‚¹**:
- âš ï¸ é•œåƒå¯èƒ½è¾ƒå¤§

### æ–¹æ¡ˆ 3: ä½¿ç”¨é™æ€é“¾æ¥ï¼ˆmuslï¼‰

ä½¿ç”¨ musl ç›®æ ‡è¿›è¡Œé™æ€é“¾æ¥ï¼Œå®Œå…¨é¿å… GLIBC ä¾èµ–ã€‚

**ä¼˜ç‚¹**:
- âœ… å®Œå…¨ç‹¬ç«‹ï¼Œæ—  GLIBC ä¾èµ–
- âœ… å¯åœ¨ä»»ä½• Linux ç³»ç»Ÿè¿è¡Œ

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦ä¿®æ”¹æ„å»ºé…ç½®
- âš ï¸ æŸäº›åŠŸèƒ½å¯èƒ½å—é™

---

## ğŸ”§ ä¿®å¤å®ç°ï¼ˆå·²åº”ç”¨ï¼‰

### ä¿®å¤æ–¹æ¡ˆï¼šä½¿ç”¨ debian:unstable-slim

**ä¿®æ”¹å†…å®¹**:
```dockerfile
# ä¿®å¤å‰
FROM debian:bookworm-slim

# ä¿®å¤å
FROM debian:unstable-slim
```

**åŸå› **:
- `debian:bookworm-slim` åŒ…å« GLIBC 2.36
- `debian:unstable-slim` åŒ…å« GLIBC 2.39+
- å®Œå…¨å…¼å®¹ `rust:latest` æ„å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶

### æ›¿ä»£æ–¹æ¡ˆ

#### æ–¹æ¡ˆ A: ä½¿ç”¨ debian:trixie-slimï¼ˆDebian 13 æµ‹è¯•ç‰ˆï¼‰

```dockerfile
FROM debian:trixie-slim
```

**ä¼˜ç‚¹**: æ¯” unstable æ›´ç¨³å®š  
**ç¼ºç‚¹**: GLIBC ç‰ˆæœ¬å¯èƒ½ä»ä¸å¤Ÿæ–°

#### æ–¹æ¡ˆ B: ä½¿ç”¨ä¸æ„å»ºç¯å¢ƒåŒ¹é…çš„åŸºç¡€é•œåƒ

```dockerfile
# æ£€æŸ¥ rust:latest åŸºäºçš„ Debian ç‰ˆæœ¬
# ç„¶åä½¿ç”¨ç›¸åŒç‰ˆæœ¬ä½œä¸ºè¿è¡Œæ—¶
FROM debian:bookworm  # å¦‚æœ rust:latest åŸºäº bookworm
```

**ä¼˜ç‚¹**: å®Œå…¨åŒ¹é…æ„å»ºç¯å¢ƒ  
**ç¼ºç‚¹**: é•œåƒè¾ƒå¤§

#### æ–¹æ¡ˆ C: ä½¿ç”¨é™æ€é“¾æ¥ï¼ˆmuslï¼‰

```dockerfile
# æ„å»ºæ—¶ä½¿ç”¨ musl ç›®æ ‡
RUN cargo build --target x86_64-unknown-linux-musl --release ...

# è¿è¡Œæ—¶ä½¿ç”¨ alpineï¼ˆåŸºäº muslï¼‰
FROM alpine:latest
```

**ä¼˜ç‚¹**: å®Œå…¨ç‹¬ç«‹ï¼Œæ—  GLIBC ä¾èµ–  
**ç¼ºç‚¹**: éœ€è¦ä¿®æ”¹æ„å»ºé…ç½®ï¼ŒæŸäº›åŠŸèƒ½å¯èƒ½å—é™

---

## âœ… å·²åº”ç”¨çš„ä¿®å¤

### Dockerfile ä¿®æ”¹

**ä½ç½®**: ç¬¬ 39 è¡Œ

**ä¿®æ”¹å‰**:
```dockerfile
FROM debian:bookworm-slim
```

**ä¿®æ”¹å**:
```dockerfile
FROM debian:unstable-slim
```

**è¯´æ˜**:
- âœ… åŒ…å« GLIBC 2.39+ï¼Œå®Œå…¨å…¼å®¹
- âœ… é•œåƒä»ç„¶ç›¸å¯¹è¾ƒå°
- âœ… å®šæœŸæ›´æ–°ï¼Œä¿æŒæœ€æ–°

---

## ğŸ§ª éªŒè¯ä¿®å¤

### 1. é‡æ–°æ„å»ºé•œåƒ

```bash
docker build -f Dockerfile -t agentmem:test .
```

### 2. è¿è¡Œå®¹å™¨æµ‹è¯•

```bash
docker run --rm agentmem:test ./agent-mem-server --version
```

### 3. æ£€æŸ¥ GLIBC ç‰ˆæœ¬

```bash
# åœ¨å®¹å™¨å†…æ£€æŸ¥
docker run --rm agentmem:test ldd --version

# æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶ä¾èµ–
docker run --rm agentmem:test ldd /app/agent-mem-server
```

### 4. éªŒè¯ä¸å†å‡ºç°é”™è¯¯

å¦‚æœä¿®å¤æˆåŠŸï¼Œåº”è¯¥ä¸å†å‡ºç°ï¼š
```
GLIBC_2.38' not found
GLIBC_2.39' not found
```

---

## ğŸ“Š GLIBC ç‰ˆæœ¬å¯¹ç…§è¡¨

| Debian ç‰ˆæœ¬ | ä»£å· | GLIBC ç‰ˆæœ¬ | çŠ¶æ€ | æ¨èåº¦ |
|------------|------|-----------|------|--------|
| Debian 12 | bookworm | 2.36 | âŒ å¤ªæ—§ | ä¸æ¨è |
| Debian 13 | trixie | 2.37-2.38 | âš ï¸ å¯èƒ½ä¸å¤Ÿ | å¤‡é€‰ |
| Debian unstable | sid | 2.39+ | âœ… æ¨è | â­â­â­ |
| Ubuntu 24.04 | noble | 2.39 | âœ… å¯ç”¨ | â­â­ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. debian:unstable çš„ç¨³å®šæ€§

- `debian:unstable` æ˜¯æ»šåŠ¨å‘å¸ƒç‰ˆæœ¬
- åŒ…ä¼šå®šæœŸæ›´æ–°
- å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ï¼š
  - ä½¿ç”¨å›ºå®šæ ‡ç­¾ï¼ˆå¦‚ `debian:unstable-20251202-slim`ï¼‰
  - æˆ–è€ƒè™‘ä½¿ç”¨ `debian:trixie-slim`ï¼ˆå¦‚æœ GLIBC ç‰ˆæœ¬è¶³å¤Ÿï¼‰

### 2. é•œåƒå¤§å°

- `debian:unstable-slim` æ¯” `debian:bookworm-slim` ç¨å¤§
- ä½†ä»ç„¶æ˜¯ slim ç‰ˆæœ¬ï¼Œç›¸å¯¹è¾ƒå°

### 3. é•¿æœŸç»´æŠ¤

- å¦‚æœ Debian 13 (trixie) ç¨³å®šç‰ˆå‘å¸ƒï¼Œå¯ä»¥åˆ‡æ¢åˆ° `debian:trixie-slim`
- å®šæœŸæ£€æŸ¥ GLIBC ç‰ˆæœ¬å…¼å®¹æ€§

---

## ğŸ”„ å›é€€æ–¹æ¡ˆ

å¦‚æœ `debian:unstable-slim` æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ï¼š

### æ–¹æ¡ˆ 1: debian:trixie-slim

```dockerfile
FROM debian:trixie-slim
```

### æ–¹æ¡ˆ 2: ä½¿ç”¨ Ubuntu

```dockerfile
FROM ubuntu:24.04
```

### æ–¹æ¡ˆ 3: ä½¿ç”¨ä¸æ„å»ºç¯å¢ƒåŒ¹é…çš„ç‰ˆæœ¬

```dockerfile
# æ£€æŸ¥ rust:latest çš„åŸºç¡€é•œåƒ
# ç„¶åä½¿ç”¨ç›¸åŒç‰ˆæœ¬
FROM debian:bookworm  # å¦‚æœåŒ¹é…
```

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `Dockerfile` - ä¸»æ„å»ºæ–‡ä»¶ï¼ˆå·²ä¿®å¤ï¼‰
- `Dockerfile.glibc-fixed` - ä¿®å¤ç‰ˆæœ¬å¤‡ä»½
- `GLIBC_VERSION_FIX.md` - æœ¬ä¿®å¤æ–‡æ¡£

---

## âœ… ä¿®å¤å®Œæˆ

**çŠ¶æ€**: âœ… **å·²ä¿®å¤**

**ä¿®å¤å†…å®¹**:
- âœ… å°†è¿è¡Œæ—¶é•œåƒä» `debian:bookworm-slim` æ”¹ä¸º `debian:unstable-slim`
- âœ… æ·»åŠ äº†è¯¦ç»†çš„æ³¨é‡Šè¯´æ˜
- âœ… åˆ›å»ºäº†ä¿®å¤æ–‡æ¡£

**ä¸‹ä¸€æ­¥**:
- é‡æ–°æ„å»ºé•œåƒéªŒè¯ä¿®å¤
- æµ‹è¯•è¿è¡Œæ—¶ä¸å†å‡ºç° GLIBC é”™è¯¯

---

**æœ€åæ›´æ–°**: 2025-12-02  
**é—®é¢˜**: GLIBC ç‰ˆæœ¬ä¸åŒ¹é…  
**çŠ¶æ€**: âœ… å·²ä¿®å¤ï¼ˆå·²åº”ç”¨ï¼‰

