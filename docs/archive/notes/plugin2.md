# AgentMem æ’ä»¶ä½“ç³»é‡æ„æ–¹æ¡ˆ v2.0

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-11-05  
**çŠ¶æ€**: è®¾è®¡æ–¹æ¡ˆ ğŸ¯

---

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜åˆ†æ](#1-é—®é¢˜åˆ†æ)
2. [AgentMemæ ¸å¿ƒè¿è¡Œæµç¨‹æŠ½è±¡](#2-agentmemæ ¸å¿ƒè¿è¡Œæµç¨‹æŠ½è±¡)
3. [æ’ä»¶æ‰©å±•ç‚¹è®¾è®¡](#3-æ’ä»¶æ‰©å±•ç‚¹è®¾è®¡)
4. [æ–°æ’ä»¶ä½“ç³»æ¶æ„](#4-æ–°æ’ä»¶ä½“ç³»æ¶æ„)
5. [å®æ–½è®¡åˆ’](#5-å®æ–½è®¡åˆ’)

---

## 1. é—®é¢˜åˆ†æ

### 1.1 å½“å‰æ’ä»¶ç³»ç»Ÿå­˜åœ¨çš„é—®é¢˜

åŸºäºå¯¹ AgentMem ä»£ç çš„æ·±å…¥åˆ†æï¼Œå‘ç°ä»¥ä¸‹æ ¸å¿ƒé—®é¢˜ï¼š

#### âŒ é—®é¢˜1: æ’ä»¶ä¸æ ¸å¿ƒç³»ç»Ÿè„±èŠ‚

**ç°çŠ¶**:
- æ’ä»¶ç³»ç»Ÿï¼ˆ`agent-mem-plugins`ï¼‰ç‹¬ç«‹å®ç°
- ä¸ Memory æ ¸å¿ƒï¼ˆ`agent-mem-core`ï¼‰ç¼ºä¹æ·±åº¦é›†æˆ
- æ’ä»¶è°ƒç”¨ç‚¹åˆ†æ•£ï¼Œæ²¡æœ‰ç»Ÿä¸€çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

**å½±å“**:
- æ’ä»¶æ— æ³•å……åˆ†åˆ©ç”¨ AgentMem çš„è®°å¿†ç®¡ç†èƒ½åŠ›
- æ— æ³•åœ¨å…³é”®è®°å¿†æ“ä½œç‚¹è¿›è¡Œæ‹¦æˆªå’Œå¢å¼º
- æ’ä»¶å¼€å‘è€…éœ€è¦é‡å¤å®ç°è®°å¿†æ“ä½œé€»è¾‘

#### âŒ é—®é¢˜2: æ’ä»¶ç±»å‹å®šä¹‰è¿‡äºé€šç”¨

**ç°çŠ¶**:
```rust
pub enum PluginType {
    MemoryProcessor,  // è¿‡äºå®½æ³›
    CodeAnalyzer,     // ä¸è®°å¿†å¹³å°å…³è”ä¸å¼º
    SearchAlgorithm,  // æœªå……åˆ†åˆ©ç”¨æœç´¢å¼•æ“
    DataSource,       // ç¼ºä¹ä¸è®°å¿†ç±»å‹çš„æ˜ å°„
    Multimodal,       // ä¸å¤šæ¨¡æ€å¤„ç†å™¨é‡å¤
    Custom(String),
}
```

**é—®é¢˜**:
- æ’ä»¶ç±»å‹ä¸ AgentMem çš„ 8 ç§è®°å¿†ç±»å‹ï¼ˆCore, Episodic, Semantic, Procedural, Working, Contextual, Knowledge, Resourceï¼‰æ²¡æœ‰å¯¹åº”å…³ç³»
- ç¼ºä¹é’ˆå¯¹è®°å¿†ç”Ÿå‘½å‘¨æœŸçš„æ’ä»¶ç±»å‹
- æ²¡æœ‰ä½“ç°åˆ†å±‚è®°å¿†æ¶æ„ï¼ˆGlobal â†’ Agent â†’ User â†’ Sessionï¼‰

#### âŒ é—®é¢˜3: æ‰©å±•ç‚¹ä¸æ˜ç¡®

**ç°çŠ¶**:
- åªåœ¨ Memory::search() ä¸­é›†æˆäº† before/after é’©å­
- ç¼ºå°‘ add, update, delete ç­‰å…³é”®æ“ä½œçš„é’©å­
- Orchestrator å±‚ï¼ˆ3700+è¡Œï¼‰çš„æ™ºèƒ½åŠŸèƒ½æœªæ’ä»¶åŒ–

**ç¼ºå¤±çš„æ‰©å±•ç‚¹**:
- âœ— è®°å¿†æ·»åŠ å‰çš„éªŒè¯å’Œå¤„ç†
- âœ— è®°å¿†æ›´æ–°æ—¶çš„å†²çªæ£€æµ‹
- âœ— è®°å¿†åˆ é™¤å‰çš„ä¾èµ–æ£€æŸ¥
- âœ— å‘é‡ç”Ÿæˆçš„è‡ªå®šä¹‰ç­–ç•¥
- âœ— é‡è¦æ€§è¯„åˆ†çš„è‡ªå®šä¹‰ç®—æ³•
- âœ— æœç´¢ç»“æœçš„é‡æ’åºç­–ç•¥

#### âŒ é—®é¢˜4: æ’ä»¶åŠŸèƒ½è¦†ç›–ä¸å…¨

**ç°æœ‰æ’ä»¶**:
```
hello_plugin        - åŸºç¡€ç¤ºä¾‹ï¼ˆ239KBï¼‰
memory_processor    - é€šç”¨å†…å®¹å¤„ç†ï¼ˆ346KBï¼‰
code_analyzer       - ä»£ç åˆ†æï¼ˆ260KBï¼‰
weather_plugin      - æ•°æ®æºç¤ºä¾‹ï¼ˆ280KBï¼‰
```

**é—®é¢˜**:
- ä¸è®°å¿†å¹³å°æ ¸å¿ƒåŠŸèƒ½å…³è”å¼±
- ç¼ºå°‘é’ˆå¯¹è®°å¿†ç®¡ç†çš„ä¸“ä¸šæ’ä»¶
- æœªä½“ç° AgentMem çš„æ™ºèƒ½æ¨ç†èƒ½åŠ›
- æ²¡æœ‰å±•ç¤ºåˆ†å±‚è®°å¿†æ¶æ„çš„ä¼˜åŠ¿

#### âŒ é—®é¢˜5: è®¾è®¡è¿‡äºå¤æ‚

**ç°çŠ¶**:
- 2ä¸ª crateï¼ˆplugin-sdk + pluginsï¼‰+ 18ä¸ªæµ‹è¯•æ–‡ä»¶
- LRU ç¼“å­˜ã€æƒé™ç³»ç»Ÿã€ç›‘æ§ç³»ç»Ÿç­‰åŠŸèƒ½å®Œå¤‡ä½†è¿‡åº¦è®¾è®¡
- æ–‡æ¡£ 2200+ è¡Œï¼Œå¼€å‘è€…å­¦ä¹ æˆæœ¬é«˜

**é—®é¢˜**:
- ç®€å•çš„æ’ä»¶éœ€æ±‚éœ€è¦ç†è§£å¤æ‚çš„æ¶æ„
- å¤§é‡ä¼ä¸šçº§ç‰¹æ€§ï¼ˆRBACã€èµ„æºé™åˆ¶ã€ç›‘æ§ï¼‰å¯¹åŸºç¡€ç”¨æˆ·è¿‡é‡
- é«˜å†…èšä½è€¦åˆåŸåˆ™æœªå……åˆ†ä½“ç°

### 1.2 ç°æœ‰æ¶æ„åˆ†æ

#### å½“å‰æ’ä»¶ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AgentMem Application                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Memory (agent-mem)                  â”‚
â”‚  - add/update/delete/search                 â”‚
â”‚  - ä»… search æœ‰æ’ä»¶é’©å­                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“ (weak integration)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Plugin Manager (agent-mem-plugins)       â”‚
â”‚  - PluginRegistry                           â”‚
â”‚  - PluginLoader (Extism)                    â”‚
â”‚  - LRU Cache                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         WASM Plugins                        â”‚
â”‚  - hello_plugin                             â”‚
â”‚  - memory_processor (é€šç”¨å¤„ç†)              â”‚
â”‚  - code_analyzer (ä»£ç åˆ†æ)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜**:
- æ’ä»¶å±‚ä¸ Memory å±‚æ¾è€¦åˆï¼Œç¼ºä¹æ·±åº¦é›†æˆ
- Orchestrator çš„æ™ºèƒ½åŠŸèƒ½ï¼ˆIntelligence é›†æˆï¼‰æœªæš´éœ²ç»™æ’ä»¶
- 5ç§æœç´¢å¼•æ“æœªæ’ä»¶åŒ–
- 8ä¸ª Manager æœªæä¾›æ’ä»¶æ¥å£

---

## 2. AgentMemæ ¸å¿ƒè¿è¡Œæµç¨‹æŠ½è±¡

### 2.1 è®°å¿†ç®¡ç†æ ¸å¿ƒæµç¨‹

åŸºäºå¯¹ `orchestrator.rs`ï¼ˆ3700+è¡Œï¼‰å’Œ `memory.rs` çš„åˆ†æï¼ŒAgentMem çš„æ ¸å¿ƒè¿è¡Œæµç¨‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AgentMem æ ¸å¿ƒè®°å¿†ç®¡ç†æµç¨‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ è®°å¿†æ·»åŠ æµç¨‹ (add)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ è¾“å…¥éªŒè¯ â†’ é‡å¤æ£€æµ‹ â†’ åµŒå…¥ç”Ÿæˆ â†’ é‡è¦æ€§è¯„ä¼°         â”‚
   â”‚    â†“          â†“          â†“          â†“                â”‚
   â”‚ ç±»å‹æ¨æ–­ â†’ å†²çªæ£€æµ‹ â†’ å…³ç³»æå– â†’ æŒä¹…åŒ–å­˜å‚¨         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
2ï¸âƒ£ è®°å¿†æœç´¢æµç¨‹ (search)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æŸ¥è¯¢åˆ†æ â†’ å‘é‡ç”Ÿæˆ â†’ æ··åˆæœç´¢ â†’ ç»“æœèåˆ           â”‚
   â”‚    â†“          â†“          â†“          â†“                â”‚
   â”‚ æƒé™è¿‡æ»¤ â†’ é‡è¦æ€§æ’åº â†’ ä¸Šä¸‹æ–‡å¢å¼º â†’ è¿”å›ç»“æœ       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3ï¸âƒ£ è®°å¿†æ›´æ–°æµç¨‹ (update)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç‰ˆæœ¬æ£€æŸ¥ â†’ å·®å¼‚åˆ†æ â†’ å†²çªè§£å†³ â†’ é‡æ–°åµŒå…¥           â”‚
   â”‚    â†“          â†“          â†“          â†“                â”‚
   â”‚ å…³ç³»æ›´æ–° â†’ å†å²è®°å½• â†’ ç´¢å¼•æ›´æ–° â†’ é€šçŸ¥è®¢é˜…è€…         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4ï¸âƒ£ è®°å¿†åˆ é™¤æµç¨‹ (delete)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ä¾èµ–æ£€æŸ¥ â†’ å…³ç³»æ¸…ç† â†’ è½¯åˆ é™¤æ ‡è®° â†’ å½’æ¡£             â”‚
   â”‚    â†“          â†“          â†“          â†“                â”‚
   â”‚ ç´¢å¼•æ¸…ç† â†’ é€šçŸ¥è®¢é˜…è€… â†’ å®¡è®¡æ—¥å¿— â†’ èµ„æºå›æ”¶         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5ï¸âƒ£ æ™ºèƒ½æ¨ç†æµç¨‹ (intelligence)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ äº‹å®æå– â†’ å®ä½“è¯†åˆ« â†’ å…³ç³»æ¨ç† â†’ å†³ç­–ç”Ÿæˆ           â”‚
   â”‚    â†“          â†“          â†“          â†“                â”‚
   â”‚ å†²çªæ£€æµ‹ â†’ ç½®ä¿¡åº¦è¯„ä¼° â†’ å»ºè®®ç”Ÿæˆ â†’ è‡ªåŠ¨æ‰§è¡Œ         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 åˆ†å±‚è®°å¿†æ¶æ„æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AgentMem åˆ†å±‚è®°å¿†æ¶æ„                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Global Layer (å…¨å±€å±‚)
   â†“
   ğŸ“š ç³»ç»ŸçŸ¥è¯†åº“ã€é€šç”¨äº‹å®ã€é…ç½®ä¿¡æ¯
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: GlobalMemoryProcessor
   
Agent Layer (ä»£ç†å±‚)
   â†“
   ğŸ¤– ä»£ç†ç‰¹å®šçŸ¥è¯†ã€è¡Œä¸ºæ¨¡å¼ã€ä»»åŠ¡ä¸Šä¸‹æ–‡
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: AgentMemoryProcessor
   
User Layer (ç”¨æˆ·å±‚)
   â†“
   ğŸ‘¤ ç”¨æˆ·åå¥½ã€å†å²è¡Œä¸ºã€ä¸ªæ€§åŒ–è®¾ç½®
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: UserMemoryProcessor
   
Session Layer (ä¼šè¯å±‚)
   â†“
   ğŸ’¬ å½“å‰å¯¹è¯ã€ä¸´æ—¶çŠ¶æ€ã€çŸ­æœŸä¸Šä¸‹æ–‡
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: SessionMemoryProcessor
```

### 2.3 å¤šæ¨¡æ€å¤„ç†æµç¨‹

AgentMem æœ‰å®Œæ•´çš„å¤šæ¨¡æ€æ”¯æŒï¼ˆ14ä¸ªæ¨¡å—ï¼‰ï¼Œä½†æœªæ’ä»¶åŒ–ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¤šæ¨¡æ€å†…å®¹å¤„ç†æµç¨‹                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ å›¾åƒå¤„ç†
   è¾“å…¥å›¾åƒ â†’ ç‰¹å¾æå– â†’ AIåˆ†æ â†’ æè¿°ç”Ÿæˆ â†’ å‘é‡åŒ–
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: ImageMemoryProcessor

2ï¸âƒ£ éŸ³é¢‘å¤„ç†
   è¾“å…¥éŸ³é¢‘ â†’ è½¬å†™æ–‡æœ¬ â†’ æƒ…æ„Ÿåˆ†æ â†’ å‘é‡åŒ– â†’ å­˜å‚¨
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: AudioMemoryProcessor

3ï¸âƒ£ è§†é¢‘å¤„ç†
   è¾“å…¥è§†é¢‘ â†’ å¸§æå– â†’ å…³é”®åœºæ™¯ â†’ è·¨æ¨¡æ€æ£€ç´¢ â†’ å­˜å‚¨
   ğŸ”Œ æ’ä»¶æ‰©å±•ç‚¹: VideoMemoryProcessor
```

---

## 3. æ’ä»¶æ‰©å±•ç‚¹è®¾è®¡

### 3.1 æ ¸å¿ƒæ‰©å±•ç‚¹çŸ©é˜µ

åŸºäº AgentMem çš„è¿è¡Œæµç¨‹ï¼Œå®šä¹‰ä»¥ä¸‹æ‰©å±•ç‚¹ï¼š

| é˜¶æ®µ | æ‰©å±•ç‚¹åç§° | è§¦å‘æ—¶æœº | æ’ä»¶ç±»å‹ | ä¼˜å…ˆçº§ |
|------|-----------|---------|---------|-------|
| **è®°å¿†æ·»åŠ ** | `before_add` | æ·»åŠ å‰éªŒè¯ | Validator | P0 |
| | `on_embedding` | åµŒå…¥ç”Ÿæˆ | EmbeddingEnhancer | P1 |
| | `on_importance` | é‡è¦æ€§è¯„ä¼° | ImportanceScorer | P1 |
| | `after_add` | æ·»åŠ åå¤„ç† | PostProcessor | P2 |
| **è®°å¿†æœç´¢** | `before_search` | æœç´¢å‰å¢å¼º | QueryEnhancer | P0 |
| | `on_retrieve` | æ£€ç´¢ç­–ç•¥ | RetrievalStrategy | P1 |
| | `on_rerank` | ç»“æœé‡æ’åº | ReRanker | P0 |
| | `after_search` | æœç´¢åå¤„ç† | ResultEnhancer | P2 |
| **è®°å¿†æ›´æ–°** | `before_update` | æ›´æ–°å‰æ£€æŸ¥ | UpdateValidator | P1 |
| | `on_conflict` | å†²çªæ£€æµ‹ | ConflictResolver | P0 |
| | `after_update` | æ›´æ–°ååŒæ­¥ | SyncHandler | P2 |
| **è®°å¿†åˆ é™¤** | `before_delete` | åˆ é™¤å‰æ£€æŸ¥ | DeleteValidator | P1 |
| | `on_cascade` | çº§è”åˆ é™¤ | CascadeHandler | P2 |
| | `after_delete` | åˆ é™¤åæ¸…ç† | CleanupHandler | P2 |
| **æ™ºèƒ½æ¨ç†** | `on_fact_extract` | äº‹å®æå– | FactExtractor | P0 |
| | `on_entity_recognize` | å®ä½“è¯†åˆ« | EntityRecognizer | P1 |
| | `on_relation_infer` | å…³ç³»æ¨ç† | RelationInferrer | P1 |
| **åˆ†å±‚æ¶æ„** | `on_layer_route` | å±‚çº§è·¯ç”± | LayerRouter | P1 |
| | `on_layer_merge` | å±‚çº§åˆå¹¶ | LayerMerger | P2 |

### 3.2 æ’ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­

```rust
pub trait MemoryPlugin {
    // ============ è®°å¿†æ·»åŠ é’©å­ ============
    
    /// è®°å¿†æ·»åŠ å‰ï¼šéªŒè¯ã€é¢„å¤„ç†
    async fn before_add(&self, input: &AddMemoryInput) 
        -> Result<Option<ModifiedInput>>;
    
    /// åµŒå…¥ç”Ÿæˆæ—¶ï¼šè‡ªå®šä¹‰åµŒå…¥ç­–ç•¥
    async fn on_embedding(&self, content: &str, context: &EmbedContext) 
        -> Result<Option<Vec<f32>>>;
    
    /// é‡è¦æ€§è¯„ä¼°æ—¶ï¼šè‡ªå®šä¹‰è¯„åˆ†ç®—æ³•
    async fn on_importance(&self, memory: &Memory, context: &ImportanceContext) 
        -> Result<Option<f32>>;
    
    /// è®°å¿†æ·»åŠ åï¼šé€šçŸ¥ã€ç´¢å¼•ã€å…³ç³»å»ºç«‹
    async fn after_add(&self, memory: &Memory, result: &AddResult) 
        -> Result<()>;
    
    // ============ è®°å¿†æœç´¢é’©å­ ============
    
    /// æœç´¢å‰ï¼šæŸ¥è¯¢æ”¹å†™ã€æ‰©å±•
    async fn before_search(&self, query: &SearchQuery) 
        -> Result<Option<ModifiedQuery>>;
    
    /// æ£€ç´¢æ—¶ï¼šè‡ªå®šä¹‰æ£€ç´¢ç­–ç•¥
    async fn on_retrieve(&self, query: &SearchQuery) 
        -> Result<Option<Vec<Memory>>>;
    
    /// é‡æ’åºæ—¶ï¼šè‡ªå®šä¹‰æ’åºç®—æ³•
    async fn on_rerank(&self, results: Vec<SearchResult>, query: &SearchQuery) 
        -> Result<Vec<SearchResult>>;
    
    /// æœç´¢åï¼šç»“æœå¢å¼ºã€è§£é‡Šç”Ÿæˆ
    async fn after_search(&self, results: &[SearchResult], query: &SearchQuery) 
        -> Result<Option<EnhancedResults>>;
    
    // ============ è®°å¿†æ›´æ–°é’©å­ ============
    
    /// æ›´æ–°å‰ï¼šç‰ˆæœ¬æ£€æŸ¥ã€æƒé™éªŒè¯
    async fn before_update(&self, id: &str, update: &UpdateInput) 
        -> Result<Option<ModifiedUpdate>>;
    
    /// å†²çªæ£€æµ‹æ—¶ï¼šè‡ªå®šä¹‰å†²çªè§£å†³ç­–ç•¥
    async fn on_conflict(&self, current: &Memory, update: &Memory) 
        -> Result<ConflictResolution>;
    
    /// æ›´æ–°åï¼šé€šçŸ¥ã€ç´¢å¼•æ›´æ–°
    async fn after_update(&self, old: &Memory, new: &Memory) 
        -> Result<()>;
    
    // ============ è®°å¿†åˆ é™¤é’©å­ ============
    
    /// åˆ é™¤å‰ï¼šä¾èµ–æ£€æŸ¥
    async fn before_delete(&self, id: &str) 
        -> Result<Option<DeleteValidation>>;
    
    /// çº§è”åˆ é™¤æ—¶ï¼šå¤„ç†å…³è”è®°å¿†
    async fn on_cascade(&self, id: &str, related: Vec<String>) 
        -> Result<CascadeStrategy>;
    
    /// åˆ é™¤åï¼šæ¸…ç†èµ„æº
    async fn after_delete(&self, memory: &Memory) 
        -> Result<()>;
    
    // ============ æ™ºèƒ½æ¨ç†é’©å­ ============
    
    /// äº‹å®æå–ï¼šä»å†…å®¹ä¸­æå–ç»“æ„åŒ–äº‹å®
    async fn on_fact_extract(&self, content: &str, context: &ExtractionContext) 
        -> Result<Vec<ExtractedFact>>;
    
    /// å®ä½“è¯†åˆ«ï¼šè¯†åˆ«å‘½åå®ä½“
    async fn on_entity_recognize(&self, content: &str) 
        -> Result<Vec<Entity>>;
    
    /// å…³ç³»æ¨ç†ï¼šæ¨æ–­å®ä½“é—´å…³ç³»
    async fn on_relation_infer(&self, entities: &[Entity], context: &InferenceContext) 
        -> Result<Vec<Relation>>;
}
```

---

## 4. æ–°æ’ä»¶ä½“ç³»æ¶æ„

### 4.1 ç®€åŒ–çš„æ’ä»¶åˆ†ç±»

åŸºäºè®°å¿†å¹³å°çš„æ ¸å¿ƒéœ€æ±‚ï¼Œé‡æ–°å®šä¹‰æ’ä»¶ç±»å‹ï¼š

```rust
/// æ’ä»¶ç±»å‹ï¼šé¢å‘è®°å¿†ç®¡ç†çš„ä¸“ä¸šåˆ†ç±»
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum MemoryPluginType {
    // ============ è®°å¿†å¤„ç†æ’ä»¶ ============
    
    /// è®°å¿†éªŒè¯å™¨ï¼šæ·»åŠ /æ›´æ–°å‰çš„éªŒè¯é€»è¾‘
    Validator {
        applies_to: Vec<MemoryType>,  // åº”ç”¨äºå“ªäº›è®°å¿†ç±»å‹
    },
    
    /// è®°å¿†å¢å¼ºå™¨ï¼šå†…å®¹å¢å¼ºã€å…ƒæ•°æ®æå–
    Enhancer {
        enhancement_type: EnhancementType,  // å¢å¼ºç±»å‹
    },
    
    /// è®°å¿†è½¬æ¢å™¨ï¼šæ ¼å¼è½¬æ¢ã€æ•°æ®æ¸…æ´—
    Transformer {
        input_format: String,
        output_format: String,
    },
    
    // ============ æœç´¢æ’ä»¶ ============
    
    /// æŸ¥è¯¢å¢å¼ºå™¨ï¼šæŸ¥è¯¢æ”¹å†™ã€æ‰©å±•
    QueryEnhancer {
        strategy: QueryStrategy,
    },
    
    /// æ£€ç´¢ç­–ç•¥ï¼šè‡ªå®šä¹‰æ£€ç´¢ç®—æ³•
    RetrievalStrategy {
        strategy_name: String,
    },
    
    /// é‡æ’åºå™¨ï¼šæœç´¢ç»“æœé‡æ’åº
    ReRanker {
        ranking_algorithm: String,
    },
    
    // ============ æ™ºèƒ½æ¨ç†æ’ä»¶ ============
    
    /// äº‹å®æå–å™¨ï¼šä»æ–‡æœ¬æå–ç»“æ„åŒ–äº‹å®
    FactExtractor {
        domain: String,  // é¢†åŸŸä¸“ä¸šåŒ–
    },
    
    /// å®ä½“è¯†åˆ«å™¨ï¼šNERã€å®ä½“é“¾æ¥
    EntityRecognizer {
        entity_types: Vec<String>,
    },
    
    /// å…³ç³»æ¨ç†å™¨ï¼šå®ä½“å…³ç³»æ¨æ–­
    RelationInferrer {
        relation_types: Vec<String>,
    },
    
    // ============ åˆ†å±‚æ¶æ„æ’ä»¶ ============
    
    /// å±‚çº§è·¯ç”±å™¨ï¼šå†³å®šè®°å¿†å­˜å‚¨å±‚çº§
    LayerRouter,
    
    /// å±‚çº§åˆå¹¶å™¨ï¼šè·¨å±‚çº§è®°å¿†æ•´åˆ
    LayerMerger,
    
    // ============ å¤šæ¨¡æ€æ’ä»¶ ============
    
    /// å¤šæ¨¡æ€å¤„ç†å™¨ï¼šå›¾åƒã€éŸ³é¢‘ã€è§†é¢‘
    MultimodalProcessor {
        modality: Modality,  // Image | Audio | Video
    },
    
    /// è·¨æ¨¡æ€æ£€ç´¢å™¨ï¼šè·¨æ¨¡æ€ç›¸ä¼¼åº¦è®¡ç®—
    CrossModalRetriever {
        source_modality: Modality,
        target_modality: Modality,
    },
    
    // ============ æ•°æ®æºæ’ä»¶ ============
    
    /// å¤–éƒ¨æ•°æ®æºï¼šé›†æˆå¤–éƒ¨ç³»ç»Ÿ
    DataSource {
        source_type: String,  // Database | API | File
        memory_type: MemoryType,  // æ˜ å°„åˆ°å“ªç§è®°å¿†ç±»å‹
    },
}

/// å¢å¼ºç±»å‹
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum EnhancementType {
    MetadataExtraction,  // å…ƒæ•°æ®æå–
    SummaryGeneration,   // æ‘˜è¦ç”Ÿæˆ
    KeywordExtraction,   // å…³é”®è¯æå–
    SentimentAnalysis,   // æƒ…æ„Ÿåˆ†æ
    TopicClassification, // ä¸»é¢˜åˆ†ç±»
    LanguageDetection,   // è¯­è¨€æ£€æµ‹
}

/// æŸ¥è¯¢ç­–ç•¥
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum QueryStrategy {
    Expansion,      // æŸ¥è¯¢æ‰©å±•
    Rewriting,      // æŸ¥è¯¢æ”¹å†™
    Disambiguation, // æ­§ä¹‰æ¶ˆè§£
    Personalization,// ä¸ªæ€§åŒ–
}

/// æ¨¡æ€ç±»å‹
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum Modality {
    Text,
    Image,
    Audio,
    Video,
}
```

### 4.2 æ–°æ’ä»¶æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AgentMem æ–°æ’ä»¶æ¶æ„                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Application Layer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  HTTP API    â”‚  â”‚  Python SDK  â”‚  â”‚  CLI Tool    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Memory Core (with Plugin Hooks)                 â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Memory Operations (CRUD + Search)                  â”‚    â”‚
â”‚  â”‚  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“  â†“      â”‚    â”‚
â”‚  â”‚  [Plugin Hook Points - 15ä¸ªæ‰©å±•ç‚¹]                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Orchestrator (Intelligence Integration)            â”‚    â”‚
â”‚  â”‚  - FactExtractor     (æ’ä»¶åŒ–âœ“)                      â”‚    â”‚
â”‚  â”‚  - EntityRecognizer  (æ’ä»¶åŒ–âœ“)                      â”‚    â”‚
â”‚  â”‚  - ConflictResolver  (æ’ä»¶åŒ–âœ“)                      â”‚    â”‚
â”‚  â”‚  - ImportanceEvaluator (æ’ä»¶åŒ–âœ“)                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Plugin Manager (Simplified)                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Registry       â”‚  â”‚ Loader(Extism) â”‚  â”‚ Hook Manager â”‚  â”‚
â”‚  â”‚ (ç®€åŒ–æ³¨å†Œè¡¨)    â”‚  â”‚ (WASMåŠ è½½å™¨)   â”‚  â”‚ (é’©å­è°ƒåº¦)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Memory-Focused Plugins                          â”‚
â”‚                                                              â”‚
â”‚  [è®°å¿†å¤„ç†]           [æœç´¢å¢å¼º]          [æ™ºèƒ½æ¨ç†]         â”‚
â”‚  â”œâ”€ Validator        â”œâ”€ QueryEnhancer   â”œâ”€ FactExtractor   â”‚
â”‚  â”œâ”€ Enhancer         â”œâ”€ ReRanker        â”œâ”€ EntityRecognizerâ”‚
â”‚  â””â”€ Transformer      â””â”€ RetrievalStrategy â””â”€ RelationInferrerâ”‚
â”‚                                                              â”‚
â”‚  [åˆ†å±‚æ¶æ„]           [å¤šæ¨¡æ€]            [æ•°æ®æº]           â”‚
â”‚  â”œâ”€ LayerRouter      â”œâ”€ ImageProcessor  â”œâ”€ DatabaseSource  â”‚
â”‚  â””â”€ LayerMerger      â””â”€ CrossModalRetriever â””â”€ APISource   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç®€åŒ–çš„æ’ä»¶SDK

```rust
// agent-mem-plugin-sdk/src/lib.rs

pub mod memory;   // è®°å¿†æ“ä½œAPI
pub mod search;   // æœç´¢æ“ä½œAPI
pub mod types;    // ç±»å‹å®šä¹‰
pub mod host;     // å®¿ä¸»å‡½æ•°

// å¯¼å‡ºæ ¸å¿ƒtrait
pub use memory::MemoryPlugin;

// ä¾¿æ·å®
#[macro_export]
macro_rules! declare_plugin {
    ($plugin_type:ty) => {
        // è‡ªåŠ¨ç”Ÿæˆæ’ä»¶å¯¼å‡ºä»£ç 
    };
}

// ç¤ºä¾‹æ’ä»¶å¼€å‘
use agent_mem_plugin_sdk::*;

pub struct MyValidator;

impl MemoryPlugin for MyValidator {
    async fn before_add(&self, input: &AddMemoryInput) -> Result<Option<ModifiedInput>> {
        // éªŒè¯é€»è¾‘
        if input.content.is_empty() {
            return Err(anyhow!("å†…å®¹ä¸èƒ½ä¸ºç©º"));
        }
        Ok(None) // ä¸ä¿®æ”¹è¾“å…¥
    }
}

// å£°æ˜æ’ä»¶
declare_plugin!(MyValidator);
```

---

## 5. å®æ–½è®¡åˆ’

### 5.1 æ”¹é€ è·¯çº¿å›¾

#### Phase 1: æ ¸å¿ƒé‡æ„ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**: åœ¨ Memory Core ä¸­é›†æˆæ’ä»¶é’©å­

**ä»»åŠ¡**:
1. **åœ¨ `memory.rs` ä¸­æ·»åŠ é’©å­ç‚¹** (3å¤©)
   - `before_add`, `after_add`
   - `before_update`, `after_update`
   - `before_delete`, `after_delete`
   - ç¡®ä¿å‘åå…¼å®¹

2. **é‡æ„ `plugin_integration.rs`** (2å¤©)
   - ç®€åŒ– `PluginHooks` trait
   - å®ç°ç»Ÿä¸€çš„é’©å­è°ƒåº¦å™¨
   - ç§»é™¤å†—ä½™ä»£ç 

3. **Orchestrator æ’ä»¶åŒ–** (3å¤©)
   - æš´éœ² Intelligence ç»„ä»¶æ¥å£
   - `FactExtractor` æ’ä»¶åŒ–
   - `ImportanceEvaluator` æ’ä»¶åŒ–
   - `ConflictResolver` æ’ä»¶åŒ–

4. **æµ‹è¯•å’ŒéªŒè¯** (2å¤©)
   - å•å…ƒæµ‹è¯•ï¼ˆé’©å­è°ƒç”¨ï¼‰
   - é›†æˆæµ‹è¯•ï¼ˆå®Œæ•´æµç¨‹ï¼‰
   - æ€§èƒ½æµ‹è¯•ï¼ˆé’©å­å¼€é”€ï¼‰

**äº¤ä»˜ç‰©**:
- âœ… Memory Core æ”¯æŒ 15ä¸ªæ’ä»¶é’©å­
- âœ… Orchestrator æ ¸å¿ƒç»„ä»¶æ’ä»¶åŒ–
- âœ… å‘åå…¼å®¹çš„ API
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–

#### Phase 2: æ’ä»¶ç±»å‹é‡æ„ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: é‡æ–°å®šä¹‰æ’ä»¶ç±»å‹ä½“ç³»

**ä»»åŠ¡**:
1. **å®šä¹‰æ–°æ’ä»¶ç±»å‹** (1å¤©)
   - å®ç° `MemoryPluginType` æšä¸¾
   - å®šä¹‰å„æ’ä»¶ç±»å‹çš„æ¥å£
   - ç¼–å†™ç±»å‹è½¬æ¢é€»è¾‘

2. **ç®€åŒ– Plugin SDK** (2å¤©)
   - ç²¾ç®€ SDK API
   - æä¾›ä¾¿æ·å®
   - ç¼–å†™å¼€å‘æŒ‡å—

3. **è¿ç§»ç°æœ‰æ’ä»¶** (2å¤©)
   - å°† `memory_processor` æ”¹ä¸º `Enhancer`
   - åˆ›å»º `Validator` ç¤ºä¾‹
   - åˆ›å»º `ReRanker` ç¤ºä¾‹

4. **æ–‡æ¡£æ›´æ–°** (2å¤©)
   - æ’ä»¶å¼€å‘æŒ‡å—
   - API å‚è€ƒæ–‡æ¡£
   - è¿ç§»æŒ‡å—

**äº¤ä»˜ç‰©**:
- âœ… æ–°æ’ä»¶ç±»å‹ä½“ç³»
- âœ… ç®€åŒ–çš„ SDKï¼ˆ< 500è¡Œï¼‰
- âœ… 3ä¸ªé‡æ„åçš„ç¤ºä¾‹æ’ä»¶
- âœ… å®Œæ•´å¼€å‘æ–‡æ¡£

#### Phase 3: ç¤ºä¾‹æ’ä»¶å¼€å‘ï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**: å¼€å‘10ä¸ªé’ˆå¯¹è®°å¿†å¹³å°çš„ä¸“ä¸šæ’ä»¶

**æ’ä»¶åˆ—è¡¨**:

1. **è®°å¿†éªŒè¯å™¨** (Validator)
   - å†…å®¹é•¿åº¦éªŒè¯
   - æ•æ„Ÿè¯è¿‡æ»¤
   - æ ¼å¼éªŒè¯

2. **å…ƒæ•°æ®æå–å™¨** (Enhancer)
   - å…³é”®è¯æå–
   - æ‘˜è¦ç”Ÿæˆ
   - ä¸»é¢˜åˆ†ç±»

3. **è¯­ä¹‰é‡æ’åºå™¨** (ReRanker)
   - åŸºäºç”¨æˆ·åå¥½çš„é‡æ’åº
   - æ—¶é—´è¡°å‡æƒé‡
   - å¤šå› å­èåˆæ’åº

4. **äº‹å®æå–å™¨** (FactExtractor)
   - åŒ»ç–—é¢†åŸŸäº‹å®æå–
   - æ³•å¾‹é¢†åŸŸäº‹å®æå–
   - é‡‘èé¢†åŸŸäº‹å®æå–

5. **å®ä½“è¯†åˆ«å™¨** (EntityRecognizer)
   - äººåã€åœ°åã€ç»„ç»‡å
   - æ—¶é—´ã€åœ°ç‚¹ã€äº‹ä»¶
   - è‡ªå®šä¹‰å®ä½“ç±»å‹

6. **å±‚çº§è·¯ç”±å™¨** (LayerRouter)
   - åŸºäºé‡è¦æ€§çš„è‡ªåŠ¨åˆ†å±‚
   - åŸºäºæ—¶é—´çš„å±‚çº§è·¯ç”±
   - åŸºäºç”¨æˆ·çš„ä¸ªæ€§åŒ–è·¯ç”±

7. **å›¾åƒæè¿°å™¨** (MultimodalProcessor - Image)
   - å›¾åƒå†…å®¹æè¿°
   - åœºæ™¯è¯†åˆ«
   - å¯¹è±¡æ£€æµ‹

8. **éŸ³é¢‘è½¬å†™å™¨** (MultimodalProcessor - Audio)
   - è¯­éŸ³è½¬æ–‡æœ¬
   - æƒ…æ„Ÿè¯†åˆ«
   - è¯´è¯äººè¯†åˆ«

9. **æ•°æ®åº“æ•°æ®æº** (DataSource)
   - PostgreSQL æ•°æ®å¯¼å…¥
   - MySQL æ•°æ®å¯¼å…¥
   - MongoDB æ•°æ®å¯¼å…¥

10. **API æ•°æ®æº** (DataSource)
    - RESTful API é›†æˆ
    - GraphQL API é›†æˆ
    - WebSocket æµå¼å¯¼å…¥

**æ¯ä¸ªæ’ä»¶åŒ…å«**:
- å®Œæ•´çš„å®ç°ä»£ç 
- å•å…ƒæµ‹è¯•
- ä½¿ç”¨ç¤ºä¾‹
- æ€§èƒ½åŸºå‡†

#### Phase 4: é›†æˆæµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**: ç¡®ä¿æ’ä»¶ç³»ç»Ÿç¨³å®šå¯é 

**ä»»åŠ¡**:
1. **ç«¯åˆ°ç«¯æµ‹è¯•** (2å¤©)
   - å®Œæ•´è®°å¿†ç”Ÿå‘½å‘¨æœŸæµ‹è¯•
   - å¤šæ’ä»¶ååŒæµ‹è¯•
   - é”™è¯¯å¤„ç†æµ‹è¯•

2. **æ€§èƒ½ä¼˜åŒ–** (2å¤©)
   - æ’ä»¶è°ƒç”¨å¼€é”€åˆ†æ
   - ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
   - å¹¶å‘æ€§èƒ½æµ‹è¯•

3. **æ–‡æ¡£å®Œå–„** (2å¤©)
   - æ¶æ„è®¾è®¡æ–‡æ¡£
   - æœ€ä½³å®è·µæŒ‡å—
   - æ•…éšœæ’æŸ¥æ‰‹å†Œ

4. **å‘å¸ƒå‡†å¤‡** (1å¤©)
   - ç‰ˆæœ¬å·ç¡®å®š
   - Changelog ç¼–å†™
   - å‘å¸ƒè¯´æ˜

### 5.2 æˆåŠŸæ ‡å‡†

#### æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | éªŒè¯æ–¹å¼ |
|------|-------|---------|
| æ’ä»¶é’©å­è¦†ç›– | 15ä¸ªæ‰©å±•ç‚¹ | ä»£ç å®¡æŸ¥ |
| æ’ä»¶ç±»å‹æ•°é‡ | 12ç§ä¸“ä¸šç±»å‹ | æšä¸¾å®šä¹‰ |
| ç¤ºä¾‹æ’ä»¶æ•°é‡ | 10ä¸ªåŠŸèƒ½å®Œæ•´æ’ä»¶ | ä»£ç åº“æ£€æŸ¥ |
| é’©å­è°ƒç”¨å¼€é”€ | < 1ms | æ€§èƒ½æµ‹è¯• |
| æµ‹è¯•è¦†ç›–ç‡ | > 85% | cargo tarpaulin |
| æ–‡æ¡£å®Œæ•´æ€§ | 100% | æ–‡æ¡£å®¡æŸ¥ |

#### åŠŸèƒ½æŒ‡æ ‡

- âœ… æ”¯æŒè®°å¿†æ·»åŠ /æ›´æ–°/åˆ é™¤/æœç´¢å…¨ç”Ÿå‘½å‘¨æœŸæ’ä»¶åŒ–
- âœ… Orchestrator æ™ºèƒ½ç»„ä»¶å¯é€šè¿‡æ’ä»¶æ‰©å±•
- âœ… åˆ†å±‚è®°å¿†æ¶æ„æ”¯æŒæ’ä»¶è·¯ç”±å’Œåˆå¹¶
- âœ… å¤šæ¨¡æ€å¤„ç†æ”¯æŒæ’ä»¶åŒ–
- âœ… 5ç§æœç´¢å¼•æ“æ”¯æŒæ’ä»¶å¢å¼º

#### æ˜“ç”¨æ€§æŒ‡æ ‡

- âœ… æ’ä»¶å¼€å‘ < 100è¡Œä»£ç ï¼ˆç®€å•æ’ä»¶ï¼‰
- âœ… SDK API < 20ä¸ªæ ¸å¿ƒæ–¹æ³•
- âœ… æ–‡æ¡£ < 50é¡µï¼ˆä¸»è¦éƒ¨åˆ†ï¼‰
- âœ… å­¦ä¹ æ›²çº¿ < 2å°æ—¶ï¼ˆåŸºç¡€æ’ä»¶ï¼‰

### 5.3 é£é™©å’Œç¼“è§£

#### é£é™©1: å‘åå…¼å®¹æ€§ç ´å

**é£é™©ç­‰çº§**: é«˜  
**å½±å“**: ç°æœ‰æ’ä»¶å’Œé›†æˆå¤±æ•ˆ

**ç¼“è§£æªæ–½**:
- ä¿ç•™æ—§çš„æ’ä»¶æ¥å£ï¼Œæ ‡è®°ä¸º `deprecated`
- æä¾›è‡ªåŠ¨è¿ç§»å·¥å…·
- ç¼–å†™è¯¦ç»†çš„è¿ç§»æŒ‡å—
- åœ¨ v2.0 å‘å¸ƒå‰å……åˆ†æµ‹è¯•

#### é£é™©2: æ€§èƒ½ä¸‹é™

**é£é™©ç­‰çº§**: ä¸­  
**å½±å“**: è®°å¿†æ“ä½œå»¶è¿Ÿå¢åŠ 

**ç¼“è§£æªæ–½**:
- å¼‚æ­¥æ’ä»¶è°ƒç”¨
- æ’ä»¶è¶…æ—¶æ§åˆ¶
- LRU ç¼“å­˜ä¼˜åŒ–
- æ€§èƒ½åŸºå‡†æµ‹è¯•

#### é£é™©3: å¤æ‚åº¦å¢åŠ 

**é£é™©ç­‰çº§**: ä¸­  
**å½±å“**: å¼€å‘è€…å­¦ä¹ æˆæœ¬ä¸Šå‡

**ç¼“è§£æªæ–½**:
- ç®€åŒ– SDK API
- æä¾›ä¾¿æ·å®
- ç¼–å†™è¯¦ç»†æ–‡æ¡£
- æä¾›10ä¸ªç¤ºä¾‹æ’ä»¶

---

## 6. æ€»ç»“

### 6.1 æ ¸å¿ƒæ”¹è¿›ç‚¹

#### âœ… ä»"é€šç”¨æ’ä»¶"åˆ°"è®°å¿†ä¸“ä¸šæ’ä»¶"

**ä¹‹å‰**:
- PluginType::MemoryProcessorï¼ˆè¿‡äºå®½æ³›ï¼‰
- PluginType::CodeAnalyzerï¼ˆä¸è®°å¿†å¹³å°å…³è”å¼±ï¼‰

**ä¹‹å**:
- MemoryPluginType::Validatorï¼ˆé’ˆå¯¹è®°å¿†éªŒè¯ï¼‰
- MemoryPluginType::FactExtractorï¼ˆé’ˆå¯¹äº‹å®æå–ï¼‰
- MemoryPluginType::LayerRouterï¼ˆé’ˆå¯¹åˆ†å±‚æ¶æ„ï¼‰

#### âœ… ä»"æ¾è€¦åˆ"åˆ°"æ·±åº¦é›†æˆ"

**ä¹‹å‰**:
- æ’ä»¶ç³»ç»Ÿä¸ Memory Core ç‹¬ç«‹
- ä»… search æ“ä½œæœ‰é’©å­

**ä¹‹å**:
- 15ä¸ªæ’ä»¶é’©å­è¦†ç›–å…¨ç”Ÿå‘½å‘¨æœŸ
- Orchestrator æ™ºèƒ½ç»„ä»¶æ’ä»¶åŒ–
- åˆ†å±‚æ¶æ„æ”¯æŒæ’ä»¶è·¯ç”±

#### âœ… ä»"å¤æ‚æ¶æ„"åˆ°"ç®€æ´è®¾è®¡"

**ä¹‹å‰**:
- 2ä¸ª crate + 2200è¡Œæ–‡æ¡£
- 18ä¸ªæµ‹è¯•æ–‡ä»¶
- å­¦ä¹ æˆæœ¬é«˜

**ä¹‹å**:
- ç®€åŒ–çš„ SDKï¼ˆ< 500è¡Œï¼‰
- ä¾¿æ·çš„å¼€å‘ä½“éªŒï¼ˆ< 100è¡Œä»£ç ï¼‰
- æ¸…æ™°çš„æ–‡æ¡£ï¼ˆ< 50é¡µæ ¸å¿ƒï¼‰

### 6.2 ä»·å€¼æå‡

#### å¯¹ç”¨æˆ·çš„ä»·å€¼

1. **æ›´å¼ºå¤§çš„è®°å¿†ç®¡ç†èƒ½åŠ›**
   - é€šè¿‡æ’ä»¶è‡ªå®šä¹‰è®°å¿†éªŒè¯é€»è¾‘
   - é€šè¿‡æ’ä»¶å¢å¼ºæœç´¢ç›¸å…³æ€§
   - é€šè¿‡æ’ä»¶å®ç°é¢†åŸŸä¸“ä¸šåŒ–

2. **æ›´çµæ´»çš„ç³»ç»Ÿæ‰©å±•**
   - æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
   - æ”¯æŒçƒ­æ’æ‹”
   - æ”¯æŒå¤šæ’ä»¶ååŒ

3. **æ›´ä½çš„å¼€å‘æˆæœ¬**
   - ç®€å•æ’ä»¶ < 100è¡Œä»£ç 
   - ä¸°å¯Œçš„ç¤ºä¾‹æ’ä»¶
   - å®Œå–„çš„å¼€å‘æ–‡æ¡£

#### å¯¹AgentMemçš„ä»·å€¼

1. **æ›´æ¸…æ™°çš„æ¶æ„**
   - æ ¸å¿ƒåŠŸèƒ½ä¸æ‰©å±•åŠŸèƒ½åˆ†ç¦»
   - é«˜å†…èšä½è€¦åˆ
   - æ˜“äºç»´æŠ¤å’Œæ¼”è¿›

2. **æ›´å¼ºçš„ç«äº‰åŠ›**
   - æ’ä»¶ç”Ÿæ€å»ºè®¾
   - ç¤¾åŒºè´¡çŒ®
   - å·®å¼‚åŒ–ä¼˜åŠ¿

3. **æ›´å¥½çš„å•†ä¸šåŒ–**
   - æ’ä»¶å¸‚åœº
   - ä¸“ä¸šæ’ä»¶ä»˜è´¹
   - ä¼ä¸šå®šåˆ¶æœåŠ¡

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- [plugin.md](./plugin.md) - å½“å‰æ’ä»¶ç³»ç»Ÿæ–‡æ¡£
- [PLUGIN_INTEGRATION_SUMMARY.md](./PLUGIN_INTEGRATION_SUMMARY.md) - é›†æˆæ€»ç»“
- [orchestrator.rs](./crates/agent-mem/src/orchestrator.rs) - æ ¸å¿ƒç¼–æ’å™¨
- [memory.rs](./crates/agent-mem/src/memory.rs) - è®°å¿†ç®¡ç†æ ¸å¿ƒ

### B. å‚è€ƒèµ„æ–™

**è®°å¿†ç³»ç»Ÿç ”ç©¶**:
- [AWS Agent è®°å¿†æ¨¡å—æœ€ä½³å®è·µ](https://aws.amazon.com/cn/blogs/china/agentic-ai-infrastructure-deep-practice-experience-thinking-series-three-best-practices-for-agent-memory-module/)
- [Dify è®°å¿†å·¥ç¨‹æ¶æ„å®è·µ](https://blog.csdn.net/2401_85725028/article/details/153973510)
- [æ„å»ºä¼ä¸šçº§ Agent ç³»ç»Ÿï¼šæ ¸å¿ƒç»„ä»¶è®¾è®¡ä¸ä¼˜åŒ–](https://www.cnblogs.com/muzinan110/p/18553196)

**æ’ä»¶ç³»ç»Ÿè®¾è®¡**:
- [Extism - The Universal Plug-in System](https://extism.org/)
- [WASM Component Model](https://github.com/WebAssembly/component-model)
- [Plugin Architecture Patterns](https://martinfowler.com/articles/plugin.html)

### C. å˜æ›´æ—¥å¿—

#### v2.0 - 2025-11-05

- ğŸ¯ å…¨é¢åˆ†æ AgentMem æ ¸å¿ƒæ¶æ„
- ğŸ¯ è¯†åˆ«ç°æœ‰æ’ä»¶ç³»ç»Ÿ5å¤§é—®é¢˜
- ğŸ¯ æŠ½è±¡è®°å¿†ç®¡ç†5å¤§æ ¸å¿ƒæµç¨‹
- ğŸ¯ è®¾è®¡15ä¸ªæ’ä»¶æ‰©å±•ç‚¹
- ğŸ¯ é‡æ–°å®šä¹‰12ç§è®°å¿†ä¸“ä¸šæ’ä»¶ç±»å‹
- ğŸ¯ åˆ¶å®š4é˜¶æ®µå®æ–½è®¡åˆ’ï¼ˆ6å‘¨ï¼‰
- ğŸ¯ æ˜ç¡®æˆåŠŸæ ‡å‡†å’Œé£é™©ç¼“è§£

---

**æ–‡æ¡£ç»´æŠ¤è€…**: AgentMem Team  
**æœ€åæ›´æ–°**: 2025-11-05  
**æ–‡æ¡£çŠ¶æ€**: è®¾è®¡æ–¹æ¡ˆ - å¾…è¯„å®¡


