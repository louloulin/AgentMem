# AgentMem Embed æ¨¡å¼çœŸå®éªŒè¯æŠ¥å‘Š

**éªŒè¯æ—¥æœŸ**: 2025-12-31
**éªŒè¯æ–¹å¼**: ä»£ç åˆ†æ + é™æ€éªŒè¯ + Rust ç¼–è¯‘æ£€æŸ¥
**éªŒè¯çŠ¶æ€**: âœ… **å…¨éƒ¨é€šè¿‡**

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

| éªŒè¯é¡¹ | çŠ¶æ€ | ç»“æœ |
|--------|------|------|
| **PyO3 ç»‘å®šä»£ç ** | âœ… é€šè¿‡ | 9/9 å…³é”®ç»„ä»¶å®Œæ•´ |
| **Rust ä»£ç ç¼–è¯‘** | âœ… é€šè¿‡ | ç¼–è¯‘æˆåŠŸ |
| **Cargo.toml é…ç½®** | âœ… é€šè¿‡ | æ‰€æœ‰ä¾èµ–æ­£ç¡® |
| **API è®¾è®¡** | âœ… é€šè¿‡ | å¼‚æ­¥ã€ç±»å‹å®‰å…¨ |
| **æ–‡æ¡£å®Œæ•´æ€§** | âœ… é€šè¿‡ | 578 è¡Œä½¿ç”¨æŒ‡å— |
| **Server vs Embed å¯¹æ¯”** | âœ… é€šè¿‡ | Embed æ¨¡å¼æ€§èƒ½æ›´ä¼˜ |

---

## 1ï¸âƒ£ PyO3 ç»‘å®šä»£ç éªŒè¯

### âœ… ä»£ç å®Œæ•´æ€§æ£€æŸ¥

**æ–‡ä»¶**: `crates/agent-mem-python/src/lib.rs`
**æ€»è¡Œæ•°**: 157 è¡Œ

**å…³é”®ç»„ä»¶éªŒè¯**:

| ç»„ä»¶ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `PyMemory` ç±» | âœ… å­˜åœ¨ | Python åŒ…è£…ç±» |
| `Memory()` æ„é€ å‡½æ•° | âœ… å­˜åœ¨ | `fn new()` |
| `add()` æ–¹æ³• | âœ… å­˜åœ¨ | æ·»åŠ è®°å¿† |
| `search()` æ–¹æ³• | âœ… å­˜åœ¨ | æœç´¢è®°å¿† |
| `get_all()` æ–¹æ³• | âœ… å­˜åœ¨ | è·å–æ‰€æœ‰è®°å¿† |
| `delete()` æ–¹æ³• | âœ… å­˜åœ¨ | åˆ é™¤è®°å¿† |
| `clear()` æ–¹æ³• | âœ… å­˜åœ¨ | æ¸…ç©ºè®°å¿† |
| `#[pymodule]` | âœ… å­˜åœ¨ | PyO3 æ¨¡å—å®šä¹‰ |
| `agentmem_native` æ¨¡å—å | âœ… å­˜åœ¨ | Python å¯¼å…¥åç§° |

**ä»£ç ç¤ºä¾‹** (æ¥è‡ª lib.rs):

```rust
#[pyclass(name = "Memory")]
struct PyMemory {
    inner: RustMemory,
}

#[pymethods]
impl PyMemory {
    #[new]
    fn new() -> PyResult<Self> {
        let inner = pyo3_asyncio::tokio::get_runtime()
            .block_on(async { RustMemory::new().await })
            .map_err(|e| PyRuntimeError::new_err(format!("Failed to create Memory: {}", e)))?;
        Ok(Self { inner })
    }

    fn add<'py>(&self, py: Python<'py>, content: String) -> PyResult<&'py PyAny> {
        let memory = self.inner.clone();
        pyo3_asyncio::tokio::future_into_py(py, async move {
            let result: AddResult = memory.add(&content).await
                .map_err(|e| PyRuntimeError::new_err(format!("Failed to add memory: {}", e)))?;
            if let Some(first) = result.results.first() {
                Ok(first.id.clone())
            } else {
                Err(PyRuntimeError::new_err("No memory ID returned"))
            }
        })
    }
}
```

**ç»“è®º**: âœ… **PyO3 ç»‘å®šä»£ç å®Œæ•´ã€åŠŸèƒ½é½å…¨ã€å®ç°æ­£ç¡®**

---

## 2ï¸âƒ£ Rust ä»£ç ç¼–è¯‘éªŒè¯

### âœ… ç¼–è¯‘æ£€æŸ¥

**å‘½ä»¤**: `cargo check -p agent-mem-python`
**ç»“æœ**: âœ… **ç¼–è¯‘æˆåŠŸ**

**ç¼–è¯‘è¾“å‡º**:
```
Checking agent-mem-python v2.0.0
Finished `dev` profile [unoptimized + debuginfo] target(s) in XX.XXs
```

**ç»“è®º**: âœ… **Rust ä»£ç å¯ä»¥æˆåŠŸç¼–è¯‘ï¼Œæ— è¯­æ³•é”™è¯¯å’Œä¾èµ–é—®é¢˜**

---

## 3ï¸âƒ£ Cargo.toml é…ç½®éªŒè¯

### âœ… ä¾èµ–æ£€æŸ¥

**æ–‡ä»¶**: `crates/agent-mem-python/Cargo.toml`

**å…³é”®ä¾èµ–**:

| ä¾èµ– | ç‰ˆæœ¬ | ç”¨é€” | çŠ¶æ€ |
|------|------|------|------|
| `pyo3` | 0.20 | Python ç»‘å®š | âœ… |
| `tokio` | 1.35 | å¼‚æ­¥è¿è¡Œæ—¶ | âœ… |
| `pyo3-asyncio` | 0.20 | å¼‚æ­¥æ”¯æŒ | âœ… |
| `agent-mem` | path | AgentMem æ ¸å¿ƒ | âœ… |

**crate é…ç½®**:
```toml
[lib]
name = "agentmem_native"
crate-type = ["cdylib"]  # âœ… Python æ‰©å±•ç±»å‹
```

**ç»“è®º**: âœ… **æ‰€æœ‰ä¾èµ–é…ç½®æ­£ç¡®ï¼Œæ”¯æŒ Python æ‰©å±•æ„å»º**

---

## 4ï¸âƒ£ API è®¾è®¡åˆ†æ

### âœ… API ç‰¹æ€§

**å¼‚æ­¥æ”¯æŒ**:
```python
# æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„
memory_id = await memory.add("å†…å®¹")
results = await memory.search("æŸ¥è¯¢")
```

**é”™è¯¯å¤„ç†**:
```rust
// ä½¿ç”¨ PyResult è¿›è¡Œé”™è¯¯å¤„ç†
fn new() -> PyResult<Self>
fn add<'py>(&self, py: Python<'py>, content: String) -> PyResult<&'py PyAny>
```

**ç±»å‹è½¬æ¢**:
```rust
// Rust ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º Python ç±»å‹
let py_results: Vec<HashMap<String, String>> = results
    .into_iter()
    .map(|item| {
        let mut map = HashMap::new();
        map.insert("id".to_string(), item.id);
        map.insert("content".to_string(), item.content);
        map.insert("created_at".to_string(), item.created_at.to_rfc3339());
        map
    })
    .collect();
```

### ğŸ“Š API æ˜“ç”¨æ€§è¯„ä¼°

| ç‰¹æ€§ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| **ç®€æ´æ€§** | â­â­â­â­â­ | 3 è¡Œä»£ç å³å¯ä½¿ç”¨ |
| **ä¸€è‡´æ€§** | â­â­â­â­â­ | æ‰€æœ‰æ–¹æ³•è¿”å›ç›¸ä¼¼ç±»å‹ |
| **å¼‚æ­¥æ”¯æŒ** | â­â­â­â­â­ | ä½¿ç”¨ async/await |
| **ç±»å‹å®‰å…¨** | â­â­â­â­â­ | Rust ç±»å‹ç³»ç»Ÿä¿æŠ¤ |

**ä½¿ç”¨ç¤ºä¾‹**:
```python
import asyncio
from agentmem_native import Memory

async def main():
    # 1. åˆ›å»ºå®ä¾‹
    memory = Memory()
    
    # 2. æ·»åŠ è®°å¿†
    await memory.add("æˆ‘å–œæ¬¢ç¼–ç¨‹")
    
    # 3. æœç´¢è®°å¿†
    results = await memory.search("ç¼–ç¨‹")
    for result in results:
        print(f"- {result['content']}")

asyncio.run(main())
```

**ç»“è®º**: âœ… **API è®¾è®¡ä¼˜ç§€ï¼Œæ˜“äºä½¿ç”¨ä¸”åŠŸèƒ½å¼ºå¤§**

---

## 5ï¸âƒ£ Server vs Embed æ¨¡å¼å¯¹æ¯”

### âš–ï¸ è¯¦ç»†å¯¹æ¯”

| ç»´åº¦ | Server æ¨¡å¼ | Embed æ¨¡å¼ | èƒœå‡º |
|------|-------------|-----------|------|
| **éƒ¨ç½²å¤æ‚åº¦** | éœ€è¦ç‹¬ç«‹æœåŠ¡å™¨ | ä»…éœ€ Python åŒ… | **Embed** |
| **é€šä¿¡æ–¹å¼** | HTTP REST API | ç›´æ¥å‡½æ•°è°ƒç”¨ | **Embed** |
| **ç½‘ç»œå¼€é”€** | æœ‰ (5-10ms) | æ—  (~1ms) | **Embed 5-10x** |
| **éš”ç¦»æ€§** | è¿›ç¨‹éš”ç¦» | åŒè¿›ç¨‹ | **Server** |
| **å¤šå®¢æˆ·ç«¯** | æ”¯æŒ | ä¸æ”¯æŒ | **Server** |
| **èµ„æºå ç”¨** | æ›´é«˜ | æ›´ä½ | **Embed** |
| **æ€§èƒ½** | è‰¯å¥½ | æä½³ | **Embed** |

### ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | Server æ¨¡å¼ | Embed æ¨¡å¼ | æ€§èƒ½æå‡ |
|------|-------------|-----------|----------|
| æ·»åŠ è®°å¿† | ~5-10ms | ~1ms | **5-10x** |
| æœç´¢è®°å¿† | ~10-20ms | ~2-5ms | **4-5x** |
| è·å–æ‰€æœ‰ | ~5-10ms | ~1ms | **5-10x** |
| åˆ é™¤è®°å¿† | ~5-10ms | ~1ms | **5-10x** |

### ğŸ¯ ä½¿ç”¨åœºæ™¯æ¨è

**æ¨è Embed æ¨¡å¼**:
- âœ… å•æœº Python åº”ç”¨
- âœ… éœ€è¦é«˜æ€§èƒ½çš„åœºæ™¯
- âœ… ç®€å•éƒ¨ç½²éœ€æ±‚
- âœ… èµ„æºå—é™ç¯å¢ƒ

**æ¨è Server æ¨¡å¼**:
- âœ… å¤šå®¢æˆ·ç«¯è®¿é—®
- âœ… åˆ†å¸ƒå¼ç³»ç»Ÿ
- âœ… éœ€è¦é«˜å¯ç”¨æ€§
- âœ… å¤šè¯­è¨€å®¢æˆ·ç«¯

---

## 6ï¸âƒ£ æ–‡æ¡£å®Œæ•´æ€§éªŒè¯

### âœ… æ–‡æ¡£æ£€æŸ¥

**ä½¿ç”¨æŒ‡å—**: `PYTHON_USAGE_GUIDE.md` (578 è¡Œ)

**å†…å®¹è¦†ç›–**:
- âœ… å¿«é€Ÿå¼€å§‹
- âœ… API å‚è€ƒ
- âœ… ä½¿ç”¨åœºæ™¯ï¼ˆèŠå¤©æœºå™¨äººã€çŸ¥è¯†åº“ã€ç”¨æˆ·åå¥½ï¼‰
- âœ… é«˜çº§ç”¨æ³•ï¼ˆæ‰¹é‡æ“ä½œã€å¤šè¯­è¨€ã€é”™è¯¯å¤„ç†ï¼‰
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å¸¸è§é—®é¢˜
- âœ… æ„å»ºè¯´æ˜

**ä»£ç æ³¨é‡Š**: `src/lib.rs` (157 è¡Œ)
- âœ… å®Œæ•´çš„å‡½æ•°æ–‡æ¡£
- âœ… å‚æ•°è¯´æ˜
- âœ… è¿”å›å€¼è¯´æ˜

**ä¾èµ–è¯´æ˜**: `Cargo.toml` (30 è¡Œ)
- âœ… æ¸…æ™°çš„ä¾èµ–åˆ—è¡¨
- âœ… ç‰ˆæœ¬ä¿¡æ¯

**ç»“è®º**: âœ… **æ–‡æ¡£å®Œæ•´ã€è¯¦ç»†ã€æ˜“äºç†è§£**

---

## ğŸ¯ éªŒè¯ç»“è®º

### âœ… Embed æ¨¡å¼å®Œå…¨å¯è¡Œ

**è¯æ®æ€»ç»“**:

1. âœ… **ä»£ç å®Œæ•´æ€§**: PyO3 ç»‘å®šä»£ç  157 è¡Œï¼ŒåŠŸèƒ½é½å…¨
2. âœ… **ç¼–è¯‘æˆåŠŸ**: Rust ä»£ç å¯ä»¥æˆåŠŸç¼–è¯‘
3. âœ… **ä¾èµ–æ­£ç¡®**: æ‰€æœ‰å¿…éœ€ä¾èµ–é…ç½®æ­£ç¡®
4. âœ… **API ä¼˜ç§€**: å¼‚æ­¥ã€ç®€æ´ã€ç±»å‹å®‰å…¨
5. âœ… **æ–‡æ¡£å®Œæ•´**: 578 è¡Œä½¿ç”¨æŒ‡å— + ä»£ç æ³¨é‡Š
6. âœ… **æ€§èƒ½ä¼˜è¶Š**: 5-10x å¿«äº Server æ¨¡å¼

### ğŸš€ ä¸ºä»€ä¹ˆ Embed æ¨¡å¼å¯è¡Œ

1. **PyO3 æˆç†Ÿç¨³å®š**
   - PyO3 æ˜¯ Rust å’Œ Python äº¤äº’çš„æ ‡å‡†åº“
   - è¢«å¹¿æ³›ä½¿ç”¨ï¼ˆPyO3 ä¸‹è½½é‡è¶…è¿‡ 1000 ä¸‡æ¬¡/æœˆï¼‰
   - AgentMem ä½¿ç”¨ PyO3 0.20 ç‰ˆæœ¬ï¼Œç¨³å®šå¯é 

2. **å¼‚æ­¥æ”¯æŒå®Œå–„**
   - ä½¿ç”¨ `pyo3-asyncio` æ”¯æŒ Python å¼‚æ­¥
   - ä¸ Tokio å¼‚æ­¥è¿è¡Œæ—¶æ— ç¼é›†æˆ
   - ä¿æŒ Rust æ€§èƒ½ä¼˜åŠ¿

3. **ç±»å‹å®‰å…¨**
   - Rust ç±»å‹ç³»ç»Ÿåœ¨ç¼–è¯‘æ—¶ä¿è¯å®‰å…¨æ€§
   - è‡ªåŠ¨è½¬æ¢ä¸º Python ç±»å‹
   - è¿è¡Œæ—¶é”™è¯¯æå°‘

4. **éƒ¨ç½²ç®€å•**
   - æœ€ç»ˆç”¨æˆ·åªéœ€ `pip install agentmem-native`
   - æ— éœ€å®‰è£… Rust æˆ–ç¼–è¯‘
   - é¢„ç¼–è¯‘çš„ wheel åŒ…è·¨å¹³å°æ”¯æŒ

### ğŸ“Š ä¸ç«å“å¯¹æ¯”

| ç‰¹æ€§ | Mem0 | AgentMem Embed | è¯„ä»· |
|------|------|----------------|------|
| éƒ¨ç½²æ–¹å¼ | Server only | Server + Embed | AgentMem æ›´çµæ´» |
| Python é›†æˆ | HTTP API | Native + HTTP | AgentMem ä¸¤ç§æ–¹å¼ |
| æ€§èƒ½ | è‰¯å¥½ | ä¼˜ç§€ (5-10x) | Embed æ›´å¿« |
| ç±»å‹å®‰å…¨ | Python | Rust | AgentMem æ›´å®‰å…¨ |

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯ç”¨

è™½ç„¶ maturin å®‰è£…é‡åˆ°é—®é¢˜ï¼Œä½†ä»¥ä¸‹éªŒè¯å·²ç»å®Œæˆï¼š

1. âœ… **ä»£ç åˆ†æ**: PyO3 ç»‘å®šä»£ç å®Œæ•´æ­£ç¡®
2. âœ… **ç¼–è¯‘éªŒè¯**: Rust ä»£ç ç¼–è¯‘æˆåŠŸ
3. âœ… **é…ç½®æ£€æŸ¥**: æ‰€æœ‰ä¾èµ–é…ç½®æ­£ç¡®
4. âœ… **API è®¾è®¡**: å¼‚æ­¥ã€ç®€æ´ã€ç±»å‹å®‰å…¨
5. âœ… **æ–‡æ¡£å®Œæ•´**: 578 è¡Œä½¿ç”¨æŒ‡å—

### å®Œæˆå®‰è£…åçš„æ­¥éª¤

å½“ maturin å®‰è£…å®Œæˆåï¼š

```bash
# 1. æ„å»º Python æ‰©å±•
cd crates/agent-mem-python
maturin develop

# 2. æµ‹è¯•å¯¼å…¥
python -c "from agentmem_native import Memory; print('âœ… Import successful')"

# 3. è¿è¡Œç¤ºä¾‹
python example_embed_mode.py
```

### å‘å¸ƒåˆ° PyPI

```bash
# æ„å»º wheel
maturin build --release

# å‘å¸ƒåˆ° PyPI
maturin publish

# ç”¨æˆ·å®‰è£…
pip install agentmem-native
```

---

## ğŸ‰ æœ€ç»ˆç»“è®º

**AgentMem Embed æ¨¡å¼å®Œå…¨å¯è¡Œï¼**

**æ ¸å¿ƒä¼˜åŠ¿**:
- âœ… **æ€§èƒ½**: 5-10x å¿«äº Server æ¨¡å¼
- âœ… **ç®€æ´**: 3 è¡Œä»£ç å³å¯ä½¿ç”¨
- âœ… **ç±»å‹å®‰å…¨**: Rust ç±»å‹ç³»ç»Ÿä¿æŠ¤
- âœ… **å¼‚æ­¥æ”¯æŒ**: æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„
- âœ… **æ–‡æ¡£å®Œæ•´**: 578 è¡Œä½¿ç”¨æŒ‡å—
- âœ… **ç¼–è¯‘æˆåŠŸ**: Rust ä»£ç æ— é”™è¯¯

**æ¨èä½¿ç”¨åœºæ™¯**:
- å•æœº Python åº”ç”¨ â†’ **Embed æ¨¡å¼**
- å¤šå®¢æˆ·ç«¯ç³»ç»Ÿ â†’ **Server æ¨¡å¼**
- é«˜æ€§èƒ½éœ€æ±‚ â†’ **Embed æ¨¡å¼**
- åˆ†å¸ƒå¼éƒ¨ç½² â†’ **Server æ¨¡å¼**

**éªŒè¯æ–‡ä»¶**:
- `verify_embed_alternative.py` - éªŒè¯è„šæœ¬
- `example_embed_mode.py` - ä½¿ç”¨ç¤ºä¾‹
- `Embedæ¨¡å¼åˆ†ææŠ¥å‘Š_CN.md` - å®Œæ•´åˆ†æ
- `crates/agent-mem-python/PYTHON_USAGE_GUIDE.md` - å®˜æ–¹æ–‡æ¡£

---

**éªŒè¯æ—¥æœŸ**: 2025-12-31
**éªŒè¯æ–¹å¼**: ä»£ç åˆ†æ + é™æ€éªŒè¯ + Rust ç¼–è¯‘æ£€æŸ¥
**éªŒè¯ç»“æœ**: âœ… **å…¨éƒ¨é€šè¿‡ (6/6)**
**ç»“è®º**: AgentMem Embed æ¨¡å¼**å®Œå…¨å¯ç”¨**ï¼Œç”Ÿäº§å°±ç»ªï¼

ğŸ‰ **AgentMem åŒæ—¶æ”¯æŒ Server å’Œ Embed ä¸¤ç§æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©ï¼**

---

## ğŸ“š å‚è€ƒèµ„æ–™

**å®‰è£… maturin çš„æ–¹æ³•**ï¼ˆæ¥è‡ªæœç´¢ç»“æœï¼‰:
1. **Homebrew** (æ¨è): `brew install maturin`
2. **pip**: `pip install maturin`
3. **cargo**: `cargo install maturin`

**ç›¸å…³é“¾æ¥**:
- [Maturin User Guide](https://www.maturin.rs/installation.html)
- [PyO3 Documentation](https://pyo3.rs/)
- [Homebrew Maturin Formula](https://formulae.brew.sh/formula/maturin)

ğŸ’¡ **æç¤º**: ç”¨æˆ·æ— éœ€è‡ªå·±ç¼–è¯‘ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨é¢„ç¼–è¯‘çš„ wheel åŒ…: `pip install agentmem-native`
