# LumosAI å…¨é¢æ¶æ„åˆ†æä¸æ”¹é€ è®¡åˆ’

**åˆ›å»ºæ—¥æœŸ**: 2025-01-XX  
**ç‰ˆæœ¬**: v2.1  
**çŠ¶æ€**: æ·±åº¦åˆ†æå®Œæˆï¼Œæ”¹é€ è®¡åˆ’åˆ¶å®šä¸­ï¼Œéƒ¨åˆ†åŠŸèƒ½å·²å®ç°

**æ›´æ–°è®°å½•**:
- 2025-01-XX: å®ŒæˆåŠ¨æ€é…ç½®æ”¯æŒï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œæ·»åŠ æµ‹è¯•éªŒè¯
- 2025-01-XX: å®Œæˆç»Ÿä¸€é”™è¯¯å¤„ç†ç³»ç»Ÿï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œå®ç°é‡è¯•ç­–ç•¥å’Œé”™è¯¯æ¢å¤æœºåˆ¶ï¼Œ6ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- 2025-01-XX: å®Œæˆ Tool ç³»ç»Ÿå¢å¼ºï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œå®ç°ä¾èµ–è§£æã€ç‰ˆæœ¬ç®¡ç†å’Œæ¨¡å¼åŒ¹é…å‘ç°ï¼Œ6ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- 2025-01-XX: å®Œæˆ API æ ‡å‡†åŒ–ï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œå®ç° API ä¸€è‡´æ€§æ£€æŸ¥ã€æ ‡å‡†åŒ–å·¥å…·å’Œè§„èŒƒæ£€æŸ¥å™¨ï¼Œ5ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- 2025-01-XX: å®Œæˆå·¥å…·è°ƒç”¨å¹¶å‘æ§åˆ¶ï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œå®ç° ConcurrentToolExecutor å¹¶å‘æ‰§è¡Œå™¨ï¼Œæ”¯æŒå¹¶å‘æ§åˆ¶å’Œè¶…æ—¶ï¼Œ4ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- 2025-01-XX: å®Œæˆ LLM Provider æ™ºèƒ½è·¯ç”±ï¼ˆP2ä»»åŠ¡ï¼‰ï¼Œå®ç° LlmRouter è·¯ç”±å™¨ï¼Œæ”¯æŒ5ç§è·¯ç”±ç­–ç•¥å’Œç»Ÿè®¡ç³»ç»Ÿï¼Œ5ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- 2025-01-XX: å®Œæˆ Agent Trait æ‹†åˆ†åŸºç¡€å®ç°ï¼ˆP0ä»»åŠ¡ï¼‰ï¼Œåˆ›å»ºäº† CoreAgentã€MemoryAgentã€ToolAgentã€StreamingAgentTrait å’Œ FullAgent Traitï¼Œ3ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- 2025-01-XX: å®Œæˆæ€§èƒ½ç›‘æ§ç³»ç»Ÿå®Œå–„ï¼ˆP2ä»»åŠ¡ï¼‰ï¼Œä¸º PerformanceMonitor æ·»åŠ äº†å®Œæ•´çš„æµ‹è¯•éªŒè¯ï¼Œ14ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œå¹¶å¯¼å‡ºåˆ° agent æ¨¡å—
- 2025-01-XX: å®Œæˆé…ç½®éªŒè¯å™¨å®Œå–„ï¼ˆP2ä»»åŠ¡ï¼‰ï¼Œä¸º ConfigValidator æ·»åŠ äº†å®Œæ•´çš„æµ‹è¯•éªŒè¯ï¼Œ13ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œå¹¶å¯¼å‡ºåˆ° agent æ¨¡å—
- 2025-01-XX: å®Œæˆæ¶ˆæ¯å·¥å…·å®Œå–„ï¼ˆP2ä»»åŠ¡ï¼‰ï¼Œä¸º message_utils æ·»åŠ äº†æ›´å¤šå®ç”¨åŠŸèƒ½å’Œå®Œæ•´çš„æµ‹è¯•éªŒè¯ï¼Œ9ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œå¹¶å¯¼å‡ºåˆ° agent æ¨¡å—
- 2025-01-XX: å®Œæˆè¯„ä¼°æŒ‡æ ‡ç³»ç»Ÿå®Œå–„ï¼ˆP2ä»»åŠ¡ï¼‰ï¼Œä¸º evaluation æ¨¡å—æ·»åŠ äº†å¤åˆæŒ‡æ ‡ã€é•¿åº¦æŒ‡æ ‡ã€ç›¸å…³æ€§æŒ‡æ ‡åŠå®Œæ•´æµ‹è¯•éªŒè¯ï¼Œ12 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼Œå¹¶å¯¼å‡ºåˆ° agent æ¨¡å—
- 2025-11-21: å®Œæˆ BasicMemory çº¿ç¨‹ä¸Šä¸‹æ–‡å¯¹æ¥ä¸æ–‡æ¡£æ›´æ–°ï¼ˆP0ä»»åŠ¡è¡¥å……ï¼‰ï¼Œæ–°å¢ 3 ä¸ªå›å½’æµ‹è¯•éªŒè¯çº¿ç¨‹åˆ›å»ºã€æ¶ˆæ¯å­˜å‚¨ä¸å‘½åç©ºé—´æ£€ç´¢
- 2025-11-21: å®Œæˆ BasicAgent `generate_with_memory` çº¿ç¨‹ä¸Šä¸‹æ–‡é›†æˆï¼ˆP0ä»»åŠ¡è¡¥å……ï¼‰ï¼Œè‡ªåŠ¨ç»§æ‰¿å‚æ•°/å…ƒæ•°æ®å¹¶å¢å¼º MemoryConfig
- 2025-11-21: å®Œæˆ Memory Processor ç®¡çº¿ä¸ UnifiedMemory æ¥å…¥ï¼ˆP0ä»»åŠ¡è¡¥å……ï¼‰ï¼ŒBasicMemory/UnifiedMemory è‡ªåŠ¨åŒæ­¥å¤„ç†å™¨å¹¶æ–°å¢ 2 ä¸ªé™åˆ¶/æ£€ç´¢å›å½’æµ‹è¯•
- 2025-11-21: å®Œæˆ BasicAgent é‡æ„ï¼ˆP0ä»»åŠ¡ï¼‰ï¼Œå°† 2300+ è¡Œçš„ BasicAgent æ‹†åˆ†ä¸º 4 ä¸ªæ¨¡å—åŒ–ç»„ä»¶ï¼ˆAgentCoreã€AgentExecutorã€AgentGeneratorã€RefactoredAgentï¼‰ï¼Œå®ç°å¤šæ­¥éª¤ç”Ÿæˆã€æµå¼ç”Ÿæˆã€å·¥å…·è°ƒç”¨ç­‰åŠŸèƒ½ï¼Œ11 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œå¹¶åˆ›å»ºå®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹
- 2025-11-21: å®Œæˆé”™è¯¯å¤„ç†ç³»ç»Ÿé›†æˆï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œåœ¨ AgentExecutor å’Œ AgentGenerator ä¸­é›†æˆ RetryExecutorï¼Œè‡ªåŠ¨åŒ…è£… LLM è°ƒç”¨å’Œå·¥å…·è°ƒç”¨ï¼Œæ”¯æŒæ™ºèƒ½é‡è¯•å’Œé”™è¯¯æ¢å¤ï¼Œ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 12 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œå–„ RefactoredAgent APIï¼ˆP0ä»»åŠ¡è¡¥å……ï¼‰ï¼Œä¿®å¤ `add_tool` æ–¹æ³•å®ç°ï¼Œæ·»åŠ  `tools()` æ–¹æ³•ç”¨äºè®¿é—®å·¥å…·åˆ—è¡¨ï¼Œæ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ å·¥å…·ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 13 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆå¹¶å‘å·¥å…·æ‰§è¡Œå™¨é›†æˆï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œåœ¨ AgentExecutor å’Œ AgentGenerator ä¸­å®Œæ•´é›†æˆ ConcurrentToolExecutorï¼Œå®ç°äº† BoxToolWrapper å°† Box<dyn Tool> è½¬æ¢ä¸º Arc<dyn Tool>ï¼Œä¿®å¤äº† MutexGuard ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œå®ç°äº†çœŸæ­£çš„å¹¶å‘å·¥å…·æ‰§è¡ŒåŠŸèƒ½ï¼Œ2 ä¸ªæµ‹è¯•é€šè¿‡ï¼ˆexecutor é…ç½®æµ‹è¯•å’Œ generator å¹¶å‘æ‰§è¡Œæµ‹è¯•ï¼‰ï¼ŒåŠŸèƒ½å·²å®Œå…¨å®ç° âœ…
- 2025-11-21: å®ŒæˆåŠ¨æ€é…ç½®æ”¯æŒæ–‡æ¡£å’Œç¤ºä¾‹ï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œä¸ºåŠ¨æ€é…ç½®åŠŸèƒ½æ·»åŠ äº†å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹å’Œæ–‡æ¡£è¯´æ˜ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ dynamic_instructionsã€dynamic_modelã€dynamic_tools ç­‰åŠŸèƒ½
- 2025-11-21: å®Œæˆ API æ ‡å‡†åŒ–é›†æˆï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œåœ¨ AgentGenerator ä¸­é›†æˆ ApiStandardizerï¼Œè‡ªåŠ¨æ ‡å‡†åŒ–æ‰€æœ‰ç”Ÿæˆçš„å“åº”ï¼ˆç©ºå“åº”å¤„ç†ã€æ ‡ç‚¹ç¬¦å·å¤„ç†ï¼‰ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 15 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ LLM Provider æ™ºèƒ½è·¯ç”±é›†æˆï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œåœ¨ AgentExecutor å’Œ AgentGenerator ä¸­é›†æˆ LlmRouterï¼Œæ”¯æŒåœ¨æ¯æ¬¡ LLM è°ƒç”¨æ—¶åŠ¨æ€é€‰æ‹©æœ€ä½³çš„ providerï¼ˆåŸºäºè´Ÿè½½ã€æˆæœ¬ã€å»¶è¿Ÿï¼‰ï¼Œ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 17 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ Tool ç³»ç»Ÿå¢å¼ºé›†æˆï¼ˆP1ä»»åŠ¡ï¼‰ï¼Œåœ¨ AgentExecutor ä¸­é›†æˆ ToolRegistryï¼Œæ”¯æŒå·¥å…·å‘ç°ï¼ˆæ¨¡å¼åŒ¹é…ï¼‰å’Œä¾èµ–è§£æåŠŸèƒ½ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 18 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ RefactoredAgent æ„å»ºå™¨æ–¹æ³•ï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œæ·»åŠ ä¾¿æ·çš„æ„å»ºå™¨æ–¹æ³•ï¼ˆwith_tool_registryã€with_llm_routerã€with_retry_executorã€with_concurrent_tool_executorï¼‰ï¼Œæ”¯æŒé“¾å¼é…ç½®ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 19 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆä¾¿æ·å·¥å‚å‡½æ•°ï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œæ·»åŠ  create_refactored_agent å’Œ create_refactored_agent_with_memory å‡½æ•°ï¼Œç®€åŒ–ä» BasicAgent çš„è¿ç§»ï¼Œ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 21 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ Agent trait å®ç°ï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œä¸º RefactoredAgent å®ç°å®Œæ•´çš„ Agent traitï¼ŒåŒ…æ‹¬ Base trait å’Œæ‰€æœ‰ Agent trait æ–¹æ³•ï¼Œä¿®å¤æ‰€æœ‰ Send trait é”™è¯¯ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 22 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ BasicAgent é‡æ„ - åˆ é™¤æ—§å®ç°å¹¶é‡å‘½åï¼ˆé‡å¤§é‡æ„ï¼‰ï¼Œå°† RefactoredAgent é‡å‘½åä¸º BasicAgentï¼Œåˆ é™¤æ—§çš„ executor.rs ä¸­çš„ BasicAgent å®ç°ï¼ˆ2300+ è¡Œï¼‰ï¼Œæ›´æ–°æ‰€æœ‰å¼•ç”¨å’Œå¯¼å…¥ï¼Œä¿®å¤æ–¹æ³•å†²çªï¼Œä¿®å¤ streaming.rs å’Œ websocket_demo.rs ä¸­çš„ Result å¤„ç†ï¼ŒéªŒè¯æ‰€æœ‰æ–‡ä»¶æ— é—æ¼çš„ RefactoredAgent å¼•ç”¨ï¼Œæ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ï¼Œåº“ç¼–è¯‘é€šè¿‡ï¼Œæ‰€æœ‰ refactored æ¨¡å—æµ‹è¯•é€šè¿‡ï¼ˆ22 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰ï¼Œé‡æ„å®Œå…¨å®Œæˆ
- 2025-11-21: æ›´æ–° Agent Trait æ‹†åˆ†ä»»åŠ¡çŠ¶æ€ï¼Œæ ‡è®°"è¿ç§» BasicAgent å®ç°"ä¸ºå·²å®Œæˆï¼ˆBasicAgent å·²é‡æ„ä¸ºæ¨¡å—åŒ–æ¶æ„å¹¶å®ç°æ‰€æœ‰å¿…è¦çš„ Traitï¼Œæ—§çš„å•ä½“å®ç°å·²å®Œå…¨ç§»é™¤ï¼‰
- 2025-11-21: å®Œæˆ Memory ç³»ç»Ÿé‡æ„çŠ¶æ€ç¡®è®¤ï¼Œæ‰€æœ‰å®æ–½æ­¥éª¤éƒ½å·²å®Œæˆï¼ˆ6ä¸ªæ­¥éª¤å…¨éƒ¨æ ‡è®°ä¸ºâœ…ï¼‰ï¼ŒThread ç®¡ç†ã€Resource éš”ç¦»ã€Message Processorã€è¯­ä¹‰å¬å›ç­‰åŠŸèƒ½éƒ½å·²å®ç°å¹¶é›†æˆåˆ° Memory traitï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½æœ‰æµ‹è¯•éªŒè¯ï¼Œæ–‡æ¡£å·²æ›´æ–°æ ‡è®°ä¸ºå·²å®Œæˆ
- 2025-11-21: å®Œæˆ Memory/Tool/Workflow API ä¸€è‡´æ€§åˆ†æï¼Œåˆ†æäº† Memoryã€Toolã€Workflow ä¸‰ä¸ª API çš„å½“å‰çŠ¶æ€ï¼Œç¡®è®¤æ‰€æœ‰ API éƒ½å·²ç»æ¯”è¾ƒå®Œå–„ï¼Œè®¾è®¡ä¸€è‡´ï¼Œå‘½åè§„èŒƒç»Ÿä¸€ï¼Œéƒ½ä½¿ç”¨ç›¸åŒçš„é”™è¯¯å¤„ç†æ¨¡å¼ï¼ˆResult ç±»å‹ï¼‰å’Œ RuntimeContextï¼Œæ— éœ€è¿›è¡Œå¤§è§„æ¨¡é‡æ„ï¼Œæ–‡æ¡£å·²æ›´æ–°æ ‡è®°ä¸ºå·²å®Œæˆ
- 2025-11-21: å®Œæˆ ConcurrentToolExecutor é›†æˆåˆ° AgentGeneratorï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œåœ¨ `execute_tool_calls` æ–¹æ³•ä¸­é›†æˆäº† ConcurrentToolExecutorï¼Œåˆ›å»ºäº† BoxToolWrapper å°† Box<dyn Tool> è½¬æ¢ä¸º Arc<dyn Tool>ï¼Œä¿®å¤äº† MutexGuard ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼ˆä½¿ç”¨åŒæ­¥å—ç¡®ä¿é”åœ¨ await ä¹‹å‰é‡Šæ”¾ï¼‰ï¼Œæ·»åŠ äº†æµ‹è¯•éªŒè¯å¹¶å‘å·¥å…·æ‰§è¡ŒåŠŸèƒ½ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 23 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ BasicAgent::set_instructions æ–¹æ³•å®ç°ï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œå®ç°äº†çœŸæ­£çš„ instructions æ›´æ–°åŠŸèƒ½ï¼Œé€šè¿‡æ·»åŠ  executor_mut å’Œ core_mut æ–¹æ³•æ”¯æŒé“¾å¼å¯å˜è®¿é—®ï¼Œæ›´æ–°äº† generator_mut æ–¹æ³•ï¼Œæ·»åŠ äº†æµ‹è¯•éªŒè¯ instructions æ›´æ–°åŠŸèƒ½ï¼Œ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 24 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡
- 2025-11-21: å®Œæˆ LLM Provider å¥åº·æ£€æŸ¥åŠŸèƒ½å®ç°ï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œåœ¨ `LlmProvider` trait ä¸­æ·»åŠ äº† `is_healthy()` æ–¹æ³•ï¼ˆå¸¦é»˜è®¤å®ç°ï¼Œæ‰§è¡Œæœ€å°ç”Ÿæˆè¯·æ±‚æµ‹è¯•ï¼‰ï¼Œä¸º `MockLlmProvider` å®ç°äº†è‡ªå®šä¹‰å¥åº·æ£€æŸ¥é€»è¾‘ï¼ˆåŸºäºå“åº”é…ç½®çŠ¶æ€ï¼‰ï¼Œæ·»åŠ äº†æµ‹è¯•éªŒè¯å¥åº·æ£€æŸ¥åŠŸèƒ½ï¼Œ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡
- 2025-11-21: å®Œæˆ LLM Provider æˆæœ¬ç›‘æ§åŠŸèƒ½å®ç°ï¼ˆP1ä»»åŠ¡è¡¥å……ï¼‰ï¼Œå®ç°äº† `CostMonitor` ç³»ç»Ÿï¼Œæ”¯æŒæˆæœ¬è·Ÿè¸ªï¼ˆåŸºäºè¾“å…¥/è¾“å‡º tokensï¼‰ã€æˆæœ¬æŸ¥è¯¢ï¼ˆæ€»æˆæœ¬ã€æŒ‰ providerã€æŒ‰æ—¶é—´èŒƒå›´ï¼‰ã€æˆæœ¬æŠ¥å‘ŠåŠŸèƒ½ï¼Œæ·»åŠ äº†æµ‹è¯•éªŒè¯æˆæœ¬ç›‘æ§åŠŸèƒ½ï¼Œ5 ä¸ªæ–°æµ‹è¯•é€šè¿‡
- 2025-11-21: **ä¿®å¤æ‰€æœ‰æµ‹è¯•ä»£ç ç¼–è¯‘é”™è¯¯**ï¼ˆP0ä»»åŠ¡è¡¥å……ï¼‰ï¼Œä¸º `ToolResultStatus` æ·»åŠ  `PartialEq` å’Œ `Eq` traitï¼Œä¿®å¤æµ‹è¯•ä»£ç ä¸­ `BasicAgent::new()` è¿”å› `Result` çš„å¤„ç†é—®é¢˜ï¼Œä¿®å¤äº† `week1_agent_tests.rs`ã€`websocket.rs`ã€`mod.rs`ã€`workflow/real_api_tests.rs`ã€`advanced_features_test.rs` ç­‰æ–‡ä»¶ä¸­çš„é”™è¯¯ï¼Œ**æ‰€æœ‰æµ‹è¯•ä»£ç ç¼–è¯‘é€šè¿‡** âœ…ï¼Œåº“ä»£ç å’Œæµ‹è¯•ä»£ç å‡å¯æ­£å¸¸ç¼–è¯‘
- 2025-11-21: **å®Œæˆå¹¶å‘å·¥å…·æ‰§è¡Œå™¨å®Œæ•´å®ç°**ï¼ˆP1ä»»åŠ¡å®Œå–„ï¼‰ï¼Œåœ¨ AgentGenerator ä¸­å®Œæ•´å®ç°äº†å¹¶å‘å·¥å…·æ‰§è¡Œé€»è¾‘ï¼Œåˆ›å»ºäº† BoxToolWrapper è§£å†³ç±»å‹è½¬æ¢é—®é¢˜ï¼Œä¿®å¤äº† MutexGuard ç”Ÿå‘½å‘¨æœŸé—®é¢˜ï¼Œå®ç°äº†çœŸæ­£çš„å¹¶å‘å·¥å…·æ‰§è¡ŒåŠŸèƒ½ï¼Œæ‰€æœ‰ç›¸å…³æµ‹è¯•é€šè¿‡ï¼ˆ21 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰ï¼ŒåŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶éªŒè¯ âœ…
- 2025-11-24: å®Œæˆ BasicAgent å¯¹ CoreAgent/MemoryAgent/ToolAgent/StreamingAgentTrait/ThreadManagementAgent çš„å®Œæ•´å®ç°ï¼Œç»Ÿä¸€ `generate_with_memory` é€»è¾‘å¹¶å¤ç”¨æ‹†åˆ† Traitï¼›åŒæ—¶é€šè¿‡ `CoreAgentTrait`/`MemoryAgentTrait`/`ToolAgentTrait`/`StreamingAgentCoreTrait`/`ThreadManagementAgentTrait` åˆ«åå¯¹å¤–å¯¼å‡ºï¼Œé¿å… API å†²çªï¼›è¡¥å…… Split Trait é›†æˆæµ‹è¯•éªŒè¯å·¥å…·/å†…å­˜/æµå¼/çº¿ç¨‹ç®¡ç†é“¾è·¯ï¼Œç¡®ä¿ Trait æ–¹æ¡ˆå¯çœŸå®è½åœ°ï¼ˆæ–°å¢ 1 ä¸ªé›†æˆæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

---

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£å¯¹ LumosAI æ•´ä¸ª AI Agent ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢æ·±å…¥çš„åˆ†æï¼Œå¯¹æ ‡ Mastra å®ç°ï¼Œè¯†åˆ«äº†æ ¸å¿ƒä¼˜åŠ¿å’Œå­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶åˆ¶å®šäº†å®Œå–„çš„æ”¹é€ è®¡åˆ’ã€‚åˆ†ææ¶µç›–äº†æ¶æ„è®¾è®¡ã€æ ¸å¿ƒæ¨¡å—å®ç°ã€æ€§èƒ½ä¼˜åŒ–ã€ä»£ç è´¨é‡ç­‰å¤šä¸ªç»´åº¦ã€‚

**æ ¸å¿ƒå‘ç°**:
- âœ… LumosAI åœ¨ Rust ç”Ÿæ€ã€æ€§èƒ½ã€å¤š Agent åä½œæ–¹é¢æœ‰æ˜¾è‘—ä¼˜åŠ¿
- âš ï¸ åœ¨ API ä¸€è‡´æ€§ã€Memory ç³»ç»Ÿè®¾è®¡ã€é”™è¯¯å¤„ç†ç­‰æ–¹é¢å­˜åœ¨æ”¹è¿›ç©ºé—´
- ğŸ¯ éœ€è¦å€Ÿé‰´ Mastra çš„åŠ¨æ€é…ç½®ã€ç»Ÿä¸€æŠ½è±¡ç­‰ä¼˜ç§€è®¾è®¡æ¨¡å¼

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šLumosAI æ¶æ„æ·±åº¦åˆ†æ

### 1.1 æ•´ä½“æ¶æ„æ¦‚è§ˆ

#### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Application Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  lumosai_ui â”‚ â”‚  lumosai_cli â”‚ â”‚  Custom Applications   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    API å±‚ (API Layer)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  REST API   â”‚ â”‚  WebSocket   â”‚ â”‚  MCP Protocol          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                æ ¸å¿ƒå±‚ (Core Layer)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Agent     â”‚ â”‚   Memory    â”‚ â”‚   Workflow              â”‚ â”‚
â”‚  â”‚   System    â”‚ â”‚   System    â”‚ â”‚   Engine                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Tool      â”‚ â”‚    LLM     â”‚ â”‚   Vector                â”‚ â”‚
â”‚  â”‚   System    â”‚ â”‚  Provider  â”‚ â”‚   Storage               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Database   â”‚ â”‚   Vector DB â”‚ â”‚   Cache & Queue         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Workspace ç»“æ„åˆ†æ

LumosAI é‡‡ç”¨ Rust workspace æ¶æ„ï¼ŒåŒ…å« 18+ ä¸ª cratesï¼š

**æ ¸å¿ƒå±‚ (Core Layer)**:
- `lumosai_core`: æ ¸å¿ƒ Agentã€LLMã€å·¥å…·ç³»ç»Ÿå®ç°
- `lumos_macro`: è¿‡ç¨‹å®æ‰©å±•ï¼Œæ”¯æŒ Agent/å·¥å…·å®šä¹‰

**æœåŠ¡å±‚ (Service Layer)**:
- `lumosai_vector`: å‘é‡æ•°æ®åº“æŠ½è±¡å±‚
- `lumosai_rag`: RAG æ£€ç´¢å¢å¼ºç”Ÿæˆç³»ç»Ÿ
- `lumosai_cli`: å‘½ä»¤è¡Œå·¥å…·å’Œå¼€å‘æœåŠ¡å™¨
- `lumosai_mcp`: MCP åè®®æ”¯æŒ
- `lumosai_network`: åˆ†å¸ƒå¼ Agent ç½‘ç»œ
- `lumosai_evals`: æ¨¡å‹è¯„ä¼°ç³»ç»Ÿ

**åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)**:
- `lumosai_auth`: JWT è®¤è¯ç³»ç»Ÿ
- `lumosai_enterprise`: ä¼ä¸šçº§åŠŸèƒ½ï¼ˆå¤šç§Ÿæˆ·ã€ç›‘æ§ã€è®¡è´¹ï¼‰
- `lumosai_security`: å®‰å…¨å·¥å…·
- `lumosai_telemetry`: é¥æµ‹å’Œç›‘æ§

**æ‰©å±•å±‚ (Extension Layer)**:
- `lumosai_voice`: è¯­éŸ³å¤„ç†
- `lumosai_multimodal`: å¤šæ¨¡æ€æ”¯æŒ
- `lumosai_bindings`: å¤šè¯­è¨€ç»‘å®šï¼ˆPython/TypeScript/WASMï¼‰

### 1.2 Agent ç³»ç»Ÿæ·±åº¦åˆ†æ

#### 1.2.1 Agent Trait è®¾è®¡

**æ ¸å¿ƒ Trait**: `Agent` (ä½äº `lumosai_core/src/agent/trait_def.rs`)

**å…³é”®æ–¹æ³•**:
```rust
pub trait Agent: Base + Send + Sync {
    // åŸºç¡€ä¿¡æ¯
    fn get_name(&self) -> &str;
    fn get_instructions(&self) -> &str;
    fn get_llm(&self) -> Arc<dyn LlmProvider>;
    
    // Memory ç®¡ç†
    fn get_memory(&self) -> Option<Arc<dyn Memory>>;
    fn has_own_memory(&self) -> bool;
    fn get_working_memory(&self) -> Option<Arc<dyn WorkingMemory>>;
    
    // Tool ç®¡ç†
    fn get_tools(&self) -> HashMap<String, Box<dyn Tool>>;
    async fn get_tools_with_context(&self, context: &RuntimeContext) -> Result<HashMap<String, Box<dyn Tool>>>;
    fn add_tool(&mut self, tool: Box<dyn Tool>) -> Result<()>;
    
    // æ ¸å¿ƒç”Ÿæˆæ–¹æ³•
    async fn generate(&self, messages: &[Message], options: &AgentGenerateOptions) -> Result<AgentGenerateResult>;
    async fn generate_with_context(&self, messages: &[Message], options: &AgentGenerateOptions, context: &RuntimeContext) -> Result<AgentGenerateResult>;
    async fn generate_simple(&self, input: &str) -> Result<String>;
    async fn generate_with_steps(&self, messages: &[Message], options: &AgentGenerateOptions, max_steps: Option<u32>) -> Result<AgentGenerateResult>;
    
    // æµå¼ç”Ÿæˆ
    async fn stream<'a>(&'a self, messages: &'a [Message], options: &'a AgentStreamOptions) -> Result<BoxStream<'a, Result<String>>>;
    
    // SOP æ”¯æŒ
    fn sop_watch(&self) -> Vec<String>;
    async fn sop_think(&self, messages: Vec<SopMessage>) -> Result<AgentAction>;
    async fn sop_act(&self, action: AgentAction) -> Result<SopMessage>;
}
```

**ä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„ Trait æŠ½è±¡ï¼Œæ”¯æŒå¤šç§ Agent å®ç°
- âœ… æ”¯æŒåŠ¨æ€å·¥å…·å’ŒæŒ‡ä»¤è§£æï¼ˆ`get_tools_with_context`, `get_instructions_with_context`ï¼‰
- âœ… å®Œæ•´çš„æµå¼æ”¯æŒ
- âœ… SOP (Standard Operating Procedure) æ¨¡å¼æ”¯æŒ

**é—®é¢˜**:
- âš ï¸ Trait æ–¹æ³•è¿‡å¤šï¼ˆ50+ï¼‰ï¼ŒèŒè´£ä¸å¤Ÿå•ä¸€
- âš ï¸ ç¼ºå°‘ç»Ÿä¸€çš„é”™è¯¯æ¢å¤æœºåˆ¶
- âš ï¸ éƒ¨åˆ†æ–¹æ³•æœ‰é»˜è®¤å®ç°ä½†ä¸å¤Ÿå®Œå–„

#### 1.2.2 BasicAgent å®ç°

**æ ¸å¿ƒå®ç°**: `lumosai_core/src/agent/executor.rs`

**å…³é”®ç»„ä»¶**:
```rust
pub struct BasicAgent {
    base: BaseComponent,
    name: String,
    instructions: String,
    llm: Arc<dyn LlmProvider>,
    tools: Arc<Mutex<HashMap<String, Box<dyn Tool>>>>,
    memory: Option<Arc<dyn Memory>>,
    working_memory: Option<Box<dyn WorkingMemory>>,
    voice: Option<Arc<dyn VoiceProvider>>,
    temperature: Option<Temperature>,
    abort_signal: Option<watch::Receiver<bool>>,
    output_schema: Option<Value>,
    enable_function_calling: bool,
    metrics_collector: Option<Arc<dyn MetricsCollector>>,
    trace_collector: Option<Arc<dyn TraceCollector>>,
    status: AgentStatus,
}
```

**æ‰§è¡Œæµç¨‹**:
1. **æ¶ˆæ¯å‡†å¤‡**: æ ¼å¼åŒ–æ¶ˆæ¯ï¼Œåº”ç”¨ Memory æ£€ç´¢
2. **å·¥å…·å‡†å¤‡**: æ„å»ºå‡½æ•°å®šä¹‰ï¼Œæ”¯æŒ Function Calling
3. **LLM è°ƒç”¨**: æ”¯æŒæµå¼å’Œéæµå¼
4. **å·¥å…·æ‰§è¡Œ**: å¤šè½®å·¥å…·è°ƒç”¨å¾ªç¯ï¼ˆæœ€å¤š max_tool_calls è½®ï¼‰
5. **ç»“æœå¤„ç†**: è§£æå“åº”ï¼Œæ›´æ–° Memoryï¼Œè®°å½• Trace

**ä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„å·¥å…·è°ƒç”¨å¾ªç¯æ”¯æŒ
- âœ… æ”¯æŒ Function Calling å’Œä¼ ç»Ÿå·¥å…·è°ƒç”¨
- âœ… å®Œæ•´çš„ Trace å’Œ Metrics æ”¶é›†
- âœ… æ”¯æŒç»“æ„åŒ–è¾“å‡º

**é—®é¢˜**:
- âš ï¸ æ‰§è¡Œé€»è¾‘å¤æ‚ï¼ˆ2000+ è¡Œï¼‰ï¼Œéš¾ä»¥ç»´æŠ¤
- âš ï¸ é”™è¯¯å¤„ç†åˆ†æ•£ï¼Œç¼ºå°‘ç»Ÿä¸€çš„é‡è¯•æœºåˆ¶
- âš ï¸ å·¥å…·è°ƒç”¨è¶…æ—¶å¤„ç†ä¸å¤Ÿå®Œå–„
- âš ï¸ ç¼ºå°‘å·¥å…·è°ƒç”¨çš„å¹¶å‘æ§åˆ¶

#### 1.2.3 AgentBuilder è®¾è®¡

**æ ¸å¿ƒå®ç°**: `lumosai_core/src/agent/builder.rs`

**Builder æ¨¡å¼**:
```rust
pub struct AgentBuilder {
    name: Option<String>,
    instructions: Option<String>,
    model: Option<Arc<dyn LlmProvider>>,
    memory_config: Option<MemoryConfig>,
    memory: Option<Arc<dyn Memory>>,
    tools: Vec<Box<dyn Tool>>,
    temperature: Option<f32>,
    max_tool_calls: Option<u32>,
    // ... æ›´å¤šé…ç½®
}

impl AgentBuilder {
    pub fn new() -> Self;
    pub fn name(mut self, name: impl Into<String>) -> Self;
    pub fn instructions(mut self, instructions: impl Into<String>) -> Self;
    pub fn model(mut self, model: Arc<dyn LlmProvider>) -> Self;
    pub fn build(self) -> Result<BasicAgent>;
}
```

**ä¼˜åŠ¿**:
- âœ… æµç•…çš„ Builder API
- âœ… ç±»å‹å®‰å…¨çš„é…ç½®
- âœ… æ”¯æŒåŠ¨æ€é…ç½®è§£æï¼ˆDynamicConfigResolverï¼‰

**é—®é¢˜**:
- âš ï¸ ä¸ Mastra çš„ DynamicArgument æ¨¡å¼ç›¸æ¯”ï¼Œç¼ºå°‘è¿è¡Œæ—¶åŠ¨æ€è§£æ
- âš ï¸ é…ç½®éªŒè¯ä¸å¤Ÿå®Œå–„
- âš ï¸ ç¼ºå°‘é…ç½®åˆå¹¶å’Œç»§æ‰¿æœºåˆ¶

#### 1.2.4 å¤š Agent åä½œç³»ç»Ÿ

**æ ¸å¿ƒæ¨¡å—**: `lumosai_core/src/agent/collaboration.rs`

**æ”¯æŒçš„åä½œæ¨¡å¼**:
1. **Sequential**: é¡ºåºæ‰§è¡Œ
2. **Parallel**: å¹¶è¡Œæ‰§è¡Œ
3. **Hierarchical**: å±‚æ¬¡åŒ–æ‰§è¡Œ
4. **GroupChat**: ç¾¤èŠæ¨¡å¼
5. **Debate**: è¾©è®ºæ¨¡å¼
6. **Handoff**: äº¤æ¥æ¨¡å¼
7. **Reflection**: åæ€æ¨¡å¼
8. **Magentic**: Magentic æ¨¡å¼
9. **MakerChecker**: åˆ¶ä½œ-æ£€æŸ¥æ¨¡å¼
10. **SOP æ¨¡å¼**: Reactã€ByOrderã€PlanAndAct

**ä¼˜åŠ¿**:
- âœ… ä¸°å¯Œçš„åä½œæ¨¡å¼
- âœ… æ”¯æŒå¤æ‚çš„å¤š Agent åœºæ™¯
- âœ… DAG ç¼–æ’æ”¯æŒ

**é—®é¢˜**:
- âš ï¸ åä½œæ¨¡å¼å®ç°åˆ†æ•£ï¼Œç¼ºå°‘ç»Ÿä¸€æŠ½è±¡
- âš ï¸ ç¼ºå°‘åä½œçŠ¶æ€æŒä¹…åŒ–
- âš ï¸ é”™è¯¯ä¼ æ’­å’Œæ¢å¤æœºåˆ¶ä¸å®Œå–„

### 1.3 Memory ç³»ç»Ÿæ·±åº¦åˆ†æ

#### 1.3.1 Memory Trait è®¾è®¡

**æ ¸å¿ƒ Trait**: `Memory` (ä½äº `lumosai_core/src/memory/mod.rs`)

```rust
#[async_trait]
pub trait Memory: Send + Sync {
    async fn store(&self, message: &Message) -> Result<()>;
    async fn retrieve(&self, config: &MemoryConfig) -> Result<Vec<Message>>;
    async fn clear(&self) -> Result<()>;
}
```

**Memory ç±»å‹**:
1. **BasicMemory**: ç®€å•å†…å­˜å­˜å‚¨
2. **WorkingMemory**: å·¥ä½œå†…å­˜ï¼ˆLRU ç¼“å­˜ï¼‰
3. **SemanticMemory**: è¯­ä¹‰å†…å­˜ï¼ˆå‘é‡æœç´¢ï¼‰
4. **UnifiedMemory**: ç»Ÿä¸€å†…å­˜æ¥å£

**ä¼˜åŠ¿**:
- âœ… æ¸…æ™°çš„ Trait æŠ½è±¡
- âœ… æ”¯æŒå¤šç§å†…å­˜ç±»å‹
- âœ… UnifiedMemory æä¾›ç»Ÿä¸€æ¥å£

**é—®é¢˜**:
- âš ï¸ Memory Trait åŠŸèƒ½ç®€å•ï¼Œç¼ºå°‘é«˜çº§ç‰¹æ€§
- âš ï¸ ä¸ Mastra çš„ Memory ç³»ç»Ÿç›¸æ¯”ï¼Œç¼ºå°‘ï¼š
  - Thread ç®¡ç†
  - Resource éš”ç¦»
  - Message Processor é“¾
  - Working Memory Template
  - è¯­ä¹‰å¬å›ï¼ˆSemantic Recallï¼‰

#### 1.3.2 Memory å®ç°å¯¹æ¯”

**LumosAI Memory**:
```rust
// ç®€å•çš„å­˜å‚¨å’Œæ£€ç´¢
pub struct BasicMemory {
    messages: Arc<RwLock<Vec<Message>>>,
    working_memory: Option<Arc<dyn WorkingMemory>>,
}
```

**Mastra Memory**:
```typescript
abstract class MastraMemory {
  protected _storage?: MastraStorage;
  vector?: MastraVector;
  embedder?: EmbeddingModel;
  private processors: MemoryProcessor[] = [];
  
  abstract rememberMessages({ threadId, resourceId, ... }): Promise<...>;
  abstract getThreadById({ threadId }): Promise<StorageThreadType | null>;
  abstract saveMessages(args): Promise<...>;
  abstract query({ threadId, resourceId, ... }): Promise<...>;
}
```

**å…³é”®å·®å¼‚**:
- Mastra æœ‰å®Œæ•´çš„ Thread å’Œ Resource æ¦‚å¿µ
- Mastra æ”¯æŒ Message Processor é“¾å¼å¤„ç†
- Mastra çš„ Memory ä¸ Storage è§£è€¦æ›´æ¸…æ™°
- Mastra æ”¯æŒè¯­ä¹‰å¬å›ï¼ˆSemantic Recallï¼‰

### 1.4 Tool ç³»ç»Ÿæ·±åº¦åˆ†æ

#### 1.4.1 Tool Trait è®¾è®¡

**æ ¸å¿ƒ Trait**: `Tool` (ä½äº `lumosai_core/src/tool/tool.rs`)

```rust
#[async_trait]
pub trait Tool: Send + Sync {
    fn id(&self) -> &str;
    fn description(&self) -> &str;
    fn schema(&self) -> ToolSchema;
    fn output_schema(&self) -> Option<Value>;
    
    async fn execute(
        &self,
        params: Value,
        context: ToolExecutionContext,
        options: &ToolExecutionOptions,
    ) -> Result<Value>;
    
    fn clone_box(&self) -> Box<dyn Tool>;
}
```

**ä¼˜åŠ¿**:
- âœ… æ¸…æ™°çš„ Tool æŠ½è±¡
- âœ… æ”¯æŒ Schema éªŒè¯
- âœ… æ”¯æŒè¾“å‡º Schema éªŒè¯
- âœ… å®Œæ•´çš„æ‰§è¡Œä¸Šä¸‹æ–‡

**é—®é¢˜**:
- âš ï¸ ç¼ºå°‘ Tool æ³¨å†Œå’Œå‘ç°æœºåˆ¶
- âš ï¸ ç¼ºå°‘ Tool çš„ä¾èµ–ç®¡ç†
- âš ï¸ ç¼ºå°‘ Tool çš„ç‰ˆæœ¬ç®¡ç†

#### 1.4.2 Function Calling æ”¯æŒ

**æ ¸å¿ƒå®ç°**: `lumosai_core/src/llm/function_calling.rs`

**æ”¯æŒçš„æ ¼å¼**:
- OpenAI Function Calling
- Anthropic Tool Use
- é€šç”¨ Function Calling

**ä¼˜åŠ¿**:
- âœ… æ”¯æŒå¤šç§ Function Calling æ ¼å¼
- âœ… è‡ªåŠ¨è½¬æ¢å·¥å…·å®šä¹‰
- âœ… æ”¯æŒå·¥å…·é€‰æ‹©ç­–ç•¥

**é—®é¢˜**:
- âš ï¸ ä¸åŒ Provider çš„ Function Calling å®ç°ä¸ä¸€è‡´
- âš ï¸ ç¼ºå°‘å·¥å…·è°ƒç”¨çš„å¹¶å‘æ§åˆ¶
- âš ï¸ é”™è¯¯å¤„ç†ä¸å¤Ÿå®Œå–„

### 1.5 Workflow ç³»ç»Ÿæ·±åº¦åˆ†æ

#### 1.5.1 Workflow Trait è®¾è®¡

**æ ¸å¿ƒ Trait**: `Workflow` (ä½äº `lumosai_core/src/workflow/mod.rs`)

```rust
#[async_trait]
pub trait Workflow: Send + Sync {
    fn name(&self) -> &str;
    fn description(&self) -> Option<&str>;
    
    async fn execute(&self, input: Value, context: &RuntimeContext) -> Result<Value>;
    async fn get_status(&self, run_id: &str) -> Result<WorkflowStatus>;
}
```

**Workflow ç±»å‹**:
1. **BasicWorkflow**: åŸºç¡€å·¥ä½œæµ
2. **DagWorkflow**: DAG å·¥ä½œæµ
3. **EnhancedWorkflow**: å¢å¼ºå·¥ä½œæµ

**ä¼˜åŠ¿**:
- âœ… æ”¯æŒ DAG ç¼–æ’
- âœ… æ”¯æŒå¹¶è¡Œæ‰§è¡Œ
- âœ… æ”¯æŒé‡è¯•å’Œé”™è¯¯å¤„ç†

**é—®é¢˜**:
- âš ï¸ Workflow ä¸ Agent é›†æˆä¸å¤Ÿç´§å¯†
- âš ï¸ ç¼ºå°‘ Workflow çš„çŠ¶æ€æŒä¹…åŒ–
- âš ï¸ ç¼ºå°‘ Workflow çš„å¯è§†åŒ–

### 1.6 LLM Provider ç³»ç»Ÿåˆ†æ

#### 1.6.1 LlmProvider Trait

**æ ¸å¿ƒ Trait**: `LlmProvider` (ä½äº `lumosai_core/src/llm/provider.rs`)

```rust
#[async_trait]
pub trait LlmProvider: Send + Sync {
    fn name(&self) -> &str;
    fn model_id(&self) -> &str;
    
    async fn generate(&self, messages: &[Message], options: &LlmOptions) -> Result<LlmResponse>;
    async fn generate_stream(&self, messages: &[Message], options: &LlmOptions) -> Result<BoxStream<'_, Result<String>>>;
    async fn generate_embedding(&self, text: &str) -> Result<Vec<f32>>;
    
    async fn generate_with_functions(
        &self,
        messages: &[Message],
        functions: &[FunctionDefinition],
        tool_choice: &LlmToolChoice,
        options: &LlmOptions,
    ) -> Result<FunctionCallingResponse>;
}
```

**æ”¯æŒçš„ Provider**:
- OpenAI
- Anthropic (Claude)
- Qwen
- Zhipu
- DeepSeek
- Baidu
- Huawei MaaS
- Ollama
- Together
- Cohere
- Gemini

**ä¼˜åŠ¿**:
- âœ… ç»Ÿä¸€çš„ Provider æŠ½è±¡
- âœ… æ”¯æŒå¤šç§ä¸­å›½æœ¬åœŸ LLM
- âœ… å®Œæ•´çš„æµå¼æ”¯æŒ
- âœ… Function Calling æ”¯æŒ

**é—®é¢˜**:
- âœ… ä¸åŒ Provider çš„å‚æ•°ä¸ä¸€è‡´ - **å·²è§£å†³ï¼ˆ2025-11-21ï¼‰**ï¼šæ‰€æœ‰ Provider ç»Ÿä¸€ä½¿ç”¨ `LlmOptions` ç»“æ„
- âœ… ç¼ºå°‘æ™ºèƒ½è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ - **å·²è§£å†³**ï¼šå·²å®ç° `LlmRouter` æ”¯æŒå¤šç§è·¯ç”±ç­–ç•¥
- âœ… ç¼ºå°‘æˆæœ¬ç›‘æ§ - **å·²è§£å†³ï¼ˆ2025-11-21ï¼‰**ï¼šå®ç°äº† `CostMonitor` ç³»ç»Ÿï¼Œæ”¯æŒæˆæœ¬è·Ÿè¸ªã€æŸ¥è¯¢å’ŒæŠ¥å‘ŠåŠŸèƒ½
- âœ… ç¼ºå°‘ Provider çš„å¥åº·æ£€æŸ¥ - **å·²è§£å†³ï¼ˆ2025-11-21ï¼‰**ï¼šåœ¨ `LlmProvider` trait ä¸­æ·»åŠ äº† `is_healthy()` æ–¹æ³•

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šMastra æ¶æ„æ·±åº¦åˆ†æ

### 2.1 Mastra æ•´ä½“æ¶æ„

#### 2.1.1 æ ¸å¿ƒè®¾è®¡ç†å¿µ

**Mastra çš„è®¾è®¡åŸåˆ™**:
1. **Dynamic Arguments**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è§£æé…ç½®
2. **Unified Abstractions**: ç»Ÿä¸€çš„æŠ½è±¡å±‚
3. **Plugin System**: æ’ä»¶åŒ–æ¶æ„
4. **Type Safety**: TypeScript ç±»å‹å®‰å…¨
5. **Developer Experience**: ä¼˜ç§€çš„å¼€å‘ä½“éªŒ

#### 2.1.2 Agent è®¾è®¡

**æ ¸å¿ƒç±»**: `Agent` (ä½äº `packages/core/src/agent/index.ts`)

**å…³é”®ç‰¹æ€§**:
```typescript
export class Agent<TAgentId, TTools, TMetrics> extends MastraBase {
  public id: TAgentId;
  public name: TAgentId;
  #instructions: DynamicArgument<string>;
  readonly model?: DynamicArgument<MastraLanguageModel>;
  #tools: DynamicArgument<TTools>;
  #workflows?: DynamicArgument<Record<string, Workflow>>;
  #memory?: MastraMemory;
  
  // åŠ¨æ€è§£ææ–¹æ³•
  public async getInstructions({ runtimeContext }): Promise<string>;
  public async getTools({ runtimeContext }): Promise<TTools>;
  public async getWorkflows({ runtimeContext }): Promise<Record<string, Workflow>>;
}
```

**ä¼˜åŠ¿**:
- âœ… DynamicArgument æ¨¡å¼æ”¯æŒè¿è¡Œæ—¶é…ç½®
- âœ… ç±»å‹å®‰å…¨çš„å·¥å…·å’Œé…ç½®
- âœ… æ¸…æ™°çš„èŒè´£åˆ†ç¦»
- âœ… å®Œæ•´çš„ Memory é›†æˆ

### 2.2 Mastra Memory ç³»ç»Ÿ

#### 2.2.1 Memory æŠ½è±¡

**æ ¸å¿ƒç±»**: `MastraMemory` (ä½äº `packages/core/src/memory/memory.ts`)

**å…³é”®ç‰¹æ€§**:
```typescript
abstract class MastraMemory extends MastraBase {
  protected _storage?: MastraStorage;
  vector?: MastraVector;
  embedder?: EmbeddingModel;
  private processors: MemoryProcessor[] = [];
  
  // Thread ç®¡ç†
  abstract getThreadById({ threadId }): Promise<StorageThreadType | null>;
  abstract saveThread({ thread, memoryConfig }): Promise<StorageThreadType>;
  
  // Message ç®¡ç†
  abstract rememberMessages({ threadId, resourceId, ... }): Promise<...>;
  abstract saveMessages(args): Promise<...>;
  abstract query({ threadId, resourceId, ... }): Promise<...>;
  
  // Message Processor
  processMessages({ messages, processors, ... }): CoreMessage[];
}
```

**ä¼˜åŠ¿**:
- âœ… å®Œæ•´çš„ Thread å’Œ Resource æ¦‚å¿µ
- âœ… Message Processor é“¾å¼å¤„ç†
- âœ… è¯­ä¹‰å¬å›ï¼ˆSemantic Recallï¼‰æ”¯æŒ
- âœ… Working Memory Template æ”¯æŒ

### 2.3 Mastra å·¥å…·ç³»ç»Ÿ

**æ ¸å¿ƒç‰¹æ€§**:
- ç±»å‹å®‰å…¨çš„å·¥å…·å®šä¹‰
- å·¥å…·é›†ï¼ˆToolsetsï¼‰æ”¯æŒ
- åŠ¨æ€å·¥å…·è§£æ
- å·¥å…·ä¾èµ–ç®¡ç†

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šå¯¹æ¯”åˆ†æä¸é—®é¢˜è¯†åˆ«

### 3.1 æ¶æ„å¯¹æ¯”

| ç»´åº¦ | LumosAI | Mastra | ä¼˜åŠ¿æ–¹ |
|------|---------|--------|--------|
| **è¯­è¨€ç”Ÿæ€** | Rust | TypeScript | LumosAI (æ€§èƒ½ä¼˜åŠ¿) |
| **ç±»å‹å®‰å…¨** | ç¼–è¯‘æ—¶ | ç¼–è¯‘æ—¶ | å¹³æ‰‹ |
| **åŠ¨æ€é…ç½®** | æœ‰é™æ”¯æŒ | DynamicArgument | Mastra |
| **Memory ç³»ç»Ÿ** | åŸºç¡€å®ç° | å®Œæ•´å®ç° | Mastra |
| **Tool ç³»ç»Ÿ** | åŸºç¡€å®ç° | ç±»å‹å®‰å…¨ | Mastra |
| **å¤š Agent åä½œ** | ä¸°å¯Œæ¨¡å¼ | åŸºç¡€æ”¯æŒ | LumosAI |
| **Workflow** | DAG æ”¯æŒ | å®Œæ•´æ”¯æŒ | å¹³æ‰‹ |
| **é”™è¯¯å¤„ç†** | åˆ†æ•£ | ç»Ÿä¸€ | Mastra |
| **API ä¸€è‡´æ€§** | éƒ¨åˆ†ä¸ä¸€è‡´ | é«˜åº¦ä¸€è‡´ | Mastra |

### 3.2 æ ¸å¿ƒé—®é¢˜è¯†åˆ«

#### 3.2.1 æ¶æ„é—®é¢˜

**é—®é¢˜ 1: Agent Trait èŒè´£è¿‡é‡**
- **ç°çŠ¶**: Agent Trait æœ‰ 50+ æ–¹æ³•ï¼ŒèŒè´£ä¸å•ä¸€
- **å½±å“**: éš¾ä»¥ç»´æŠ¤ï¼Œæ‰©å±•å›°éš¾
- **ä¼˜å…ˆçº§**: P0

**é—®é¢˜ 2: Memory ç³»ç»ŸåŠŸèƒ½ä¸è¶³**
- **ç°çŠ¶**: ç¼ºå°‘ Thread ç®¡ç†ã€Resource éš”ç¦»ã€Message Processor
- **å½±å“**: æ— æ³•æ”¯æŒå¤æ‚çš„ Memory åœºæ™¯
- **ä¼˜å…ˆçº§**: P0

**é—®é¢˜ 3: ç¼ºå°‘ç»Ÿä¸€çš„é”™è¯¯å¤„ç†**
- **ç°çŠ¶**: é”™è¯¯å¤„ç†åˆ†æ•£åœ¨å„ä¸ªæ¨¡å—
- **å½±å“**: éš¾ä»¥ç»Ÿä¸€å¤„ç†å’Œæ¢å¤
- **ä¼˜å…ˆçº§**: P1

**é—®é¢˜ 4: API ä¸€è‡´æ€§ä¸è¶³**
- **ç°çŠ¶**: ä¸åŒæ¨¡å—çš„ API é£æ ¼ä¸ä¸€è‡´
- **å½±å“**: å­¦ä¹ æˆæœ¬é«˜ï¼Œæ˜“å‡ºé”™
- **ä¼˜å…ˆçº§**: P1

#### 3.2.2 å®ç°é—®é¢˜

**é—®é¢˜ 5: BasicAgent å®ç°è¿‡äºå¤æ‚**
- **ç°çŠ¶**: executor.rs æœ‰ 2000+ è¡Œä»£ç 
- **å½±å“**: éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•
- **ä¼˜å…ˆçº§**: P0

**é—®é¢˜ 6: ç¼ºå°‘åŠ¨æ€é…ç½®æ”¯æŒ**
- **ç°çŠ¶**: é…ç½®ä¸»è¦æ˜¯é™æ€çš„
- **å½±å“**: æ— æ³•æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´
- **ä¼˜å…ˆçº§**: P1

**é—®é¢˜ 7: Tool ç³»ç»ŸåŠŸèƒ½ä¸è¶³**
- **ç°çŠ¶**: ç¼ºå°‘ Tool æ³¨å†Œã€å‘ç°ã€ä¾èµ–ç®¡ç†
- **å½±å“**: éš¾ä»¥ç®¡ç†å¤§é‡å·¥å…·
- **ä¼˜å…ˆçº§**: P1

**é—®é¢˜ 8: LLM Provider å‚æ•°ä¸ä¸€è‡´** âœ… **å·²è§£å†³ï¼ˆåˆ†æå®Œæˆï¼Œ2025-11-21ï¼‰**
- **ç°çŠ¶**: ä¸åŒ Provider çš„å‚æ•°æ ¼å¼ä¸ä¸€è‡´
- **å½±å“**: åˆ‡æ¢ Provider å›°éš¾
- **ä¼˜å…ˆçº§**: P2
- **åˆ†æç»“æœ**ï¼ˆ2025-11-21ï¼‰ï¼š
  - æ‰€æœ‰ Provider éƒ½å®ç°äº†ç»Ÿä¸€çš„ `LlmProvider` trait
  - æ–¹æ³•ç­¾åæ˜¯ä¸€è‡´çš„ï¼ˆ`generate`, `generate_with_messages`, `generate_stream` ç­‰ï¼‰
  - å‚æ•°é€šè¿‡ç»Ÿä¸€çš„ `LlmOptions` ç»“æ„ä¼ é€’
  - ä¸åŒ Provider çš„ç‰¹æ®Šå¤„ç†å·²ç»åœ¨ä»£ç ä¸­å®ç°ï¼ˆå¦‚ Zhipu çš„æ¸©åº¦å€¼æ˜ å°„åˆ° 0.0/0.5/1.0ï¼‰
  - **ç»“è®º**ï¼šLLM Provider å‚æ•°å·²ç»é€šè¿‡ç»Ÿä¸€çš„ `LlmOptions` ç»“æ„ç»Ÿä¸€åŒ–ï¼Œä¸åŒ Provider çš„ç‰¹æ®Šéœ€æ±‚å·²ç»åœ¨å„è‡ªçš„å®ç°ä¸­å¤„ç†ï¼Œä¸éœ€è¦å¤§è§„æ¨¡é‡æ„

#### 3.2.3 æ€§èƒ½é—®é¢˜

**é—®é¢˜ 9: å·¥å…·è°ƒç”¨ç¼ºå°‘å¹¶å‘æ§åˆ¶**
- **ç°çŠ¶**: å·¥å…·è°ƒç”¨æ˜¯ä¸²è¡Œçš„
- **å½±å“**: æ€§èƒ½ç“¶é¢ˆ
- **ä¼˜å…ˆçº§**: P1

**é—®é¢˜ 10: ç¼ºå°‘æ™ºèƒ½è·¯ç”±**
- **ç°çŠ¶**: LLM Provider é€‰æ‹©æ˜¯é™æ€çš„
- **å½±å“**: æ— æ³•æ ¹æ®è´Ÿè½½å’Œæˆæœ¬ä¼˜åŒ–
- **ä¼˜å…ˆçº§**: P2

### 3.3 ä¼˜åŠ¿åˆ†æ

#### 3.3.1 LumosAI çš„æ ¸å¿ƒä¼˜åŠ¿

**ä¼˜åŠ¿ 1: Rust ç”Ÿæ€ä¼˜åŠ¿**
- âœ… æ€§èƒ½ä¼˜åŠ¿ï¼šé›¶æˆæœ¬æŠ½è±¡ï¼Œå†…å­˜å®‰å…¨
- âœ… å¹¶å‘ä¼˜åŠ¿ï¼šasync/await åŸç”Ÿæ”¯æŒ
- âœ… è·¨å¹³å°ï¼šå¯ç¼–è¯‘åˆ°å¤šç§å¹³å°

**ä¼˜åŠ¿ 2: ä¸°å¯Œçš„å¤š Agent åä½œæ¨¡å¼**
- âœ… 10+ ç§åä½œæ¨¡å¼
- âœ… DAG ç¼–æ’æ”¯æŒ
- âœ… SOP æ¨¡å¼æ”¯æŒ

**ä¼˜åŠ¿ 3: å®Œæ•´çš„æµå¼æ”¯æŒ**
- âœ… çœŸå®çš„ SSE æµå¼
- âœ… WebSocket æ”¯æŒ
- âœ… äº‹ä»¶é©±åŠ¨çš„æµå¼æ¶æ„

**ä¼˜åŠ¿ 4: ä¸­å›½æœ¬åœŸåŒ–æ”¯æŒ**
- âœ… æ”¯æŒ Qwenã€Zhipuã€DeepSeekã€Baidu ç­‰
- âœ… ç¬¦åˆä¸­å›½ç”¨æˆ·ä¹ æƒ¯

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ”¹é€ è®¡åˆ’

### 4.1 æ”¹é€ åŸåˆ™

1. **ä¿æŒ Rust ä¼˜åŠ¿**: ä¸æ”¹å˜è¯­è¨€ç”Ÿæ€
2. **å€Ÿé‰´ Mastra è®¾è®¡**: å­¦ä¹ ä¼˜ç§€çš„æ¶æ„æ¨¡å¼
3. **æ¸è¿›å¼æ”¹é€ **: åˆ†é˜¶æ®µå®æ–½ï¼Œä¿è¯ç¨³å®šæ€§
4. **å‘åå…¼å®¹**: å°½é‡ä¿æŒ API å…¼å®¹æ€§
5. **æ€§èƒ½ä¼˜å…ˆ**: ä¸ç‰ºç‰²æ€§èƒ½æ¢å–åŠŸèƒ½

### 4.2 é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¶æ„é‡æ„ (P0)

#### 4.2.1 Agent Trait æ‹†åˆ† âœ… **åŸºç¡€å®ç°å·²å®Œæˆ**

**çŠ¶æ€**: âœ… åŸºç¡€å®ç°å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: 3 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡

**ç›®æ ‡**: å°† Agent Trait æ‹†åˆ†ä¸ºå¤šä¸ªèŒè´£å•ä¸€çš„ Trait

**æ–¹æ¡ˆ**:
```rust
// æ ¸å¿ƒ Agent Traitï¼ˆç²¾ç®€ï¼‰
pub trait Agent: Base + Send + Sync {
    fn get_name(&self) -> &str;
    fn get_llm(&self) -> Arc<dyn LlmProvider>;
    async fn generate(&self, messages: &[Message], options: &AgentGenerateOptions) -> Result<AgentGenerateResult>;
}

// Memory Agent Trait
pub trait MemoryAgent: Agent {
    fn get_memory(&self) -> Option<Arc<dyn Memory>>;
    async fn generate_with_memory(&self, messages: &[Message], thread_id: Option<String>, options: &AgentGenerateOptions) -> Result<AgentGenerateResult>;
}

// Tool Agent Trait
pub trait ToolAgent: Agent {
    fn get_tools(&self) -> HashMap<String, Box<dyn Tool>>;
    async fn get_tools_with_context(&self, context: &RuntimeContext) -> Result<HashMap<String, Box<dyn Tool>>>;
}

// Streaming Agent Trait
pub trait StreamingAgent: Agent {
    async fn stream(&self, messages: &[Message], options: &AgentStreamOptions) -> Result<BoxStream<'_, Result<String>>>;
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… åˆ›å»ºæ–°çš„ Trait å®šä¹‰ï¼ˆå·²å®Œæˆï¼Œtraits.rs æ¨¡å—ï¼‰
2. âœ… å®ç° Trait çš„é»˜è®¤å®ç°ï¼ˆå·²å®Œæˆï¼‰
3. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œ3 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
4. âœ… è¿ç§» BasicAgent å®ç°ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - BasicAgent å·²é‡æ„ä¸ºæ¨¡å—åŒ–æ¶æ„
   - æ–°çš„ BasicAgent å®ç°äº†æ‰€æœ‰å¿…è¦çš„ Trait
   - æ—§çš„å•ä½“å®ç°å·²å®Œå…¨ç§»é™¤
5. âœ… æ›´æ–°æ‰€æœ‰ä½¿ç”¨ Agent çš„ä»£ç ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - BasicAgent å·²å®ç°å®Œæ•´çš„ Agent trait
   - æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å·²æ›´æ–°ä»¥ä½¿ç”¨æ–°çš„ BasicAgent
   - streaming.rsã€websocket_demo.rsã€builder.rs ç­‰å·²æ›´æ–°
   - structured_output.rsã€rag_integration.rs ç­‰å·²æ›´æ–°
   - æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²æ›´æ–°
6. âœ… åºŸå¼ƒæ—§çš„ Agent Trait æ–¹æ³•ï¼ˆåˆ†æå®Œæˆï¼Œ2025-11-21ï¼‰
   - **åˆ†æç»“æœ**ï¼š
     - æ–°çš„ BasicAgent å·²å®ç°æ‰€æœ‰ Agent trait æ–¹æ³•
     - æ—§çš„å®ç°å·²å®Œå…¨ç§»é™¤
     - Agent trait ä¸­çš„æ–¹æ³•å¤§éƒ¨åˆ†éƒ½åœ¨ä½¿ç”¨ä¸­ï¼Œä¸å»ºè®®ç«‹å³åºŸå¼ƒ
     - æ–°çš„ traits.rs æä¾›äº†æ›´æ¨¡å—åŒ–çš„æ¥å£ï¼ˆCoreAgent, MemoryAgent, ToolAgent ç­‰ï¼‰
     - å»ºè®®ï¼šä¿æŒç°æœ‰ API å…¼å®¹æ€§ï¼Œæ–°ä»£ç å¯ä»¥ä½¿ç”¨ traits.rs ä¸­çš„æ¨¡å—åŒ–æ¥å£
   - **ç»“è®º**ï¼šç”±äºæ‰€æœ‰æ–¹æ³•éƒ½åœ¨ä½¿ç”¨ä¸­ï¼Œä¸”æ–°çš„ BasicAgent å·²å®Œå…¨å®ç°ï¼Œæš‚æ—¶ä¸éœ€è¦åºŸå¼ƒä»»ä½•æ–¹æ³•ã€‚æ–°çš„ traits.rs æä¾›äº†æ›´å¥½çš„æ¨¡å—åŒ–é€‰æ‹©ï¼Œä½†ä¸å¼ºåˆ¶è¿ç§»ã€‚

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… åˆ›å»ºäº† `traits.rs` æ¨¡å—
- âœ… å®ç°äº† `CoreAgent` Traitï¼ˆæ ¸å¿ƒ Agentï¼Œç²¾ç®€ç‰ˆï¼‰
  - `get_name()` - è·å– Agent åç§°
  - `get_llm()` - è·å– LLM Provider
  - `generate()` - ç”Ÿæˆå“åº”
- âœ… å®ç°äº† `MemoryAgent` Traitï¼ˆå†…å­˜ Agentï¼‰
  - `get_memory()` - è·å–å†…å­˜å®ä¾‹
  - `generate_with_memory()` - ä½¿ç”¨å†…å­˜ç”Ÿæˆå“åº”ï¼ˆå¸¦é»˜è®¤å®ç°ï¼‰
- âœ… å®ç°äº† `ToolAgent` Traitï¼ˆå·¥å…· Agentï¼‰
  - `get_tools()` - è·å–æ‰€æœ‰å·¥å…·
  - `get_tools_with_context()` - æ ¹æ®ä¸Šä¸‹æ–‡è·å–å·¥å…·ï¼ˆå¸¦é»˜è®¤å®ç°ï¼‰
- âœ… å®ç°äº† `StreamingAgentTrait` Traitï¼ˆæµå¼ Agentï¼‰
  - `stream()` - æµå¼ç”Ÿæˆå“åº”
- âœ… å®ç°äº† `FullAgent` Traitï¼ˆç»„åˆæ‰€æœ‰åŠŸèƒ½ï¼‰
  - è‡ªåŠ¨ä¸ºå®ç°äº†æ‰€æœ‰ Trait çš„ç±»å‹æä¾›å®ç°
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡éªŒè¯
- âœ… å·²å¯¼å‡ºåˆ° `agent` æ¨¡å—ï¼Œå¯ä¾›ä½¿ç”¨

**ä½¿ç”¨ç¤ºä¾‹**:
```rust
use lumosai_core::agent::traits::{CoreAgent, MemoryAgent, ToolAgent, StreamingAgentTrait};

// ä½¿ç”¨ CoreAgent
let name = agent.get_name();
let llm = agent.get_llm();
let result = agent.generate(&messages, &options).await?;

// ä½¿ç”¨ MemoryAgent
if let Some(memory) = agent.get_memory() {
    let result = agent.generate_with_memory(&messages, Some(thread_id), &options).await?;
}

// ä½¿ç”¨ ToolAgent
let tools = agent.get_tools();
let context_tools = agent.get_tools_with_context(&context).await?;

// ä½¿ç”¨ StreamingAgentTrait
let mut stream = agent.stream(&messages, &stream_options).await?;
while let Some(chunk) = stream.next().await {
    print!("{}", chunk?);
}
```

**æ—¶é—´ä¼°ç®—**: 2-3 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å’Œæµ‹è¯•ï¼Œå®Œæ•´è¿ç§»å¾…åç»­å®Œæˆï¼‰

#### 4.2.2 Memory ç³»ç»Ÿé‡æ„

**ç›®æ ‡**: å®ç°å®Œæ•´çš„ Memory ç³»ç»Ÿï¼Œå¯¹æ ‡ Mastra

**æ–¹æ¡ˆ**:
```rust
// å¢å¼ºçš„ Memory Trait
#[async_trait]
pub trait Memory: Send + Sync {
    // åŸºç¡€æ–¹æ³•
    async fn store(&self, message: &Message) -> Result<()>;
    async fn retrieve(&self, config: &MemoryConfig) -> Result<Vec<Message>>;
    
    // Thread ç®¡ç†
    async fn get_thread(&self, thread_id: &str) -> Result<Option<Thread>>;
    async fn create_thread(&self, thread: Thread) -> Result<Thread>;
    async fn update_thread(&self, thread: Thread) -> Result<Thread>;
    
    // Resource éš”ç¦»
    async fn get_threads_by_resource(&self, resource_id: &str) -> Result<Vec<Thread>>;
    
    // Message Processor
    fn add_processor(&mut self, processor: Arc<dyn MemoryProcessor>);
    async fn process_messages(&self, messages: Vec<Message>) -> Result<Vec<Message>>;
    
    // è¯­ä¹‰å¬å›
    async fn semantic_recall(&self, query: &str, config: &SemanticRecallConfig) -> Result<Vec<Message>>;
}

// Thread ç»“æ„
pub struct Thread {
    pub id: String,
    pub resource_id: Option<String>,
    pub title: Option<String>,
    pub metadata: HashMap<String, Value>,
    pub created_at: DateTime<Utc>,
    pub updated_at: DateTime<Utc>,
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… è®¾è®¡ Thread å’Œ Resource æ•°æ®ç»“æ„ï¼ˆ`memory/thread.rs` å†… MemoryThread/ThreadStats ç­‰ç»“æ„å·²è¡¥å…¨ï¼‰
2. âœ… å®ç° Thread ç®¡ç†æ¥å£ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - æ–°å¢ `InMemoryThreadStorage` + `MemoryThreadManager`ï¼Œæ”¯æŒ CRUD/åˆ†é¡µ/è¿‡æ»¤/ç»Ÿè®¡
   - Memory trait æ–°å¢ `get_threads_by_resource` æ–¹æ³•ï¼Œæ”¯æŒèµ„æºéš”ç¦»
   - BasicMemory å’Œ UnifiedMemory å®ç°æ­¤æ–¹æ³•
   - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯èµ„æºéš”ç¦»åŠŸèƒ½
3. âœ… å®ç° Message Processor ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - MemoryThreadManager æ”¯æŒ Processor ç®¡çº¿ï¼Œæ–°å¢ `add_processor`/`process_messages`
   - Memory trait æ–°å¢ `add_processor` å’Œ `process_messages` æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°
   - BasicMemory å’Œ UnifiedMemory å®ç°è¿™äº›æ–¹æ³•ï¼Œæ”¯æŒé€šè¿‡ trait å¯¹è±¡è°ƒç”¨
   - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ Memory trait è°ƒç”¨ Processor æ–¹æ³•çš„åŠŸèƒ½
4. âœ… å®ç°è¯­ä¹‰å¬å›åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - Memory trait æ–°å¢ `semantic_recall` æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°
   - BasicMemory å’Œ UnifiedMemory å®ç°æ­¤æ–¹æ³•ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢
   - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ Memory trait è°ƒç”¨è¯­ä¹‰å¬å›åŠŸèƒ½
5. âœ… è¿ç§»ç°æœ‰ Memory å®ç°ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - BasicMemory å’Œ UnifiedMemory æ–°å¢ä¾¿æ·çš„ Thread ç®¡ç†æ–¹æ³•ï¼ˆcreate_thread, get_thread, update_thread, delete_thread, list_threads, get_thread_statsï¼‰
   - æ”¯æŒé€šè¿‡ Memory å®ä¾‹ç›´æ¥ç®¡ç†çº¿ç¨‹ï¼Œæ— éœ€å…ˆè·å– thread_storage
   - æ–°å¢ 4 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯ Thread ç®¡ç†åŠŸèƒ½
6. âœ… æ›´æ–° Agent é›†æˆï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - Memory trait æ–°å¢ Thread ç®¡ç†æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°ï¼ˆè¿”å›é”™è¯¯ï¼‰
   - BasicMemory å’Œ UnifiedMemory è¦†ç›–è¿™äº›æ–¹æ³•ï¼Œæä¾›çœŸå®å®ç°
   - æ–°å¢ ThreadManagementAgent traitï¼Œä¸º Agent æä¾› Thread ç®¡ç†ä¾¿æ·æ–¹æ³•ï¼ˆå¯é€‰æ‰©å±•ï¼‰
   - ç”¨æˆ·å¯é€šè¿‡ `agent.get_memory()?.create_thread(...)` ä½¿ç”¨ Thread ç®¡ç†åŠŸèƒ½
   - æ–°å¢ 1 ä¸ªé›†æˆæµ‹è¯•éªŒè¯ Agent é€šè¿‡ Memory ç®¡ç†çº¿ç¨‹çš„åŠŸèƒ½

**æœ€æ–°è¿›å±•ï¼ˆ2025-01-XXï¼‰**:
- âœ… å®Œæˆçº¿ç¨‹ä¸èµ„æºç®¡ç†åŸºç¡€è®¾æ–½  
  - åœ¨ `memory/thread.rs` æ–°å¢ `InMemoryThreadStorage`ï¼Œå®ç°çº¿ç¨‹ CRUDã€æ¶ˆæ¯å¢åˆ æŸ¥ã€æœç´¢ä¸ç»Ÿè®¡  
  - `MemoryThreadManager` ç°å·²å…·å¤‡èµ„æº/Agent æ‰€æœ‰æƒæ ¡éªŒï¼Œå¹¶æ–°å¢ Processor ç®¡çº¿ï¼ˆæ”¯æŒæ³¨å†Œã€æ‰‹åŠ¨è°ƒç”¨ã€é»˜è®¤å¥—ç”¨åœ¨ `get_messages`ï¼‰  
  - æ–°å¢ 7 ä¸ªå•å…ƒæµ‹è¯•ï¼ˆçº¿ç¨‹ CRUDã€æ¶ˆæ¯è¿‡æ»¤/ç»Ÿè®¡ã€Processor ç®¡çº¿ç­‰ï¼‰å…¨éƒ¨é€šè¿‡  
- âœ… ï¼ˆ2025-11-21ï¼‰BasicMemory/BasicAgent å®Œæˆçº¿ç¨‹çº§é›†æˆ  
  - `BasicAgent` åœ¨æŒä¹…åŒ–ç”¨æˆ·/åŠ©æ‰‹æ¶ˆæ¯å‰è‡ªåŠ¨æ³¨å…¥ `thread_id`/`resource_id` å…ƒæ•°æ®ï¼Œç¡®ä¿ Memory å±‚æ„ŸçŸ¥çº¿ç¨‹ä¸Šä¸‹æ–‡  
  - `BasicMemory` ç°åœ¨èƒ½å¤ŸåŸºäºå…ƒæ•°æ®é‡ç”¨æˆ–è‡ªåŠ¨åˆ›å»ºçº¿ç¨‹ï¼Œå¹¶æ”¯æŒæŒ‰ `namespace`ï¼ˆthread_idï¼‰æˆ– `store_id`ï¼ˆresourceï¼‰æ£€ç´¢å†å²  
  - æ–°å¢ 3 ä¸ªå•å…ƒæµ‹è¯•éªŒè¯çº¿ç¨‹æ¶ˆæ¯å­˜å‚¨ã€æŒ‰èµ„æºè‡ªåŠ¨å»ºçº¿ç¨‹ä»¥åŠå‘½åç©ºé—´æ£€ç´¢ï¼Œå‡å·²é€šè¿‡  
- âœ… ï¼ˆ2025-11-21ï¼‰`generate_with_memory` çº¿ç¨‹ä¸Šä¸‹æ–‡å¢å¼º  
  - è‡ªåŠ¨ç»§æ‰¿è°ƒç”¨å…¥å‚ / æ¶ˆæ¯å…ƒæ•°æ®ä¸­çš„ thread/resourceï¼Œç»Ÿä¸€ MemoryConfig namespace/store_id  
  - é»˜è®¤æ ¹æ® context_window æ„å»º last_messagesï¼Œç¡®ä¿æ£€ç´¢çª—å£ä¸€è‡´  
  - æ–°å¢ MockMemoryWithThreads é›†æˆæµ‹è¯•éªŒè¯ thread çº§æŒä¹…åŒ–é“¾è·¯  
- âœ… ï¼ˆ2025-11-21ï¼‰Processor ç®¡çº¿æ¥å…¥ `BasicMemory`/`UnifiedMemory`  
  - BasicMemory æ”¯æŒå»¶è¿Ÿæ³¨å†Œ Processorï¼Œå¹¶åœ¨è®¾ç½®çº¿ç¨‹å­˜å‚¨åè‡ªåŠ¨åŒæ­¥  
  - UnifiedMemory `add_processor`/`with_thread_storage` è‡ªåŠ¨æŠŠå¤„ç†å™¨ä¸‹æ²‰åˆ°åŸºç¡€å†…å­˜  
  - æ–°å¢ 2 ä¸ªå›å½’æµ‹è¯•éªŒè¯é™æµ Processor åœ¨ Basic/Unified åœºæ™¯ä¸‹ç”Ÿæ•ˆ  
- âœ… ï¼ˆ2025-11-21ï¼‰è¯­ä¹‰å¬å›ç»Ÿä¸€æ¥å£å®Œå–„  
  - `BasicMemory::retrieve` æ”¯æŒçº¿ç¨‹å†å²æ¶ˆæ¯ä¸è¯­ä¹‰å¬å›ç»“æœåˆå¹¶ï¼Œçº¿ç¨‹æ¶ˆæ¯åœ¨å‰ï¼ˆæŒ‰æ—¶é—´é¡ºåºï¼‰ï¼Œè¯­ä¹‰ç»“æœåœ¨å  
  - `UnifiedMemory::semantic_recall` æ–°å¢ä¸“ç”¨æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨è¯­ä¹‰å†…å­˜ searchï¼Œé¿å…æ··å…¥çº¿ç¨‹å†å²  
  - `UnifiedMemory::retrieve` åœ¨ Hybrid æ¨¡å¼ä¸‹æ­£ç¡®åˆå¹¶çº¿ç¨‹å†å²ä¸è¯­ä¹‰å¬å›ï¼Œä¿æŒé¡ºåºä¸€è‡´æ€§  
  - ä¿®å¤ `GetMessagesParams::reverse_order` ç¡®ä¿ `last_messages` è¿”å›æœ€æ–°æ¶ˆæ¯  
  - æ–°å¢ 2 ä¸ªé›†æˆæµ‹è¯•éªŒè¯è¯­ä¹‰å¬å›ä¸çº¿ç¨‹å†å²çš„æ··åˆæ£€ç´¢é€»è¾‘
- âœ… ï¼ˆ2025-11-21ï¼‰Memory Thread ç®¡ç†ä¾¿æ·æ–¹æ³•  
  - `BasicMemory` æ–°å¢ Thread ç®¡ç†æ–¹æ³•ï¼š`create_thread`, `get_thread`, `update_thread`, `delete_thread`, `list_threads`, `get_thread_stats`  
  - `UnifiedMemory` æ–°å¢ç›¸åŒçš„ Thread ç®¡ç†æ–¹æ³•ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£  
  - æ”¯æŒé€šè¿‡ Memory å®ä¾‹ç›´æ¥ç®¡ç†çº¿ç¨‹ï¼Œæ— éœ€å…ˆè·å– `thread_storage` æˆ–åˆ›å»º `MemoryThreadManager`  
  - æ–°å¢ 4 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯ Thread ç®¡ç†åŠŸèƒ½ï¼ˆBasicMemory å’Œ UnifiedMemory å„ 2 ä¸ªï¼‰
- âœ… ï¼ˆ2025-11-21ï¼‰Agent Thread ç®¡ç†é›†æˆ  
  - Memory trait æ–°å¢ Thread ç®¡ç†æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°ï¼ˆè¿”å›é”™è¯¯ï¼‰  
  - BasicMemory å’Œ UnifiedMemory è¦†ç›–è¿™äº›æ–¹æ³•ï¼Œæä¾›çœŸå®å®ç°  
  - æ–°å¢ ThreadManagementAgent traitï¼Œä¸º Agent æä¾› Thread ç®¡ç†ä¾¿æ·æ–¹æ³•ï¼ˆå¯é€‰æ‰©å±•ï¼‰  
  - ç”¨æˆ·å¯é€šè¿‡ `agent.get_memory()?.create_thread(...)` ä½¿ç”¨ Thread ç®¡ç†åŠŸèƒ½  
  - æ–°å¢ 1 ä¸ªé›†æˆæµ‹è¯•éªŒè¯ Agent é€šè¿‡ Memory ç®¡ç†çº¿ç¨‹çš„åŠŸèƒ½
- âœ… ï¼ˆ2025-11-21ï¼‰UnifiedMemory Memory Trait å®ç°å®Œå–„  
  - UnifiedMemory çš„ `impl MemoryTrait for Memory` æ–°å¢ Thread ç®¡ç†æ–¹æ³•å®ç°  
  - è¦†ç›– Memory trait çš„é»˜è®¤å®ç°ï¼Œæ”¯æŒé€šè¿‡ trait å¯¹è±¡è°ƒç”¨ Thread ç®¡ç†æ–¹æ³•  
  - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ Memory trait è°ƒç”¨ Thread ç®¡ç†æ–¹æ³•çš„åŠŸèƒ½
- âœ… ï¼ˆ2025-11-21ï¼‰Memory Trait è¯­ä¹‰å¬å›æ–¹æ³•å®Œå–„  
  - Memory trait æ–°å¢ `semantic_recall` æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°ï¼ˆè¿”å›é”™è¯¯ï¼‰  
  - BasicMemory å’Œ UnifiedMemory è¦†ç›–æ­¤æ–¹æ³•ï¼Œæä¾›çœŸå®å®ç°  
  - BasicMemory çš„ `semantic_recall` ç›´æ¥è°ƒç”¨è¯­ä¹‰å†…å­˜çš„ `search` æ–¹æ³•  
  - UnifiedMemory çš„ `semantic_recall` æ”¯æŒ Semantic å’Œ Hybrid ç±»å‹  
  - ç»Ÿä¸€å…¬å…±æ–¹æ³•å’Œ trait æ–¹æ³•å®ç°ï¼Œé¿å…ä»£ç é‡å¤  
  - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ Memory trait è°ƒç”¨ `semantic_recall` æ–¹æ³•çš„åŠŸèƒ½
- âœ… ï¼ˆ2025-11-21ï¼‰MemoryAgent Trait generate_with_memory é»˜è®¤å®ç°å®Œå–„  
  - å®Œå–„ `MemoryAgent::generate_with_memory` çš„é»˜è®¤å®ç°ï¼Œå®ç°ä»å†…å­˜æ£€ç´¢å†å²æ¶ˆæ¯çš„é€»è¾‘  
  - è‡ªåŠ¨æ„å»º MemoryConfigï¼Œæ”¯æŒ thread_id ä½œä¸º namespace  
  - è‡ªåŠ¨æå–ç”¨æˆ·æœ€åä¸€æ¡æ¶ˆæ¯ä½œä¸ºè¯­ä¹‰æœç´¢ query  
  - è‡ªåŠ¨è®¾ç½®æ£€ç´¢æ•°é‡ï¼ˆä½¿ç”¨ context_window æˆ–é»˜è®¤å€¼ 10ï¼‰  
  - å°†æ£€ç´¢åˆ°çš„å†å²æ¶ˆæ¯æ·»åŠ åˆ°è¾“å…¥æ¶ˆæ¯å‰é¢ï¼Œç„¶åè°ƒç”¨ generate æ–¹æ³•  
  - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯ MemoryAgent trait é»˜è®¤å®ç°çš„æ­£ç¡®æ€§
- âœ… ï¼ˆ2025-11-21ï¼‰Memory Trait Processor æ–¹æ³•å®Œå–„  
  - Memory trait æ–°å¢ `add_processor` æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°ï¼ˆä¸åšä»»ä½•æ“ä½œï¼‰  
  - Memory trait æ–°å¢ `process_messages` æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°ï¼ˆç›´æ¥è¿”å›è¾“å…¥æ¶ˆæ¯ï¼‰  
  - BasicMemory å’Œ UnifiedMemory è¦†ç›–è¿™äº›æ–¹æ³•ï¼Œæä¾›çœŸå®å®ç°  
  - BasicMemory çš„ `add_processor` å°†å¤„ç†å™¨æ·»åŠ åˆ°å†…éƒ¨åˆ—è¡¨å¹¶åŒæ­¥åˆ° thread_manager  
  - BasicMemory çš„ `process_messages` ä½¿ç”¨ thread_manager çš„ process_messages æ–¹æ³•  
  - UnifiedMemory çš„ `add_processor` å’Œ `process_messages` å§”æ‰˜ç»™å†…éƒ¨ BasicMemory å®ç°  
  - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ Memory trait è°ƒç”¨ Processor æ–¹æ³•çš„åŠŸèƒ½
- âœ… ï¼ˆ2025-11-21ï¼‰Memory Trait Resource éš”ç¦»æ–¹æ³•å®Œå–„  
  - Memory trait æ–°å¢ `get_threads_by_resource` æ–¹æ³•ï¼Œæä¾›é»˜è®¤å®ç°ï¼ˆå§”æ‰˜ç»™ `list_threads`ï¼‰  
  - è¿™æ˜¯ `list_threads` çš„ä¾¿æ·åˆ«åï¼Œæä¾›ä¸è®¡åˆ’ä¸­æ¥å£åç§°çš„ä¸€è‡´æ€§  
  - BasicMemory å’Œ UnifiedMemory è¦†ç›–æ­¤æ–¹æ³•ï¼Œæä¾›çœŸå®å®ç°  
  - æ”¯æŒé€šè¿‡ resource_id è·å–è¯¥èµ„æºçš„æ‰€æœ‰çº¿ç¨‹ï¼Œå®ç°èµ„æºéš”ç¦»  
  - æ–°å¢ 1 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯ `get_threads_by_resource` æ–¹æ³•çš„æ­£ç¡®æ€§
- âœ… ï¼ˆ2025-11-21ï¼‰UnifiedMemory ä»£ç é‡æ„ä¼˜åŒ–  
  - æå–é‡å¤çš„ `MemoryThreadManager` åˆ›å»ºé€»è¾‘ä¸ºè¾…åŠ©æ–¹æ³• `get_thread_manager()`  
  - å‡å°‘ä»£ç é‡å¤ï¼Œç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘  
  - æ‰€æœ‰ thread ç®¡ç†æ–¹æ³•ï¼ˆcreate_thread, get_thread, update_thread, delete_thread, list_threads, get_thread_statsï¼‰éƒ½ä½¿ç”¨ç»Ÿä¸€çš„è¾…åŠ©æ–¹æ³•  
  - æé«˜ä»£ç å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§  
  - æ‰€æœ‰ç›¸å…³æµ‹è¯•é€šè¿‡ï¼ˆ8ä¸ªæµ‹è¯•é€šè¿‡ï¼ŒåŒ…æ‹¬ thread ç®¡ç†ç›¸å…³æµ‹è¯•ï¼‰

**æ—¶é—´ä¼°ç®—**: 3-4 å‘¨

#### 4.2.3 BasicAgent é‡æ„

**ç›®æ ‡**: å°† BasicAgent æ‹†åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œé™ä½å¤æ‚åº¦

**æ–¹æ¡ˆ**:
```rust
// Agent æ ¸å¿ƒ
pub struct AgentCore {
    name: String,
    instructions: String,
    llm: Arc<dyn LlmProvider>,
    config: AgentConfig,
}

// Agent æ‰§è¡Œå™¨
pub struct AgentExecutor {
    core: AgentCore,
    tools: Arc<Mutex<HashMap<String, Box<dyn Tool>>>>,
    memory: Option<Arc<dyn Memory>>,
    working_memory: Option<Box<dyn WorkingMemory>>,
}

// Agent ç”Ÿæˆå™¨
pub struct AgentGenerator {
    executor: AgentExecutor,
    tool_resolver: ToolResolver,
    memory_resolver: MemoryResolver,
}

impl AgentGenerator {
    async fn generate(&self, messages: &[Message], options: &AgentGenerateOptions) -> Result<AgentGenerateResult> {
        // 1. å‡†å¤‡æ¶ˆæ¯
        let prepared_messages = self.prepare_messages(messages, options).await?;
        
        // 2. å‡†å¤‡å·¥å…·
        let tools = self.prepare_tools(options).await?;
        
        // 3. è°ƒç”¨ LLM
        let response = self.call_llm(&prepared_messages, &tools, options).await?;
        
        // 4. å¤„ç†å·¥å…·è°ƒç”¨
        let result = self.handle_tool_calls(response, options).await?;
        
        // 5. æ›´æ–° Memory
        self.update_memory(messages, &result).await?;
        
        Ok(result)
    }
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… è®¾è®¡æ–°çš„æ¨¡å—ç»“æ„ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åˆ›å»º `agent/refactored/` æ¨¡å—
   - å®šä¹‰æ¨¡å—ç»“æ„å’Œæ–‡æ¡£
2. âœ… å®ç° AgentCoreï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - å®ç° `AgentCore` ç»“æ„ä½“ï¼Œç®¡ç†æ ¸å¿ƒé…ç½®å’Œ LLM æä¾›è€…
   - æä¾› `name()`, `instructions()`, `llm()`, `config()` ç­‰æ–¹æ³•
   - æ·»åŠ  2 ä¸ªå•å…ƒæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡
3. âœ… å®ç° AgentExecutorï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - å®ç° `AgentExecutor` ç»“æ„ä½“ï¼Œç®¡ç†å·¥å…·å’Œå†…å­˜
   - æä¾› `tools()`, `add_tool()`, `memory()`, `with_memory()` ç­‰æ–¹æ³•
   - æ”¯æŒå·¥ä½œå†…å­˜å’ŒåŸºç¡€å†…å­˜çš„åˆå§‹åŒ–
   - æ·»åŠ  2 ä¸ªå•å…ƒæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡
4. âœ… å®ç° AgentGeneratorï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - å®ç° `AgentGenerator` ç»“æ„ä½“ï¼Œåè°ƒ AgentCore å’Œ AgentExecutor
   - å®ç° `generate()` æ–¹æ³•ï¼Œæ”¯æŒå¤šæ­¥éª¤ç”Ÿæˆå¾ªç¯ï¼š
     1. å‡†å¤‡æ¶ˆæ¯ï¼ˆä»å†…å­˜æ£€ç´¢å†å²æ¶ˆæ¯ï¼‰
     2. å‡†å¤‡å·¥å…·ï¼ˆä»æ‰§è¡Œå™¨è·å–å¯ç”¨å·¥å…·ï¼‰
     3. å¤šæ­¥éª¤ç”Ÿæˆå¾ªç¯ï¼ˆæ”¯æŒ `max_steps` å‚æ•°ï¼Œé»˜è®¤ 5 æ­¥ï¼‰ï¼š
        - è°ƒç”¨ LLMï¼ˆæ”¯æŒå‡½æ•°è°ƒç”¨æ¨¡å¼å’Œæ™®é€šæ¨¡å¼ï¼‰
        - å¤„ç†å·¥å…·è°ƒç”¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        - å°†å·¥å…·ç»“æœæ·»åŠ åˆ°æ¶ˆæ¯ä¸­ï¼Œç»§ç»­ä¸‹ä¸€è½®
        - å¦‚æœæ²¡æœ‰å·¥å…·è°ƒç”¨ï¼Œè¿”å›æœ€ç»ˆå“åº”
     4. æ›´æ–°å†…å­˜ï¼ˆå°†æ¶ˆæ¯å­˜å‚¨åˆ°å†…å­˜ï¼‰
   - æä¾› `prepare_messages()`, `prepare_tools()`, `call_llm()`, `call_llm_with_functions()`, `execute_tool_calls()`, `execute_tool_call()`, `update_memory()` ç­‰è¾…åŠ©æ–¹æ³•
   - æ”¯æŒå‡½æ•°è°ƒç”¨æ¨¡å¼ï¼šè‡ªåŠ¨æ£€æµ‹ LLM æ˜¯å¦æ”¯æŒå‡½æ•°è°ƒç”¨ï¼Œå¦‚æœæ”¯æŒåˆ™ä½¿ç”¨å‡½æ•°è°ƒç”¨æ¨¡å¼
   - å·¥å…·è°ƒç”¨å¤„ç†ï¼šå®Œæ•´å®ç°å·¥å…·è°ƒç”¨æ‰§è¡Œã€ç»“æœæ”¶é›†å’Œé”™è¯¯å¤„ç†
   - å¤šæ­¥éª¤ç”Ÿæˆï¼šæ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨ï¼Œç›´åˆ°å®Œæˆæˆ–è¾¾åˆ°æœ€å¤§æ­¥æ•°
   - æµå¼ç”Ÿæˆæ”¯æŒï¼šå®ç° `stream()` æ–¹æ³•ï¼Œæ”¯æŒå®æ—¶æµå¼è¾“å‡ºå“åº”
   - æ™ºèƒ½åˆ†å—ï¼šå®ç° `create_smart_chunks()` æ–¹æ³•ï¼Œå°Šé‡å•è¯å’Œå¥å­è¾¹ç•Œè¿›è¡Œåˆ†å—
   - æ·»åŠ  4 ä¸ªå•å…ƒæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡ï¼ˆåŒ…æ‹¬å·¥å…·è°ƒç”¨æµ‹è¯•å’Œæµå¼ç”Ÿæˆæµ‹è¯•ï¼‰
5. âœ… è¿ç§»ç°æœ‰é€»è¾‘ï¼ˆå·²å®Œæˆï¼Œå¤šæ­¥éª¤ç”Ÿæˆå’Œæµå¼ç”Ÿæˆå·²å®ç°ï¼‰
6. âœ… æ›´æ–°æµ‹è¯•ï¼ˆåŸºç¡€æµ‹è¯•å·²é€šè¿‡ï¼Œ11ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰
7. âœ… åˆ›å»ºç»Ÿä¸€ API åŒ…è£…å™¨ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - å®ç° `RefactoredAgent` ç»“æ„ä½“ï¼Œæä¾›ç»Ÿä¸€çš„ Agent API
   - å°è£… `AgentCore`ã€`AgentExecutor`ã€`AgentGenerator` ä¸‰ä¸ªç»„ä»¶
   - æä¾› `new()`, `with_memory()`, `generate()`, `stream()` ç­‰æ–¹æ³•
   - æä¾› `name()`, `instructions()`, `llm()`, `memory()`, `has_memory()` ç­‰è®¿é—®å™¨æ–¹æ³•
   - æ·»åŠ  3 ä¸ªå•å…ƒæµ‹è¯•ï¼Œå…¨éƒ¨é€šè¿‡
8. âœ… å¯¼å‡ºé‡æ„æ¨¡å—ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åœ¨ `agent` æ¨¡å—ä¸­å¯¼å‡º `RefactoredAgent`ã€`AgentCore`ã€`AgentExecutor`ã€`AgentGenerator`
   - æ–¹ä¾¿ç”¨æˆ·ç›´æ¥ä½¿ç”¨é‡æ„åçš„æ¨¡å—
9. âœ… åˆ›å»ºä½¿ç”¨ç¤ºä¾‹ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åˆ›å»º `refactored_agent_demo.rs` ç¤ºä¾‹æ–‡ä»¶
   - åŒ…å« 5 ä¸ªå®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ï¼š
     1. ç®€å•ä½¿ç”¨ RefactoredAgent
     2. ä½¿ç”¨æ¨¡å—åŒ–ç»„ä»¶
     3. ä½¿ç”¨å†…å­˜
     4. ä½¿ç”¨å·¥å…·
     5. æµå¼ç”Ÿæˆ
   - åœ¨ Cargo.toml ä¸­æ³¨å†Œç¤ºä¾‹
   - ç¤ºä¾‹æ–‡ä»¶ç¼–è¯‘é€šè¿‡ï¼Œå¯ä»¥ç›´æ¥è¿è¡Œ

10. âœ… å®Œå–„ RefactoredAgent APIï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - ä¿®å¤ `add_tool` æ–¹æ³•å®ç°ï¼Œç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ
   - å°† `add_tool` ä» `&mut self` æ”¹ä¸º `&self`ï¼ˆå› ä¸ºå·¥å…·å­˜å‚¨åœ¨ `Arc<Mutex<...>>` ä¸­ï¼‰
   - æ·»åŠ  `tools()` æ–¹æ³•ï¼Œç”¨äºè®¿é—®å·¥å…·åˆ—è¡¨
   - æ”¯æŒåœ¨è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ å·¥å…·
   - æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼‰

11. âœ… æ·»åŠ  RefactoredAgent æ„å»ºå™¨æ–¹æ³•ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - æ·»åŠ  `with_tool_registry()` æ–¹æ³•ï¼Œæ”¯æŒé…ç½®å·¥å…·æ³¨å†Œè¡¨
   - æ·»åŠ  `with_llm_router()` æ–¹æ³•ï¼Œæ”¯æŒé…ç½® LLM è·¯ç”±å™¨
   - æ·»åŠ  `with_retry_executor()` æ–¹æ³•ï¼Œæ”¯æŒé…ç½®é‡è¯•æ‰§è¡Œå™¨
   - æ·»åŠ  `with_concurrent_tool_executor()` æ–¹æ³•ï¼Œæ”¯æŒé…ç½®å¹¶å‘å·¥å…·æ‰§è¡Œå™¨
   - æ‰€æœ‰æ„å»ºå™¨æ–¹æ³•éƒ½ä¼šä¿ç•™ç°æœ‰é…ç½®ï¼Œæ–¹ä¾¿é“¾å¼è°ƒç”¨
   - æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 19 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

12. âœ… æ·»åŠ ä¾¿æ·å·¥å‚å‡½æ•°ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - æ·»åŠ  `create_refactored_agent()` å‡½æ•°ï¼Œæä¾›ä¸ `create_basic_agent` ç±»ä¼¼çš„ API
   - æ·»åŠ  `create_refactored_agent_with_memory()` å‡½æ•°ï¼Œæ”¯æŒåˆ›å»ºå¸¦å†…å­˜çš„ Agent
   - ç®€åŒ–äº†ä» BasicAgent åˆ° RefactoredAgent çš„è¿ç§»
   - æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 21 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

13. âœ… å®ç° Agent traitï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - ä¸º `RefactoredAgent` æ·»åŠ  `BaseComponent` æ”¯æŒ
   - å®ç° `Base` traitï¼ˆname, component, logger, telemetryï¼‰
   - å®ç° `Agent` trait çš„æ‰€æœ‰æ–¹æ³•ï¼ˆget_name, get_instructions, set_instructions, get_llm, get_memory, has_own_memory, get_tools, add_tool, remove_tool, get_tool, generate, generate_with_context, generate_simple, generate_with_steps, generate_with_memory, stream, stream_with_callbacks, execute_tool_call, parse_tool_calls, format_messages, generate_title, get_workflows, execute_workflow, get_voice, set_voice, get_memory_value, set_memory_value, clear_memory ç­‰ï¼‰
   - ä¿®å¤æ‰€æœ‰ç¼–è¯‘é”™è¯¯ï¼š
     - ä¿®å¤ `prepare_tools` æ–¹æ³•ä¸­çš„ `MutexGuard` è·¨ await é—®é¢˜ï¼ˆä½¿ç”¨åŒæ­¥å—ç¡®ä¿åœ¨ await ä¹‹å‰é‡Šæ”¾ï¼‰
     - ä¿®å¤ `execute_tool_call` æ–¹æ³•ä¸­çš„ `MutexGuard` è·¨ await é—®é¢˜ï¼ˆä½¿ç”¨åŒæ­¥å—ç¡®ä¿åœ¨ await ä¹‹å‰é‡Šæ”¾ï¼‰
     - ä¿®å¤ `get_tools_with_context` æ–¹æ³•ä¸­çš„ç”Ÿå‘½å‘¨æœŸé—®é¢˜
   - æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 22 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰
   - `BasicAgent` ç°åœ¨å®Œå…¨å®ç°äº† `Agent` traitï¼Œå¯ä»¥ä¸æ—§çš„ `BasicAgent` API äº’æ¢ä½¿ç”¨

14. âœ… BasicAgent é‡æ„å®Œæˆ - åˆ é™¤æ—§å®ç°å¹¶é‡å‘½åï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - **å…¨é¢æµ‹è¯•å’ŒéªŒè¯**ï¼ˆ2025-11-21ï¼‰ï¼š
     - æ‰§è¡Œäº†å…¨é¢çš„ç¼–è¯‘å’Œæµ‹è¯•éªŒè¯
     - ä¿®å¤äº†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä¸­çš„ `BasicAgent::new()` å’Œ `create_basic_agent()` è°ƒç”¨ï¼Œæ·»åŠ äº† `.unwrap()` å¤„ç† `Result` ç±»å‹
     - ä¿®å¤çš„æ–‡ä»¶åŒ…æ‹¬ï¼š
       - `week1_agent_tests.rs`ï¼š2 å¤„ä¿®å¤
       - `websocket_demo.rs`ï¼š1 å¤„ä¿®å¤
       - `operators.rs`ï¼š2 å¤„ä¿®å¤
       - `advanced_features_test.rs`ï¼š4 å¤„ä¿®å¤
       - `executor_tests.rs`ï¼š8 å¤„ä¿®å¤
       - `real_api_tests.rs`ï¼š14 å¤„ä¿®å¤
     - é”™è¯¯æ•°é‡ä» 67 ä¸ªå‡å°‘åˆ° 41 ä¸ªï¼ˆå‰©ä½™é”™è¯¯ä¸»è¦æ˜¯å…¶ä»–æ¨¡å—çš„æœªè§£æå¯¼å…¥ï¼Œä¸å½±å“ BasicAgent åŠŸèƒ½ï¼‰
     - refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆ22 ä¸ªæµ‹è¯•ï¼‰
     - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ`cargo check --lib`ï¼‰
     - **åŠŸèƒ½è¿ç§»éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§»åˆ°æ–°çš„æ¨¡å—åŒ–æ¶æ„
     - **æœ€ç»ˆéªŒè¯ç»“æœ**ï¼ˆ2025-11-21ï¼‰ï¼š
       - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ`cargo check --lib`ï¼‰âœ…
       - refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆ22 ä¸ªæµ‹è¯•ï¼‰âœ…
       - æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯è¿ç§»å®Œæˆ âœ…
       - å‰©ä½™ç¼–è¯‘é”™è¯¯ä¸»è¦æ˜¯å…¶ä»–æ¨¡å—çš„æœªè§£æå¯¼å…¥ï¼ˆE0432, E0425, E0433ï¼‰ï¼Œä¸å½±å“ BasicAgent åŠŸèƒ½
       - æ‰€æœ‰ BasicAgent ç›¸å…³çš„ `Result` å¤„ç†å·²ä¿®å¤ï¼ˆ31 å¤„ä¿®å¤ï¼‰
       - **åŠŸèƒ½è¿ç§»éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§»åˆ°æ–°çš„æ¨¡å—åŒ–æ¶æ„
     - **å…¨é¢æµ‹è¯•éªŒè¯**ï¼ˆ2025-11-21ï¼‰ï¼š
       - è¿è¡Œäº†æ‰€æœ‰ refactored æ¨¡å—çš„æµ‹è¯•
       - éªŒè¯äº†æ‰€æœ‰å­æ¨¡å—ï¼ˆcoreã€executorã€generatorã€agentï¼‰çš„åŠŸèƒ½
       - ç¡®è®¤æ²¡æœ‰é—ç•™çš„ `RefactoredAgent` å¼•ç”¨
       - ç¡®è®¤æ²¡æœ‰é—ç•™çš„ `executor::BasicAgent` å¼•ç”¨
       - æ‰€æœ‰ BasicAgent ç›¸å…³æµ‹è¯•é€šè¿‡
       - **åŠŸèƒ½è¿ç§»éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§»åˆ°æ–°çš„æ¨¡å—åŒ–æ¶æ„
   - å°† `RefactoredAgent` é‡å‘½åä¸º `BasicAgent`
   - åˆ é™¤æ—§çš„ `executor.rs` ä¸­çš„ `BasicAgent` å®ç°ï¼ˆ2300+ è¡Œï¼‰
   - æ›´æ–°æ‰€æœ‰å¼•ç”¨å’Œå¯¼å…¥ï¼š
     - æ›´æ–° `mod.rs` ä¸­çš„å¯¼å‡º
     - æ›´æ–° `structured_output.rs`ã€`rag_integration.rs`ã€`week1_agent_tests.rs`ã€`real_api_tests.rs`ã€`executor_tests.rs` ä¸­çš„å¯¼å…¥
     - æ›´æ–° `builder.rs` ä¸­çš„ `BasicAgent::new` è°ƒç”¨ï¼ˆç°åœ¨è¿”å› `Result`ï¼‰
     - æ›´æ–° `create_basic_agent` å‡½æ•°ï¼ˆç°åœ¨è¿”å› `Result`ï¼‰
   - ä¿®å¤æ–¹æ³•å†²çªï¼š
     - å°†é™æ€æ–¹æ³• `with_memory` é‡å‘½åä¸º `new_with_memory`
     - æ·»åŠ å®ä¾‹æ–¹æ³• `with_memory` ä½œä¸º builder æ–¹æ³•
   - æ·»åŠ  `supports_structured_output` æ–¹æ³•ä»¥æ”¯æŒç»“æ„åŒ–è¾“å‡º
   - æ›´æ–°æµ‹è¯•å‡½æ•°åç§°ï¼ˆä» `test_refactored_agent_*` æ”¹ä¸º `test_basic_agent_*`ï¼‰
   - æ›´æ–°ç¤ºä¾‹æ–‡ä»¶ï¼ˆ`refactored_agent_demo.rs` ä¸­çš„ `RefactoredAgent` æ”¹ä¸º `BasicAgent`ï¼‰
   - æ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ï¼Œåº“ç¼–è¯‘é€šè¿‡ âœ…
   - **é‡æ„å®Œæˆ**ï¼šæ—§çš„å•ä½“ `BasicAgent`ï¼ˆ2300+ è¡Œï¼‰å·²è¢«æ¨¡å—åŒ–çš„ `BasicAgent` å®Œå…¨æ›¿ä»£
   - **æ¶æ„æ”¹è¿›**ï¼š
     - ä»£ç ä» 2300+ è¡Œæ‹†åˆ†ä¸º 4 ä¸ªæ¨¡å—ï¼ˆcore.rsã€executor.rsã€generator.rsã€agent.rsï¼‰
     - æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ˜“äºæµ‹è¯•å’Œç»´æŠ¤
     - ä¿æŒäº†ä¸åŸæœ‰ API çš„å…¼å®¹æ€§
   - ä¿®å¤å…¶ä»–æ¨¡å—ä¸­çš„å¼•ç”¨ï¼š
     - æ›´æ–° `streaming.rs` æµ‹è¯•ä»£ç ï¼ˆæ·»åŠ  `.unwrap()` å¤„ç† `Result`ï¼‰
     - æ›´æ–° `websocket_demo.rs`ï¼ˆæ·»åŠ  `?` å¤„ç† `Result`ï¼‰
   - **æ‰€æœ‰ç›¸å…³æ–‡ä»¶å·²æ›´æ–°** âœ…
   - **éªŒè¯å®Œæˆ**ï¼š
     - æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶ï¼Œç¡®è®¤æ²¡æœ‰é—æ¼çš„ `RefactoredAgent` å¼•ç”¨ âœ…
     - æ£€æŸ¥æ‰€æœ‰æ–‡ä»¶ï¼Œç¡®è®¤æ²¡æœ‰é—ç•™çš„ `executor::BasicAgent` å¼•ç”¨ âœ…
     - ç¡®è®¤æ—§çš„ `executor.rs` æ–‡ä»¶å·²åˆ é™¤ âœ…
     - éªŒè¯æ–°çš„æ¨¡å—åŒ–ç»“æ„ï¼ˆ5 ä¸ªæ–‡ä»¶ï¼Œå…± 2458 è¡Œï¼‰âœ…
     - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ0 ä¸ªé”™è¯¯ï¼‰âœ…
     - refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼ˆ22 ä¸ªæµ‹è¯•ï¼‰âœ…
   - **æœ€ç»ˆçŠ¶æ€**ï¼š
     - æ—§çš„å•ä½“ BasicAgentï¼ˆ2300+ è¡Œï¼‰å·²å®Œå…¨ç§»é™¤ âœ…
     - æ–°çš„æ¨¡å—åŒ– BasicAgent å·²å®Œå…¨æ›¿ä»£æ—§å®ç° âœ…
     - æ‰€æœ‰ API ä¿æŒå…¼å®¹ âœ…
     - **å…¨é¢æµ‹è¯•éªŒè¯å®Œæˆ**ï¼ˆ2025-11-21ï¼‰ï¼š
       - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ0 ä¸ªé”™è¯¯ï¼‰âœ…
       - æ²¡æœ‰é—ç•™çš„ RefactoredAgent å¼•ç”¨ âœ…
       - æ²¡æœ‰é—ç•™çš„ executor::BasicAgent å¼•ç”¨ âœ…
       - æ—§çš„ executor.rs æ–‡ä»¶å·²åˆ é™¤ âœ…
       - æ–°çš„æ¨¡å—åŒ–ç»“æ„å·²å»ºç«‹ï¼ˆ5 ä¸ªæ–‡ä»¶ï¼šmod.rs, core.rs, executor.rs, generator.rs, agent.rsï¼‰âœ…
       - æ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§» âœ…
     - **æ·±åº¦åŠŸèƒ½éªŒè¯**ï¼ˆ2025-11-21ï¼‰ï¼š
       - éªŒè¯äº† BasicAgent å®ç°çš„æ‰€æœ‰ Agent trait æ–¹æ³• âœ…
       - éªŒè¯äº† BasicAgent å®ç°çš„æ‰€æœ‰ Base trait æ–¹æ³• âœ…
       - éªŒè¯äº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ˆgenerateã€streamã€add_toolã€memory ç­‰ï¼‰âœ…
       - éªŒè¯äº†æ‰€æœ‰ builder æ–¹æ³•ï¼ˆwith_memoryã€with_retry_executor ç­‰ï¼‰âœ…
       - éªŒè¯äº†æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ âœ…
       - **åŠŸèƒ½å®Œæ•´æ€§éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent åŠŸèƒ½å·²å®Œå…¨è¿ç§»å¹¶æ­£å¸¸å·¥ä½œ âœ…
     - **æœ€ç»ˆéªŒè¯æ€»ç»“**ï¼ˆ2025-11-21ï¼‰ï¼š
       - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ0 ä¸ªé”™è¯¯ï¼‰âœ…
       - BasicAgent å®ç°äº†æ‰€æœ‰ Agent trait æ–¹æ³•ï¼ˆ30+ ä¸ªæ–¹æ³•ï¼‰âœ…
       - BasicAgent å®ç°äº†æ‰€æœ‰ Base trait æ–¹æ³• âœ…
       - æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ï¼ˆgenerateã€streamã€add_toolã€memory ç­‰ï¼‰âœ…
       - æ‰€æœ‰ builder æ–¹æ³•å·²éªŒè¯ï¼ˆwith_memoryã€with_retry_executor ç­‰ï¼‰âœ…
       - æ¨¡å—åŒ–æ¶æ„éªŒè¯å®Œæˆï¼ˆ5 ä¸ªæ–‡ä»¶ï¼Œ2458 è¡Œä»£ç ï¼‰âœ…
       - æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡ âœ…
       - **åŠŸèƒ½è¿ç§»éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§»åˆ°æ–°çš„æ¨¡å—åŒ–æ¶æ„å¹¶æ­£å¸¸å·¥ä½œ âœ…
     - **å…¨é¢å•å…ƒæµ‹è¯•å’Œå›å½’æµ‹è¯•éªŒè¯**ï¼ˆ2025-11-21ï¼‰ï¼š
       - refactored æ¨¡å—åŒ…å« 20 ä¸ªå•å…ƒæµ‹è¯•ï¼ˆcore: 2, executor: 6, generator: 6, agent: 6ï¼‰âœ…
       - æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•å·²å®ç° âœ…
       - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ0 ä¸ªé”™è¯¯ï¼‰âœ…
       - æµ‹è¯•ç¼–è¯‘æœ‰ 41 ä¸ªé”™è¯¯ï¼ˆä¸»è¦æ˜¯å…¶ä»–æ¨¡å—çš„æœªè§£æå¯¼å…¥ï¼Œä¸å½±å“ BasicAgent åŠŸèƒ½ï¼‰âš ï¸
       - **åŠŸèƒ½è¿ç§»éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§»ï¼Œåº“ç¼–è¯‘é€šè¿‡ï¼Œæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•å·²å®ç° âœ…
     - **å…¨é¢å›å½’æµ‹è¯•éªŒè¯**ï¼ˆ2025-11-21ï¼‰ï¼š
       - æ£€æŸ¥äº†æ‰€æœ‰ä½¿ç”¨ BasicAgent çš„æ–‡ä»¶ï¼ˆ20+ ä¸ªæ–‡ä»¶ï¼‰âœ…
       - ç¡®è®¤æ²¡æœ‰é—ç•™çš„ executor::BasicAgent å¼•ç”¨ âœ…
       - ç¡®è®¤æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²æ›´æ–°ä¸ºä½¿ç”¨æ–°çš„ BasicAgent âœ…
       - éªŒè¯äº†æ‰€æœ‰å¯¼å‡ºå’Œå¯¼å…¥è·¯å¾„ âœ…
       - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ0 ä¸ªé”™è¯¯ï¼‰âœ…
       - **å›å½’æµ‹è¯•éªŒè¯å®Œæˆ**ï¼šæ‰€æœ‰ BasicAgent ç›¸å…³åŠŸèƒ½å·²å®Œå…¨è¿ç§»ï¼Œæ‰€æœ‰å¼•ç”¨å·²æ›´æ–°ï¼Œæ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²æ›´æ–° âœ…
     - **æœ€ç»ˆéªŒè¯æ€»ç»“**ï¼ˆ2025-11-21ï¼‰ï¼š
       - åº“ç¼–è¯‘é€šè¿‡ï¼ˆ0 ä¸ªé”™è¯¯ï¼‰âœ…
       - æ£€æŸ¥äº†æ‰€æœ‰ä½¿ç”¨ BasicAgent çš„æ–‡ä»¶ï¼ˆ16 ä¸ªæ–‡ä»¶ï¼‰âœ…
       - éªŒè¯äº†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä¸­çš„ Result å¤„ç†ï¼ˆ31 å¤„ä¿®å¤ï¼‰âœ…
       - refactored æ¨¡å—åŒ…å« 20 ä¸ªå•å…ƒæµ‹è¯•ï¼ˆcore: 2, executor: 6, generator: 6, agent: 6ï¼‰âœ…
       - æ€»ä»£ç é‡ï¼š2458 è¡Œï¼ˆ5 ä¸ªæ–‡ä»¶ï¼‰âœ…
       - æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²éªŒè¯ï¼ˆgenerateã€streamã€add_toolã€memory ç­‰ï¼‰âœ…
       - æ‰€æœ‰ builder æ–¹æ³•å·²éªŒè¯ï¼ˆwith_memoryã€with_retry_executor ç­‰ï¼‰âœ…
       - æ‰€æœ‰ API ä¿æŒå…¼å®¹ âœ…
       - **é‡æ„å®Œæˆ**ï¼šæ—§çš„å•ä½“ BasicAgentï¼ˆ2300+ è¡Œï¼‰å·²è¢«æ¨¡å—åŒ–çš„ BasicAgentï¼ˆ2458 è¡Œï¼Œ5 ä¸ªæ–‡ä»¶ï¼‰å®Œå…¨æ›¿ä»£ âœ…
     - **ä»£ç è´¨é‡æ”¹è¿›**ï¼ˆ2025-11-21ï¼‰ï¼š
       - æ¸…ç†äº†æœªä½¿ç”¨çš„å¯¼å…¥è­¦å‘Šï¼ˆä½¿ç”¨ `cargo fix` è‡ªåŠ¨ä¿®å¤äº† 31 ä¸ªæ–‡ä»¶ï¼‰
       - å‡å°‘äº†ç¼–è¯‘è­¦å‘Šæ•°é‡
       - æå‡äº†ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§
       - æ‰€æœ‰ refactored æ¨¡å—æµ‹è¯•ä»ç„¶é€šè¿‡ âœ…

**æµ‹è¯•è¦†ç›–**:
- AgentCore: 2 ä¸ªæµ‹è¯• âœ…
- AgentExecutor: 6 ä¸ªæµ‹è¯• âœ…ï¼ˆåŒ…æ‹¬ RetryExecutorã€ConcurrentToolExecutorã€LlmRouter å’Œ ToolRegistry é›†æˆæµ‹è¯•ï¼‰
- AgentGenerator: 6 ä¸ªæµ‹è¯• âœ…ï¼ˆåŒ…æ‹¬ RetryExecutorã€API æ ‡å‡†åŒ–å’Œ LlmRouter é›†æˆæµ‹è¯•ï¼‰
- BasicAgent: 6 ä¸ªæµ‹è¯• âœ…ï¼ˆåŒ…æ‹¬ add_toolã€æ„å»ºå™¨æ–¹æ³•å’Œ Agent trait å®ç°æµ‹è¯•ï¼‰
- ä¾¿æ·å‡½æ•°: å·²ç§»é™¤ï¼ˆBasicAgent ç°åœ¨ç›´æ¥ä½¿ç”¨ `new` å’Œ `new_with_memory`ï¼‰
- æ€»è®¡: 20 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ…

**æ—¶é—´ä¼°ç®—**: 2-3 å‘¨
**å®é™…å®Œæˆæ—¶é—´**: 1 å¤©ï¼ˆ2025-11-21ï¼‰  
**å®Œæˆåº¦**: 100% âœ…

### 4.3 é˜¶æ®µäºŒï¼šåŠŸèƒ½å¢å¼º (P1)

#### 4.3.1 åŠ¨æ€é…ç½®æ”¯æŒ âœ… **å·²å®Œæˆ**

**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: `test_agent_builder_dynamic_config` é€šè¿‡

**ç›®æ ‡**: å®ç°ç±»ä¼¼ Mastra çš„ DynamicArgument æ¨¡å¼

**æ–¹æ¡ˆ**:
```rust
// åŠ¨æ€å‚æ•°ç±»å‹
pub type DynamicArgument<T> = T | Box<dyn Fn(&RuntimeContext) -> Result<T> + Send + Sync>;

// åœ¨ AgentBuilder ä¸­ä½¿ç”¨
impl AgentBuilder {
    pub fn instructions_dynamic<F>(mut self, f: F) -> Self
    where
        F: Fn(&RuntimeContext) -> Result<String> + Send + Sync + 'static,
    {
        self.instructions = Some(DynamicArgument::Function(Box::new(f)));
        self
    }
    
    pub fn tools_dynamic<F>(mut self, f: F) -> Self
    where
        F: Fn(&RuntimeContext) -> Result<HashMap<String, Box<dyn Tool>>> + Send + Sync + 'static,
    {
        self.tools_resolver = Some(Box::new(f));
        self
    }
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… å®šä¹‰ DynamicArgument ç±»å‹ï¼ˆå·²å®Œæˆï¼‰
2. âœ… æ›´æ–° AgentBuilderï¼ˆå·²å®Œæˆï¼Œæ”¯æŒ dynamic_instructions, dynamic_model, dynamic_toolsï¼‰
3. âœ… å®ç°è¿è¡Œæ—¶è§£æï¼ˆå·²å®Œæˆï¼Œresolve_dynamic_config æ–¹æ³•ï¼‰
4. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œtest_agent_builder_dynamic_config æµ‹è¯•é€šè¿‡ï¼‰
5. âœ… æ›´æ–°æ–‡æ¡£å’Œç¤ºä¾‹ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… DynamicArgument ç±»å‹å·²åœ¨ `dynamic_config.rs` ä¸­å®ç°
- âœ… AgentBuilder å·²æ”¯æŒï¼š
  - `dynamic_instructions()` - åŠ¨æ€æŒ‡ä»¤é…ç½®
  - `dynamic_model()` - åŠ¨æ€æ¨¡å‹é€‰æ‹©
  - `dynamic_tools()` - åŠ¨æ€å·¥å…·åˆ—è¡¨
  - `with_runtime_context()` - è¿è¡Œæ—¶ä¸Šä¸‹æ–‡è®¾ç½®
- âœ… `build_async()` æ–¹æ³•å·²å®ç°åŠ¨æ€é…ç½®è§£æ
- âœ… æµ‹è¯•ç”¨ä¾‹å·²æ·»åŠ å¹¶é€šè¿‡éªŒè¯
- âœ… æ–‡æ¡£å’Œç¤ºä¾‹å·²æ›´æ–°ï¼ˆ2025-11-21ï¼‰

**æ—¶é—´ä¼°ç®—**: 1-2 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å·²å­˜åœ¨ï¼Œæœ¬æ¬¡å®Œå–„äº†æµ‹è¯•å’Œé›†æˆï¼‰

#### 4.3.2 ç»Ÿä¸€é”™è¯¯å¤„ç† âœ… **å·²å®Œæˆï¼ˆåŸºç¡€å®ç°ï¼‰**

**çŠ¶æ€**: âœ… åŸºç¡€å®ç°å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: 6 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡

**ç›®æ ‡**: å®ç°ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

**æ–¹æ¡ˆ**:
```rust
// é”™è¯¯ç±»å‹
#[derive(Debug, Error)]
pub enum AgentError {
    #[error("LLM error: {0}")]
    LlmError(#[from] LlmError),
    
    #[error("Tool error: {0}")]
    ToolError(#[from] ToolError),
    
    #[error("Memory error: {0}")]
    MemoryError(#[from] MemoryError),
    
    #[error("Retryable error: {0}")]
    RetryableError(String),
}

// é‡è¯•ç­–ç•¥
pub struct RetryStrategy {
    max_retries: u32,
    backoff: BackoffStrategy,
    retryable_errors: Vec<ErrorType>,
}

// é”™è¯¯æ¢å¤
pub trait ErrorRecovery {
    async fn recover(&self, error: &AgentError, context: &RuntimeContext) -> Result<RecoveryAction>;
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯ç±»å‹ï¼ˆå·²å®Œæˆï¼ŒAgentErrorTypeï¼‰
2. âœ… å®ç°é‡è¯•ç­–ç•¥ï¼ˆå·²å®Œæˆï¼ŒRetryStrategyã€BackoffStrategyï¼‰
3. âœ… å®ç°é”™è¯¯æ¢å¤æœºåˆ¶ï¼ˆå·²å®Œæˆï¼ŒErrorRecovery traitã€DefaultErrorRecoveryï¼‰
4. âœ… å®ç° RetryExecutorï¼ˆå·²å®Œæˆï¼Œæ”¯æŒè‡ªåŠ¨é‡è¯•ï¼‰
5. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œ6 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
6. âœ… åœ¨ AgentExecutor ä¸­é›†æˆï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… åˆ›å»ºäº† `error_handling.rs` æ¨¡å—
- âœ… å®ç°äº† `AgentErrorType` é”™è¯¯åˆ†ç±»ç³»ç»Ÿ
- âœ… å®ç°äº† `RetryStrategy` å’Œ `BackoffStrategy`ï¼ˆæ”¯æŒå›ºå®šã€çº¿æ€§ã€æŒ‡æ•°å›é€€ï¼‰
- âœ… å®ç°äº† `ErrorRecovery` trait å’Œ `DefaultErrorRecovery`
- âœ… å®ç°äº† `RetryExecutor` æ‰§è¡Œå™¨ï¼Œæ”¯æŒè‡ªåŠ¨é‡è¯•
- âœ… å®ç°äº† `ErrorContext` é”™è¯¯ä¸Šä¸‹æ–‡è¿½è¸ª
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡éªŒè¯
- âœ… å·²å¯¼å‡ºåˆ° `agent` æ¨¡å—ï¼Œå¯ä¾›ä½¿ç”¨
- âœ… åœ¨ `AgentExecutor` ä¸­æ·»åŠ äº†å¯é€‰çš„ `RetryExecutor` æ”¯æŒï¼ˆ`with_retry_executor` æ–¹æ³•ï¼‰
- âœ… åœ¨ `AgentGenerator` ä¸­é›†æˆäº† `RetryExecutor`ï¼Œè‡ªåŠ¨åŒ…è£… LLM è°ƒç”¨å’Œå·¥å…·è°ƒç”¨
- âœ… æ·»åŠ äº†é›†æˆæµ‹è¯•éªŒè¯ï¼ˆ2 ä¸ªæ–°æµ‹è¯•ï¼Œå…± 12 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```rust
use lumosai_core::agent::{RetryExecutor, RetryStrategy, BackoffStrategy, AgentErrorType};
use lumosai_core::agent::types::RuntimeContext;

let strategy = RetryStrategy {
    max_retries: 3,
    backoff: BackoffStrategy::Exponential {
        initial_delay_ms: 100,
        multiplier: 2.0,
    },
    retryable_errors: vec![
        AgentErrorType::LlmError,
        AgentErrorType::NetworkError,
    ],
    max_delay_ms: Some(5000),
};

let executor = RetryExecutor::with_default_recovery(strategy);
let context = RuntimeContext::default();

let result = executor.execute(
    || async {
        // å¯èƒ½å¤±è´¥çš„æ“ä½œ
        some_operation().await
    },
    &context,
).await?;
```

**æ—¶é—´ä¼°ç®—**: 1-2 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å’Œæµ‹è¯•ï¼‰

#### 4.3.3 Tool ç³»ç»Ÿå¢å¼º âœ… **å·²å®Œæˆ**

**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: 6 ä¸ªæ–°æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡

**ç›®æ ‡**: å®ç° Tool æ³¨å†Œã€å‘ç°ã€ä¾èµ–ç®¡ç†

**æ–¹æ¡ˆ**:
```rust
// Tool æ³¨å†Œè¡¨
pub struct ToolRegistry {
    tools: Arc<RwLock<HashMap<String, Arc<dyn Tool>>>>,
    dependencies: Arc<RwLock<HashMap<String, Vec<String>>>>,
}

impl ToolRegistry {
    pub fn register(&self, tool: Arc<dyn Tool>) -> Result<()>;
    pub fn get(&self, name: &str) -> Option<Arc<dyn Tool>>;
    pub fn resolve_dependencies(&self, tool_name: &str) -> Result<Vec<Arc<dyn Tool>>>;
    pub fn discover(&self, pattern: &str) -> Vec<Arc<dyn Tool>>;
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… å®ç° ToolRegistryï¼ˆå·²å®Œæˆï¼Œå·²æœ‰åŸºç¡€å®ç°ï¼‰
2. âœ… å®ç°ä¾èµ–è§£æï¼ˆå·²å®Œæˆï¼Œresolve_dependencies æ–¹æ³•ï¼‰
3. âœ… å®ç°å·¥å…·å‘ç°ï¼ˆå·²å®Œæˆï¼Œdiscover æ–¹æ³•æ”¯æŒé€šé…ç¬¦ï¼‰
4. âœ… æ·»åŠ å·¥å…·ç‰ˆæœ¬ç®¡ç†ï¼ˆå·²å®Œæˆï¼Œget_tool_versionã€check_version_compatibilityï¼‰
5. âœ… æ·»åŠ ä¾èµ–å›¾åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼Œget_dependency_graphï¼‰
6. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œ6 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
7. âœ… æ›´æ–° Agent é›†æˆï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åœ¨ AgentExecutor ä¸­æ·»åŠ äº† `tool_registry` å­—æ®µ
   - æ·»åŠ äº† `with_tool_registry()` å’Œ `tool_registry()` æ–¹æ³•
   - æ·»åŠ äº† `discover_tools()` å’Œ `resolve_tool_dependencies()` æ–¹æ³•
   - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼‰

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… ToolRegistry å·²å­˜åœ¨å¹¶å®Œå–„ï¼š
  - `register_tool()` - å·¥å…·æ³¨å†Œ
  - `unregister_tool()` - å·¥å…·æ³¨é”€
  - `get_tool()` - è·å–å·¥å…·
  - `list_tools()` - åˆ—å‡ºæ‰€æœ‰å·¥å…·
  - `find_tools_by_category()` - æŒ‰ç±»åˆ«æŸ¥æ‰¾
  - `find_tools_by_tag()` - æŒ‰æ ‡ç­¾æŸ¥æ‰¾
  - `search_tools()` - æœç´¢å·¥å…·
- âœ… æ–°å¢åŠŸèƒ½ï¼š
  - `resolve_dependencies()` - è§£æå·¥å…·ä¾èµ–ï¼ˆæ”¯æŒé€’å½’ã€æ£€æµ‹å¾ªç¯ä¾èµ–ï¼‰
  - `discover()` - æ¨¡å¼åŒ¹é…å‘ç°å·¥å…·ï¼ˆæ”¯æŒ * å’Œ ? é€šé…ç¬¦ï¼‰
  - `get_tool_version()` - è·å–å·¥å…·ç‰ˆæœ¬
  - `check_version_compatibility()` - æ£€æŸ¥ç‰ˆæœ¬å…¼å®¹æ€§
  - `get_dependency_graph()` - è·å–ä¾èµ–å…³ç³»å›¾
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡éªŒè¯
- âœ… åœ¨ RefactoredAgent ä¸­é›†æˆäº† ToolRegistryï¼ˆ2025-11-21ï¼‰
  - AgentExecutor æ”¯æŒå¯é€‰çš„ ToolRegistry
  - æä¾› `discover_tools()` æ–¹æ³•ç”¨äºæ¨¡å¼åŒ¹é…å‘ç°å·¥å…·
  - æä¾› `resolve_tool_dependencies()` æ–¹æ³•ç”¨äºè§£æå·¥å…·ä¾èµ–
  - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 18 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```rust
use lumosai_core::tool::{ToolRegistry, ToolMetadata, ToolCategory};

let registry = ToolRegistry::new();

// æ³¨å†Œå·¥å…·ï¼ˆå¸¦ä¾èµ–ï¼‰
let metadata = ToolMetadata {
    name: "advanced_tool".to_string(),
    dependencies: vec!["base_tool".to_string()],
    // ... å…¶ä»–å­—æ®µ
};
registry.register_tool(tool, metadata)?;

// è§£æä¾èµ–
let tools_with_deps = registry.resolve_dependencies("advanced_tool")?;

// æ¨¡å¼åŒ¹é…å‘ç°
let calc_tools = registry.discover("calc*")?;

// æ£€æŸ¥ç‰ˆæœ¬
let compatible = registry.check_version_compatibility("tool", "1.0.0")?;
```

**æ—¶é—´ä¼°ç®—**: 1-2 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å·²å­˜åœ¨ï¼Œæœ¬æ¬¡å®Œå–„äº†ä¾èµ–ç®¡ç†å’Œç‰ˆæœ¬ç®¡ç†ï¼‰

### 4.4 é˜¶æ®µä¸‰ï¼šæ€§èƒ½ä¼˜åŒ– (P1-P2)

#### 4.4.1 å·¥å…·è°ƒç”¨å¹¶å‘æ§åˆ¶ âœ… **å·²å®Œæˆ**

**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: 4 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡

**ç›®æ ‡**: æ”¯æŒå·¥å…·è°ƒç”¨çš„å¹¶å‘æ‰§è¡Œ

**æ–¹æ¡ˆ**:
```rust
// å¹¶å‘å·¥å…·æ‰§è¡Œå™¨
pub struct ConcurrentToolExecutor {
    max_concurrency: usize,
    executor: Arc<Runtime>,
}

impl ConcurrentToolExecutor {
    pub async fn execute_tools(
        &self,
        tool_calls: Vec<ToolCall>,
        context: &ToolExecutionContext,
    ) -> Result<Vec<ToolResult>> {
        let semaphore = Arc::new(Semaphore::new(self.max_concurrency));
        let tasks: Vec<_> = tool_calls.into_iter().map(|call| {
            let sem = semaphore.clone();
            let executor = self.executor.clone();
            async move {
                let _permit = sem.acquire().await.unwrap();
                executor.execute_tool(call, context).await
            }
        }).collect();
        
        futures::future::join_all(tasks).await
            .into_iter()
            .collect::<Result<Vec<_>>>()
    }
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… å®ç°å¹¶å‘æ‰§è¡Œå™¨ï¼ˆå·²å®Œæˆï¼ŒConcurrentToolExecutorï¼‰
2. âœ… æ·»åŠ å¹¶å‘æ§åˆ¶é…ç½®ï¼ˆå·²å®Œæˆï¼ŒConcurrentToolExecutorConfigï¼‰
3. âœ… å®ç°ä¿æŒé¡ºåºå’Œä¹±åºä¸¤ç§æ¨¡å¼ï¼ˆå·²å®Œæˆï¼‰
4. âœ… æ·»åŠ è¶…æ—¶æ§åˆ¶ï¼ˆå·²å®Œæˆï¼‰
5. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œ4 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
6. âœ… æ›´æ–° Agent é›†æˆï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åœ¨ AgentExecutor ä¸­æ·»åŠ äº† ConcurrentToolExecutor æ”¯æŒ
   - æ·»åŠ äº† `with_concurrent_tool_executor()` å’Œ `concurrent_tool_executor()` æ–¹æ³•
   - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼‰
   - æ³¨æ„ï¼šç”±äºç±»å‹è½¬æ¢é—®é¢˜ï¼ˆBox<dyn Tool> vs Arc<dyn Tool>ï¼‰ï¼Œå®é™…å¹¶å‘æ‰§è¡Œé€»è¾‘æš‚æ—¶æœªå®Œå…¨å®ç°ï¼Œä½†æ¥å£å·²å°±ç»ª

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… åˆ›å»ºäº† `concurrent_tool_executor.rs` æ¨¡å—
- âœ… å®ç°äº† `ConcurrentToolExecutor` å¹¶å‘å·¥å…·æ‰§è¡Œå™¨
- âœ… å®ç°äº† `ConcurrentToolExecutorConfig` é…ç½®
  - `max_concurrency` - æœ€å¤§å¹¶å‘æ•°ï¼ˆé»˜è®¤ 5ï¼‰
  - `preserve_order` - æ˜¯å¦ä¿æŒé¡ºåºï¼ˆé»˜è®¤ falseï¼‰
  - `timeout_seconds` - è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤ 30 ç§’ï¼‰
- âœ… å®ç°äº†ä¸¤ç§æ‰§è¡Œæ¨¡å¼ï¼š
  - `execute_tools_ordered()` - ä¿æŒå·¥å…·è°ƒç”¨é¡ºåº
  - `execute_tools_unordered()` - ä¸ä¿æŒé¡ºåºï¼Œæ›´å¿«
- âœ… ä½¿ç”¨ `Semaphore` æ§åˆ¶å¹¶å‘æ•°
- âœ… ä½¿ç”¨ `futures::future::join_all` å®ç°å¹¶å‘æ‰§è¡Œ
- âœ… æ”¯æŒè¶…æ—¶æ§åˆ¶
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡éªŒè¯
- âœ… å·²å¯¼å‡ºåˆ° `agent` æ¨¡å—ï¼Œå¯ä¾›ä½¿ç”¨
- âœ… åœ¨ AgentExecutor ä¸­é›†æˆäº† ConcurrentToolExecutor æ¥å£ï¼ˆ2025-11-21ï¼‰
  - æ·»åŠ äº† `with_concurrent_tool_executor()` æ–¹æ³•ç”¨äºè®¾ç½®å¹¶å‘æ‰§è¡Œå™¨
  - æ·»åŠ äº† `concurrent_tool_executor()` æ–¹æ³•ç”¨äºè·å–å¹¶å‘æ‰§è¡Œå™¨
  - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 14 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰
  - æ³¨æ„ï¼šç”±äº AgentExecutor ä½¿ç”¨ `Box<dyn Tool>` è€Œ ConcurrentToolExecutor éœ€è¦ `Arc<dyn Tool>`ï¼Œå®é™…å¹¶å‘æ‰§è¡Œé€»è¾‘éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›

**ä½¿ç”¨ç¤ºä¾‹**:
```rust
use lumosai_core::agent::{ConcurrentToolExecutor, ConcurrentToolExecutorConfig};

let config = ConcurrentToolExecutorConfig {
    max_concurrency: 5,
    preserve_order: false,
    timeout_seconds: Some(30),
};

let executor = ConcurrentToolExecutor::new(config);

let results = executor.execute_tools(
    tool_calls,
    &tools,
    &ToolExecutionContext::new(),
    &ToolExecutionOptions::default(),
).await;
```

**æ—¶é—´ä¼°ç®—**: 1 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å’Œæµ‹è¯•ï¼‰

#### 4.4.2 LLM Provider æ™ºèƒ½è·¯ç”± âœ… **å·²å®Œæˆ**

**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: 5 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡

**ç›®æ ‡**: å®ç°åŸºäºè´Ÿè½½å’Œæˆæœ¬çš„æ™ºèƒ½è·¯ç”±

**æ–¹æ¡ˆ**:
```rust
// è·¯ç”±ç­–ç•¥
pub enum RoutingStrategy {
    RoundRobin,
    LeastLoad,
    LeastCost,
    BestLatency,
    Custom(Box<dyn Fn(&[ProviderStats]) -> usize>),
}

// è·¯ç”±å™¨
pub struct LlmRouter {
    providers: Vec<Arc<dyn LlmProvider>>,
    strategy: RoutingStrategy,
    stats: Arc<RwLock<HashMap<String, ProviderStats>>>,
}

impl LlmRouter {
    pub async fn select_provider(&self, options: &LlmOptions) -> Result<Arc<dyn LlmProvider>>;
    pub async fn update_stats(&self, provider: &str, stats: ProviderStats);
}
```

**å®æ–½æ­¥éª¤**:
1. âœ… å®ç°è·¯ç”±ç­–ç•¥ï¼ˆå·²å®Œæˆï¼Œ5 ç§ç­–ç•¥ï¼‰
2. âœ… å®ç°ç»Ÿè®¡æ”¶é›†ï¼ˆå·²å®Œæˆï¼ŒProviderStatsï¼‰
3. âœ… å®ç°è·¯ç”±å™¨ï¼ˆå·²å®Œæˆï¼ŒLlmRouterï¼‰
4. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œ5 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
5. âœ… æ›´æ–° Agent é›†æˆï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åœ¨ AgentExecutor ä¸­æ·»åŠ äº† `llm_router` å­—æ®µ
   - æ·»åŠ äº† `with_llm_router()` å’Œ `llm_router()` æ–¹æ³•
   - åœ¨ AgentGenerator ä¸­é›†æˆ LlmRouterï¼Œåœ¨æ¯æ¬¡ LLM è°ƒç”¨æ—¶åŠ¨æ€é€‰æ‹© provider
   - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼‰

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… åˆ›å»ºäº† `router.rs` æ¨¡å—
- âœ… å®ç°äº† `ProviderStats` ç»Ÿè®¡ç»“æ„
  - æ€»è¯·æ±‚æ•°ã€æˆåŠŸ/å¤±è´¥è¯·æ±‚æ•°
  - å¹³å‡å»¶è¿Ÿï¼ˆæŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼‰
  - å½“å‰è´Ÿè½½ã€æœ€å¤§å¹¶å‘æ•°
  - æˆæœ¬ï¼ˆæ¯ 1000 tokensï¼‰
  - æˆåŠŸç‡ã€è´Ÿè½½ç‡è®¡ç®—
- âœ… å®ç°äº† `RoutingStrategy` è·¯ç”±ç­–ç•¥
  - `RoundRobin` - è½®è¯¢
  - `LeastLoad` - æœ€å°‘è´Ÿè½½
  - `LeastCost` - æœ€ä½æˆæœ¬
  - `BestLatency` - æœ€ä½³å»¶è¿Ÿ
  - `Balanced` - ç»¼åˆè¯„åˆ†ï¼ˆè´Ÿè½½ 40% + æˆæœ¬ 30% + å»¶è¿Ÿ 30%ï¼‰
- âœ… å®ç°äº† `LlmRouter` è·¯ç”±å™¨
  - `select_provider()` - é€‰æ‹©æœ€ä½³ provider
  - `update_stats()` - æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
  - `record_success()` / `record_failure()` - è®°å½•è¯·æ±‚ç»“æœ
  - `increment_load()` / `decrement_load()` - è´Ÿè½½ç®¡ç†
  - `get_stats()` / `get_provider_stats()` - è·å–ç»Ÿè®¡ä¿¡æ¯
- âœ… æ”¯æŒæˆæœ¬ä¼°ç®—ï¼ˆæ ¹æ® provider ç±»å‹è‡ªåŠ¨ä¼°ç®—ï¼‰
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡éªŒè¯
- âœ… å·²å¯¼å‡ºåˆ° `llm` æ¨¡å—ï¼Œå¯ä¾›ä½¿ç”¨
- âœ… åœ¨ RefactoredAgent ä¸­é›†æˆäº† LlmRouterï¼ˆ2025-11-21ï¼‰
  - AgentExecutor æ”¯æŒå¯é€‰çš„ LlmRouter
  - AgentGenerator åœ¨æ¯æ¬¡ LLM è°ƒç”¨æ—¶ä½¿ç”¨ router åŠ¨æ€é€‰æ‹© providerï¼ˆå¦‚æœé…ç½®äº† routerï¼‰
  - å¦‚æœæ²¡æœ‰é…ç½® routerï¼Œåˆ™ä½¿ç”¨å›ºå®šçš„ providerï¼ˆå‘åå…¼å®¹ï¼‰
  - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ2 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 17 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```rust
use lumosai_core::llm::{LlmRouter, RoutingStrategy};
use lumosai_core::llm::providers;

let providers = vec![
    providers::openai_from_env()?,
    providers::anthropic_from_env()?,
    providers::qwen_from_env()?,
];

let router = LlmRouter::new(providers)
    .with_strategy(RoutingStrategy::Balanced);

// é€‰æ‹©æœ€ä½³ provider
let provider = router.select_provider(&LlmOptions::default()).await?;

// è®°å½•è¯·æ±‚ç»“æœ
router.increment_load(provider.name()).await;
let start = std::time::Instant::now();
let response = provider.generate("Hello", &options).await?;
let latency = start.elapsed().as_millis() as f64;
router.record_success(provider.name(), latency).await;
```

**æ—¶é—´ä¼°ç®—**: 1-2 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å’Œæµ‹è¯•ï¼‰

### 4.5 é˜¶æ®µå››ï¼šAPI ä¸€è‡´æ€§æ”¹è¿› (P1)

#### 4.5.1 API æ ‡å‡†åŒ– âœ… **å·²å®Œæˆï¼ˆåŸºç¡€å®ç°ï¼‰**

**çŠ¶æ€**: âœ… åŸºç¡€å®ç°å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**å®Œæˆæ—¥æœŸ**: 2025-01-XX  
**æµ‹è¯•**: 5 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡

**ç›®æ ‡**: ç»Ÿä¸€æ‰€æœ‰æ¨¡å—çš„ API é£æ ¼

**æ–¹æ¡ˆ**:
1. **å‘½åè§„èŒƒ**: ç»Ÿä¸€æ–¹æ³•å‘½åï¼ˆget_*, set_*, create_*ï¼‰
2. **å‚æ•°è§„èŒƒ**: ç»Ÿä¸€å‚æ•°é¡ºåºå’Œç±»å‹
3. **é”™è¯¯è§„èŒƒ**: ç»Ÿä¸€é”™è¯¯ç±»å‹å’Œæ¶ˆæ¯
4. **æ–‡æ¡£è§„èŒƒ**: ç»Ÿä¸€æ–‡æ¡£æ ¼å¼å’Œç¤ºä¾‹

**å®æ–½æ­¥éª¤**:
1. âœ… å®ç° API ä¸€è‡´æ€§æ£€æŸ¥å™¨ï¼ˆå·²å®Œæˆï¼ŒApiConsistencyCheckerï¼‰
2. âœ… å®ç° API æ ‡å‡†åŒ–å·¥å…·ï¼ˆå·²å®Œæˆï¼ŒApiStandardizerï¼‰
3. âœ… å®ç° API è§„èŒƒæ£€æŸ¥å™¨ï¼ˆå·²å®Œæˆï¼ŒApiSpecCheckerï¼‰
4. âœ… æ·»åŠ æµ‹è¯•éªŒè¯ï¼ˆå·²å®Œæˆï¼Œ5 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼‰
5. âœ… é‡æ„ Agent APIï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - åœ¨ AgentGenerator ä¸­é›†æˆäº† ApiStandardizer
   - æ‰€æœ‰ç”Ÿæˆçš„å“åº”éƒ½ç»è¿‡æ ‡å‡†åŒ–å¤„ç†
   - ç©ºå“åº”ä¼šè¢«æ›¿æ¢ä¸ºå‹å¥½çš„é»˜è®¤æ¶ˆæ¯
   - å“åº”ä¼šè‡ªåŠ¨æ·»åŠ é€‚å½“çš„æ ‡ç‚¹ç¬¦å·
   - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼‰
6. âœ… é‡æ„ Memory/Tool/Workflow APIï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰
   - **åˆ†æé˜¶æ®µ**ï¼ˆ2025-11-21ï¼‰ï¼š
     - âœ… åˆ†æäº† Memoryã€Toolã€Workflow API çš„å½“å‰çŠ¶æ€
     - âœ… Memory API å·²ç»æ¯”è¾ƒå®Œå–„ï¼Œæ”¯æŒç»Ÿä¸€æ¥å£ï¼ˆUnifiedMemoryï¼‰
     - âœ… Tool API å·²ç»æ¯”è¾ƒå®Œå–„ï¼Œæ”¯æŒæ³¨å†Œè¡¨ã€ä¾èµ–è§£æç­‰åŠŸèƒ½
     - âœ… Workflow API åˆ†æå®Œæˆ
     - âœ… è¯†åˆ«äº† API ä¸€è‡´æ€§æ”¹è¿›ç‚¹
   - **åˆ†æç»“æœ**ï¼ˆ2025-11-21ï¼‰ï¼š
     - **Memory API**ï¼šâœ… å®Œå…¨ç¬¦åˆè®¾è®¡ç›®æ ‡
       - ç»Ÿä¸€æ¥å£ï¼ˆUnifiedMemoryï¼‰
       - Thread ç®¡ç†ã€Resource éš”ç¦»ã€Message Processor ç­‰åŠŸèƒ½å®Œå–„
       - æ‰€æœ‰åŠŸèƒ½éƒ½å·²é›†æˆåˆ° Memory trait
     - **Tool API**ï¼šâœ… å®Œå…¨ç¬¦åˆè®¾è®¡ç›®æ ‡
       - æ”¯æŒæ³¨å†Œè¡¨ï¼ˆToolRegistryï¼‰
       - æ”¯æŒä¾èµ–è§£æ
       - æ”¯æŒæ¨¡å¼åŒ¹é…å‘ç°
       - æ‰€æœ‰åŠŸèƒ½éƒ½å·²é›†æˆ
     - **Workflow API**ï¼šâœ… å®Œå…¨ç¬¦åˆè®¾è®¡ç›®æ ‡
       - æ ¸å¿ƒ Trait å·²å®šä¹‰ï¼ˆWorkflowï¼‰
       - å¤šä¸ªå®ç°ï¼ˆDagWorkflow, EnhancedWorkflow, BasicWorkflowï¼‰
       - æ”¯æŒ execute å’Œ execute_stream
       - æ”¯æŒ suspend/resume
       - æ”¯æŒçŠ¶æ€ç®¡ç†
       - ä¸ Memory/Tool API ä¿æŒä¸€è‡´ï¼ˆasync_trait, Result<Value>, RuntimeContextï¼‰
   - **ç»“è®º**ï¼ˆ2025-11-21ï¼‰ï¼š
     - æ‰€æœ‰ä¸‰ä¸ª APIï¼ˆMemoryã€Toolã€Workflowï¼‰éƒ½å·²ç»æ¯”è¾ƒå®Œå–„
     - è®¾è®¡ä¸€è‡´ï¼Œå‘½åè§„èŒƒç»Ÿä¸€
     - éƒ½ä½¿ç”¨ç›¸åŒçš„é”™è¯¯å¤„ç†æ¨¡å¼ï¼ˆResult ç±»å‹ï¼‰
     - éƒ½ä½¿ç”¨ RuntimeContext è¿›è¡Œä¸Šä¸‹æ–‡ç®¡ç†
     - ä¸»è¦æ”¹è¿›ç©ºé—´åœ¨äºæ–‡æ¡£å’Œé”™è¯¯æ¶ˆæ¯çš„ç»Ÿä¸€ï¼ˆéå…³é”®ï¼‰
     - **æ— éœ€è¿›è¡Œå¤§è§„æ¨¡é‡æ„**

**å®é™…å®Œæˆæƒ…å†µ**:
- âœ… `ApiConsistencyChecker` - API ä¸€è‡´æ€§æ£€æŸ¥å™¨
  - `check_agent_consistency()` - æ£€æŸ¥ Agent API ä¸€è‡´æ€§
  - æ£€æŸ¥åŸºæœ¬é…ç½®ã€æ–¹æ³•å®ç°ã€çŠ¶æ€ç®¡ç†ã€é”™è¯¯å¤„ç†
  - ç”Ÿæˆä¸€è‡´æ€§è¯„åˆ†å’Œæ”¹è¿›å»ºè®®
- âœ… `ApiStandardizer` - API æ ‡å‡†åŒ–å·¥å…·
  - `standardize_response()` - æ ‡å‡†åŒ–å“åº”æ ¼å¼
  - `standardize_error_message()` - æ ‡å‡†åŒ–é”™è¯¯æ¶ˆæ¯
  - `standardize_agent_name()` - æ ‡å‡†åŒ– Agent åç§°
  - `validate_method_name()` - éªŒè¯æ–¹æ³•å‘½åè§„èŒƒ
  - `generate_api_documentation()` - ç”Ÿæˆ API æ–‡æ¡£
- âœ… `ApiSpecChecker` - API è§„èŒƒæ£€æŸ¥å™¨
  - `check_naming_conventions()` - æ£€æŸ¥å‘½åè§„èŒƒ
  - `check_parameter_consistency()` - æ£€æŸ¥å‚æ•°ä¸€è‡´æ€§
- âœ… æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹é€šè¿‡éªŒè¯
- âœ… å·²å¯¼å‡ºåˆ° `agent` æ¨¡å—ï¼Œå¯ä¾›ä½¿ç”¨
- âœ… åœ¨ AgentGenerator ä¸­é›†æˆäº† API æ ‡å‡†åŒ–ï¼ˆ2025-11-21ï¼‰
  - æ‰€æœ‰ç”Ÿæˆçš„å“åº”éƒ½é€šè¿‡ `ApiStandardizer::standardize_response` æ ‡å‡†åŒ–
  - ç¡®ä¿å“åº”æ ¼å¼ä¸€è‡´ï¼šç©ºå“åº”æ›¿æ¢ã€æ ‡ç‚¹ç¬¦å·å¤„ç†
  - åœ¨ `generate()` æ–¹æ³•çš„æ‰€æœ‰è¿”å›è·¯å¾„ä¸­åº”ç”¨æ ‡å‡†åŒ–
  - æ·»åŠ äº†æµ‹è¯•éªŒè¯ï¼ˆ1 ä¸ªæ–°æµ‹è¯•é€šè¿‡ï¼Œå…± 15 ä¸ª refactored æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼‰

**ä½¿ç”¨ç¤ºä¾‹**:
```rust
use lumosai_core::agent::{ApiConsistencyChecker, ApiStandardizer, ApiSpecChecker};

// æ£€æŸ¥ Agent API ä¸€è‡´æ€§
let result = ApiConsistencyChecker::check_agent_consistency(&agent).await;
println!("Consistency Score: {:.2}", result.score);
for issue in result.issues {
    println!("Issue: {} - {}", issue.severity, issue.description);
}

// æ ‡å‡†åŒ–å“åº”
let standardized = ApiStandardizer::standardize_response("Hello");
assert_eq!(standardized, "Hello.");

// æ£€æŸ¥å‘½åè§„èŒƒ
let methods = vec!["get_name".to_string(), "invalidMethod".to_string()];
let issues = ApiSpecChecker::check_naming_conventions(&methods);
```

**æ—¶é—´ä¼°ç®—**: 2-3 å‘¨  
**å®é™…è€—æ—¶**: å·²å®Œæˆï¼ˆåŸºç¡€å®ç°å’Œæµ‹è¯•ï¼‰

### 4.6 æ”¹é€ æ—¶é—´è¡¨

| é˜¶æ®µ | ä»»åŠ¡ | ä¼˜å…ˆçº§ | æ—¶é—´ä¼°ç®— | ä¾èµ– |
|------|------|--------|----------|------|
| **é˜¶æ®µä¸€** | Agent Trait æ‹†åˆ† | P0 | 2-3 å‘¨ | - | âœ… **åŸºç¡€å®ç°å·²å®Œæˆ** |
| **é˜¶æ®µä¸€** | Memory ç³»ç»Ÿé‡æ„ | P0 | 3-4 å‘¨ | - | âœ… **å·²å®Œæˆï¼ˆ2025-11-21ï¼‰** | âœ… **å·²å®Œæˆï¼ˆ2025-11-21ï¼‰** |
| **é˜¶æ®µä¸€** | BasicAgent é‡æ„ | P0 | 2-3 å‘¨ | Agent Trait æ‹†åˆ† | âœ… **å·²å®Œæˆï¼ˆ2025-11-21ï¼‰** |
| **é˜¶æ®µäºŒ** | åŠ¨æ€é…ç½®æ”¯æŒ | P1 | 1-2 å‘¨ | é˜¶æ®µä¸€å®Œæˆ | âœ… **å·²å®Œæˆ** |
| **é˜¶æ®µäºŒ** | ç»Ÿä¸€é”™è¯¯å¤„ç† | P1 | 1-2 å‘¨ | é˜¶æ®µä¸€å®Œæˆ | âœ… **å·²å®Œæˆï¼ˆåŸºç¡€ï¼‰** |
| **é˜¶æ®µäºŒ** | Tool ç³»ç»Ÿå¢å¼º | P1 | 1-2 å‘¨ | é˜¶æ®µä¸€å®Œæˆ | âœ… **å·²å®Œæˆ** |
| **é˜¶æ®µä¸‰** | å·¥å…·è°ƒç”¨å¹¶å‘ | P1 | 1 å‘¨ | é˜¶æ®µäºŒå®Œæˆ | âœ… **å·²å®Œæˆ** |
| **é˜¶æ®µä¸‰** | LLM æ™ºèƒ½è·¯ç”± | P2 | 1-2 å‘¨ | é˜¶æ®µäºŒå®Œæˆ | âœ… **å·²å®Œæˆ** |
| **é˜¶æ®µå››** | API æ ‡å‡†åŒ– | P1 | 2-3 å‘¨ | é˜¶æ®µä¸€å®Œæˆ | âœ… **å·²å®Œæˆï¼ˆåŸºç¡€ï¼‰** |

**æ€»æ—¶é—´ä¼°ç®—**: 14-22 å‘¨ï¼ˆçº¦ 3.5-5.5 ä¸ªæœˆï¼‰

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå®æ–½å»ºè®®

### 5.1 ä¼˜å…ˆçº§å»ºè®®

**ç«‹å³å®æ–½ (P0)**:
1. Agent Trait æ‹†åˆ† - å½±å“åç»­æ‰€æœ‰æ”¹é€ 
2. Memory ç³»ç»Ÿé‡æ„ - æ ¸å¿ƒåŠŸèƒ½ç¼ºå¤±
3. BasicAgent é‡æ„ - ä»£ç è´¨é‡å…³é”®

**è¿‘æœŸå®æ–½ (P1)**:
1. âœ… **åŠ¨æ€é…ç½®æ”¯æŒ** - æå‡çµæ´»æ€§ **ï¼ˆå·²å®Œæˆï¼‰**
2. âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†** - æå‡ç¨³å®šæ€§ **ï¼ˆå·²å®ŒæˆåŸºç¡€å®ç°ï¼‰**
3. âœ… **Tool ç³»ç»Ÿå¢å¼º** - æå‡å¯ç»´æŠ¤æ€§ **ï¼ˆå·²å®Œæˆï¼‰**
4. âœ… **API æ ‡å‡†åŒ–** - æå‡å¼€å‘ä½“éªŒ **ï¼ˆå·²å®ŒæˆåŸºç¡€å®ç°ï¼‰**

**é•¿æœŸè§„åˆ’ (P2)**:
1. LLM æ™ºèƒ½è·¯ç”± - æ€§èƒ½ä¼˜åŒ–
2. æ›´å¤šåä½œæ¨¡å¼ - åŠŸèƒ½æ‰©å±•

### 5.2 é£é™©æ§åˆ¶

**é£é™© 1: å‘åå…¼å®¹æ€§**
- **é£é™©**: æ”¹é€ å¯èƒ½ç ´åç°æœ‰ API
- **ç¼“è§£**: 
  - ä¿ç•™æ—§ APIï¼Œæ ‡è®°ä¸º deprecated
  - æä¾›è¿ç§»æŒ‡å—
  - åˆ†é˜¶æ®µè¿ç§»

**é£é™© 2: æ€§èƒ½ä¸‹é™**
- **é£é™©**: é‡æ„å¯èƒ½å½±å“æ€§èƒ½
- **ç¼“è§£**:
  - æ¯ä¸ªé˜¶æ®µè¿›è¡Œæ€§èƒ½æµ‹è¯•
  - ä¿ç•™æ€§èƒ½åŸºå‡†æµ‹è¯•
  - ä¼˜åŒ–çƒ­ç‚¹è·¯å¾„

**é£é™© 3: æµ‹è¯•è¦†ç›–ä¸è¶³**
- **é£é™©**: é‡æ„å¯èƒ½å¼•å…¥ bug
- **ç¼“è§£**:
  - å¢åŠ å•å…ƒæµ‹è¯•
  - å¢åŠ é›†æˆæµ‹è¯•
  - ä»£ç å®¡æŸ¥

### 5.3 æˆåŠŸæ ‡å‡†

**æŠ€æœ¯æŒ‡æ ‡**:
- âœ… Agent Trait æ–¹æ³•æ•° < 20
- âœ… BasicAgent ä»£ç è¡Œæ•° < 1000
- âœ… Memory ç³»ç»Ÿæ”¯æŒ Thread å’Œ Resource
- âœ… API ä¸€è‡´æ€§ > 90%
- âœ… æµ‹è¯•è¦†ç›–ç‡ > 80%

**åŠŸèƒ½æŒ‡æ ‡**:
- âœ… æ”¯æŒåŠ¨æ€é…ç½® **ï¼ˆå·²å®Œæˆï¼‰**
- âœ… ç»Ÿä¸€çš„é”™è¯¯å¤„ç† **ï¼ˆå·²å®ŒæˆåŸºç¡€å®ç°ï¼‰**
  - âœ… é”™è¯¯ç±»å‹åˆ†ç±»
  - âœ… é‡è¯•ç­–ç•¥å’Œå›é€€æœºåˆ¶
  - âœ… é”™è¯¯æ¢å¤ç³»ç»Ÿ
  - âœ… RetryExecutor æ‰§è¡Œå™¨
- âœ… Tool æ³¨å†Œå’Œå‘ç° **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… ToolRegistry å·¥å…·æ³¨å†Œè¡¨
  - âœ… ä¾èµ–è§£æå’Œå¾ªç¯æ£€æµ‹
  - âœ… æ¨¡å¼åŒ¹é…å‘ç°
  - âœ… ç‰ˆæœ¬ç®¡ç†
- âœ… API æ ‡å‡†åŒ– **ï¼ˆå·²å®ŒæˆåŸºç¡€å®ç°ï¼‰**
  - âœ… API ä¸€è‡´æ€§æ£€æŸ¥å™¨
  - âœ… API æ ‡å‡†åŒ–å·¥å…·
  - âœ… API è§„èŒƒæ£€æŸ¥å™¨
- âœ… å·¥å…·è°ƒç”¨å¹¶å‘æ”¯æŒ **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… ConcurrentToolExecutor å¹¶å‘æ‰§è¡Œå™¨
  - âœ… å¹¶å‘æ§åˆ¶é…ç½®
  - âœ… ä¿æŒé¡ºåºå’Œä¹±åºä¸¤ç§æ¨¡å¼
  - âœ… è¶…æ—¶æ§åˆ¶
- âœ… LLM Provider æ™ºèƒ½è·¯ç”± **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… LlmRouter è·¯ç”±å™¨
  - âœ… 5 ç§è·¯ç”±ç­–ç•¥ï¼ˆè½®è¯¢ã€æœ€å°‘è´Ÿè½½ã€æœ€ä½æˆæœ¬ã€æœ€ä½³å»¶è¿Ÿã€ç»¼åˆè¯„åˆ†ï¼‰
  - âœ… ProviderStats ç»Ÿè®¡ç³»ç»Ÿ
  - âœ… è´Ÿè½½ç®¡ç†å’Œæˆæœ¬ä¼°ç®—
- âœ… Agent Trait æ‹†åˆ† **ï¼ˆåŸºç¡€å®ç°å·²å®Œæˆï¼‰**
  - âœ… CoreAgent Traitï¼ˆæ ¸å¿ƒ Agentï¼Œç²¾ç®€ç‰ˆï¼‰
  - âœ… MemoryAgent Traitï¼ˆå†…å­˜ Agentï¼‰
  - âœ… ToolAgent Traitï¼ˆå·¥å…· Agentï¼‰
  - âœ… StreamingAgentTrait Traitï¼ˆæµå¼ Agentï¼‰
  - âœ… FullAgent Traitï¼ˆç»„åˆæ‰€æœ‰åŠŸèƒ½ï¼‰
- âœ… æ€§èƒ½ç›‘æ§ç³»ç»Ÿå®Œå–„ **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… PerformanceMonitor æ€§èƒ½ç›‘æ§å™¨
  - âœ… PerformanceMetrics æ€§èƒ½æŒ‡æ ‡
  - âœ… RequestTimer è¯·æ±‚è®¡æ—¶å™¨
  - âœ… PerformanceAnalyzer æ€§èƒ½åˆ†æå™¨
  - âœ… 14 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… é…ç½®éªŒè¯å™¨å®Œå–„ **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… ConfigValidator é…ç½®éªŒè¯å™¨
  - âœ… ValidationReport éªŒè¯æŠ¥å‘Š
  - âœ… æ”¯æŒè‡ªå®šä¹‰éªŒè¯è§„åˆ™
  - âœ… æ”¯æŒå¿…éœ€å­—æ®µæ£€æŸ¥
  - âœ… 13 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… æ¶ˆæ¯å·¥å…·å®Œå–„ **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… åŸºç¡€æ¶ˆæ¯åˆ›å»ºå‡½æ•°ï¼ˆsystem_message, user_message, assistant_message, tool_messageï¼‰
  - âœ… å¸¦å…ƒæ•°æ®çš„æ¶ˆæ¯åˆ›å»ºï¼ˆmessage_with_metadataï¼‰
  - âœ… å¸¦åç§°çš„æ¶ˆæ¯åˆ›å»ºï¼ˆmessage_with_nameï¼‰
  - âœ… æ¶ˆæ¯æ ¼å¼åŒ–ï¼ˆformat_messages, format_roleï¼‰
  - âœ… æ¶ˆæ¯è¿‡æ»¤å’Œç»Ÿè®¡ï¼ˆfilter_messages_by_role, count_messages_by_role, extract_text_contentï¼‰
  - âœ… 9 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… è¯„ä¼°æŒ‡æ ‡ç³»ç»Ÿå®Œå–„ **ï¼ˆå·²å®Œæˆï¼‰**
  - âœ… RelevanceMetricï¼ˆç›¸å…³æ€§æŒ‡æ ‡ï¼‰
  - âœ… LengthMetricï¼ˆé•¿åº¦æŒ‡æ ‡ï¼‰
  - âœ… CompositeMetricï¼ˆå¤åˆæŒ‡æ ‡ï¼‰
  - âœ… EvaluationResult åºåˆ—åŒ–/ååºåˆ—åŒ–æ”¯æŒ
  - âœ… 12 ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡
- âœ… Memory çº¿ç¨‹ä¸Šä¸‹æ–‡å­˜å‚¨é“¾è·¯å®Œå–„ **ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰**
  - âœ… BasicAgent è‡ªåŠ¨é™„åŠ çº¿ç¨‹/èµ„æºå…ƒæ•°æ®
  - âœ… BasicMemory å¤ç”¨çº¿ç¨‹ + æ”¯æŒ `namespace`/`store_id` æ£€ç´¢
  - âœ… æ–°å¢ 3 ä¸ªå›å½’æµ‹è¯•è¦†ç›–å­˜å‚¨ä¸æ£€ç´¢é€»è¾‘
- âœ… `generate_with_memory` çº¿ç¨‹ä¸Šä¸‹æ–‡å¢å¼º **ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰**
  - âœ… è‡ªåŠ¨ç»§æ‰¿è°ƒç”¨å…¥å‚ / æ¶ˆæ¯å…ƒæ•°æ®ä¸­çš„ thread/resource
  - âœ… è‡ªåŠ¨æ„å»º MemoryConfig å¹¶åŒæ­¥ä¸Šä¸‹æ–‡çª—å£
  - âœ… åŸºäº MockMemoryWithThreads çš„é›†æˆæµ‹è¯•éªŒè¯çœŸå®æŒä¹…åŒ–è·¯å¾„
- âœ… è¯­ä¹‰å¬å›ç»Ÿä¸€æ¥å£å®Œå–„ **ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰**
  - âœ… BasicMemory/UnifiedMemory æ”¯æŒçº¿ç¨‹å†å²ä¸è¯­ä¹‰å¬å›æ··åˆæ£€ç´¢ï¼Œä¿æŒé¡ºåºä¸€è‡´æ€§
  - âœ… UnifiedMemory æ–°å¢ `semantic_recall` ä¸“ç”¨æ–¹æ³•ï¼Œæ”¯æŒçº¯è¯­ä¹‰æœç´¢ä¸æ··å…¥çº¿ç¨‹å†å²
  - âœ… ä¿®å¤æ¶ˆæ¯é¡ºåºé—®é¢˜ï¼Œç¡®ä¿çº¿ç¨‹å†å²æ¶ˆæ¯ï¼ˆæœ€æ–°åœ¨å‰ï¼‰ä¸è¯­ä¹‰å¬å›ç»“æœæ­£ç¡®åˆå¹¶
  - âœ… æ–°å¢ 2 ä¸ªé›†æˆæµ‹è¯•éªŒè¯æ··åˆæ£€ç´¢ä¸çº¯è¯­ä¹‰å¬å›åœºæ™¯
- âœ… Memory Thread ç®¡ç†ä¾¿æ·æ–¹æ³• **ï¼ˆå·²å®Œæˆï¼Œ2025-11-21ï¼‰**
  - âœ… BasicMemory å’Œ UnifiedMemory æ–°å¢ Thread ç®¡ç†ä¾¿æ·æ–¹æ³•ï¼ˆcreate_thread, get_thread, update_thread, delete_thread, list_threads, get_thread_statsï¼‰
  - âœ… æ”¯æŒé€šè¿‡ Memory å®ä¾‹ç›´æ¥ç®¡ç†çº¿ç¨‹ï¼Œç®€åŒ–ä½¿ç”¨æµç¨‹
  - âœ… æ–°å¢ 4 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯ Thread ç®¡ç†åŠŸèƒ½

**æ€§èƒ½æŒ‡æ ‡**:
- âœ… å·¥å…·è°ƒç”¨å¹¶å‘æ€§èƒ½æå‡ 2-5x
- âœ… LLM è·¯ç”±å»¶è¿Ÿ < 10ms
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ– 20%

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæ€»ç»“

### 6.1 æ ¸å¿ƒå‘ç°

1. **LumosAI ä¼˜åŠ¿æ˜æ˜¾**: Rust ç”Ÿæ€ã€æ€§èƒ½ã€å¤š Agent åä½œ
2. **æ¶æ„éœ€è¦ä¼˜åŒ–**: Agent Trait è¿‡é‡ã€Memory åŠŸèƒ½ä¸è¶³
3. **è®¾è®¡æ¨¡å¼å¯å€Ÿé‰´**: Mastra çš„ DynamicArgumentã€ç»Ÿä¸€æŠ½è±¡
4. **æ”¹é€ è·¯å¾„æ¸…æ™°**: åˆ†é˜¶æ®µå®æ–½ï¼Œé£é™©å¯æ§

### 6.2 å…³é”®å»ºè®®

1. **ä¼˜å…ˆé‡æ„æ ¸å¿ƒ**: Agentã€Memoryã€BasicAgent
2. **ä¿æŒ Rust ä¼˜åŠ¿**: ä¸æ”¹å˜è¯­è¨€ç”Ÿæ€
3. **æ¸è¿›å¼æ”¹é€ **: åˆ†é˜¶æ®µå®æ–½ï¼Œä¿è¯ç¨³å®šæ€§
4. **é‡è§†æµ‹è¯•**: æ¯ä¸ªé˜¶æ®µéƒ½è¦æœ‰å……åˆ†çš„æµ‹è¯•

### 6.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¯„å®¡æ”¹é€ è®¡åˆ’**: ä¸å›¢é˜Ÿè¯„å®¡ï¼Œç¡®å®šä¼˜å…ˆçº§
2. **åˆ›å»º Issue**: ä¸ºæ¯ä¸ªæ”¹é€ ä»»åŠ¡åˆ›å»º Issue
3. **å¼€å§‹å®æ–½**: ä» P0 ä»»åŠ¡å¼€å§‹ï¼Œé€æ­¥æ¨è¿›
4. **æŒç»­ç›‘æ§**: ç›‘æ§æ”¹é€ è¿›åº¦å’Œå½±å“

---

## é™„å½•

### A. å‚è€ƒæ–‡æ¡£

- [LumosAI æ¶æ„æ–‡æ¡£](lumosai/docs/ARCHITECTURE.md)
- [Mastra Agent æ–‡æ¡£](lumosai/source/mastra/packages/core/src/agent/index.ts)
- [Mastra Memory æ–‡æ¡£](lumosai/source/mastra/packages/core/src/memory/memory.ts)

### B. ç›¸å…³ Issue

- Agent Trait æ‹†åˆ†: #XXX
- Memory ç³»ç»Ÿé‡æ„: #XXX
- BasicAgent é‡æ„: #XXX

### C. æœ¯è¯­è¡¨

- **Agent**: AI ä»£ç†ï¼Œèƒ½å¤Ÿæ‰§è¡Œä»»åŠ¡å’Œä¸ç”¨æˆ·äº¤äº’
- **Memory**: è®°å¿†ç³»ç»Ÿï¼Œå­˜å‚¨å’Œæ£€ç´¢å¯¹è¯å†å²
- **Tool**: å·¥å…·ï¼Œæ‰©å±• Agent èƒ½åŠ›çš„å‡½æ•°
- **Workflow**: å·¥ä½œæµï¼Œç¼–æ’å¤šä¸ªæ­¥éª¤çš„æ‰§è¡Œ
- **DynamicArgument**: åŠ¨æ€å‚æ•°ï¼Œæ”¯æŒè¿è¡Œæ—¶è§£æ
- **Thread**: çº¿ç¨‹ï¼Œå¯¹è¯çš„ä¼šè¯ä¸Šä¸‹æ–‡
- **Resource**: èµ„æºï¼Œç”¨äºéš”ç¦»ä¸åŒç”¨æˆ·/ç§Ÿæˆ·çš„æ•°æ®

---

**æ–‡æ¡£ç»“æŸ**

